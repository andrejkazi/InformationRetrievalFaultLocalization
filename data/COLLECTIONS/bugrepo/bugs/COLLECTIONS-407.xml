<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Nov 19 22:24:23 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/COLLECTIONS-407/COLLECTIONS-407.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[COLLECTIONS-407] ListOrderedSet.removeAll() is slow</title>
                <link>https://issues.apache.org/jira/browse/COLLECTIONS-407</link>
                <project id="12310465" key="COLLECTIONS">Commons Collections</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I am encountering a performance problem in ListOrderedSet.removeAll().&lt;br/&gt;
It appears in version 3.2.1 and also in revision 1344775 (31 May&lt;br/&gt;
2012).  I have attached a test that exposes this problem and a&lt;br/&gt;
one-line patch that fixes it.  On my machine, for this test, the patch&lt;br/&gt;
provides a 317X speedup.&lt;/p&gt;

&lt;p&gt;To run the test, just do:&lt;/p&gt;

&lt;p&gt;$ java Test&lt;/p&gt;

&lt;p&gt;The output for the un-patched version is:&lt;br/&gt;
Time is 3812&lt;/p&gt;

&lt;p&gt;The output for the patched version is:&lt;br/&gt;
Time is 12&lt;/p&gt;

&lt;p&gt;As the patch shows, the problem is in &lt;br/&gt;
ListOrderedSet.remove(Object object).  The code for this method is:&lt;/p&gt;

&lt;p&gt;boolean result = collection.remove(object);&lt;br/&gt;
setOrder.remove(object);&lt;br/&gt;
return result;&lt;/p&gt;

&lt;p&gt;The patch changes it to :&lt;/p&gt;

&lt;p&gt;boolean result = collection.remove(object);&lt;br/&gt;
if (result) setOrder.remove(object);&lt;br/&gt;
return result;&lt;/p&gt;

&lt;p&gt;The &quot;setOrder.remove(object)&quot; is not necessary if &lt;br/&gt;
&quot;collection.remove(object)&quot; did not find the object.&lt;/p&gt;

&lt;p&gt;This small change speeds up&lt;br/&gt;
ListOrderedSet.ListOrderedSet.removeAll(Collection&amp;lt;?&amp;gt; coll) because&lt;br/&gt;
ListOrderedSet.ListOrderedSet.removeAll(Collection&amp;lt;?&amp;gt; coll) iterates&lt;br/&gt;
over all the elements in &quot;coll&quot; and calls &lt;br/&gt;
ListOrderedSet.remove(Object object).  So the un-patched code has&lt;br/&gt;
quadratic complexity, while the patched code has linear complexity.&lt;/p&gt;

&lt;p&gt;Is this truly a bug, or am I missing something here?  If so, can you&lt;br/&gt;
please confirm if the patch is correct?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Adrian&lt;/p&gt;</description>
                <environment>&lt;p&gt;java 1.6.0_24&lt;br/&gt;
Ubuntu 11.10&lt;/p&gt;</environment>
        <key id="12558984">COLLECTIONS-407</key>
            <summary>ListOrderedSet.removeAll() is slow</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="adriannistor">Adrian Nistor</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Jun 2012 17:55:32 +0000</created>
                <updated>Sun, 9 Nov 2014 14:31:35 +0000</updated>
                            <resolved>Tue, 19 Jun 2012 19:00:13 +0000</resolved>
                                    <version>3.2.1</version>
                                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13396574" author="tn" created="Tue, 19 Jun 2012 07:16:38 +0000"  >&lt;p&gt;The patch looks correct. The only thing that comes to my mind is that there may be collections which wrongly implement the methods in question and do not correctly return the change status.&lt;/p&gt;

&lt;p&gt;So the way it is implemented right now is a bit slower but will work in all cases.&lt;/p&gt;</comment>
                            <comment id="13396860" author="adriannistor" created="Tue, 19 Jun 2012 15:36:04 +0000"  >&lt;p&gt;Hi Thomas,&lt;/p&gt;

&lt;p&gt;Thanks, it&apos;s great that the patch works.&lt;/p&gt;

&lt;p&gt;java.util, Apache Commons Collections, Guava Libraries, all use on a&lt;br/&gt;
regular basis methods from the collections passed as parameters (over&lt;br/&gt;
which these three libraries have no control), just like in this case.&lt;br/&gt;
It&apos;s the normal thing to do, there must be hundreds of such examples,&lt;br/&gt;
and nobody tries to avoid them.&lt;/p&gt;

&lt;p&gt;In fact, how can one use the collections passes as parameters&lt;br/&gt;
otherwise?  For example, the implementation of ListOrderedSet alone&lt;br/&gt;
(not to mention the other classes in Commons Collections, java.util,&lt;br/&gt;
and Guava Libraries) uses methods from &quot;collection&quot; 9 different times,&lt;br/&gt;
including the return value of &quot;collection.retainAll&quot; in the&lt;br/&gt;
implementation of &quot;ListOrderedSet.retainAll(Collection&amp;lt;?&amp;gt; coll)&quot;.  It&lt;br/&gt;
would not be possible to implement Commons Collections otherwise.&lt;/p&gt;

&lt;p&gt;&amp;gt; a bit slower&lt;/p&gt;

&lt;p&gt;Quadratic vs linear complexity is a big difference.  This can get&lt;br/&gt;
really slow (e.g., two orders of magnitude) even for medium size data&lt;br/&gt;
sets.&lt;/p&gt;

&lt;p&gt;Best,&lt;/p&gt;

&lt;p&gt;Adrian&lt;/p&gt;
</comment>
                            <comment id="13396899" author="tn" created="Tue, 19 Jun 2012 16:21:28 +0000"  >&lt;p&gt;You are right, in fact other methods (in ListOrderedSet, e.g. retainAll) already use similar logic as proposed in your patch, so I guess it is safe to do it also for the remove method.&lt;/p&gt;</comment>
                            <comment id="13396985" author="tn" created="Tue, 19 Jun 2012 19:00:13 +0000"  >&lt;p&gt;Applied patch in r1351800.&lt;/p&gt;

&lt;p&gt;Thanks for reporting!&lt;/p&gt;</comment>
                            <comment id="13396990" author="hudson" created="Tue, 19 Jun 2012 19:06:13 +0000"  >&lt;p&gt;Integrated in commons-collections #21 (See &lt;a href=&quot;https://builds.apache.org/job/commons-collections/21/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/commons-collections/21/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/COLLECTIONS-407&quot; title=&quot;ListOrderedSet.removeAll() is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COLLECTIONS-407&quot;&gt;&lt;del&gt;COLLECTIONS-407&lt;/del&gt;&lt;/a&gt; improve performance of remove method by taking method result from underlying collection into account. Thanks to Adrian Nistor for reporting and providing a patch. (Revision 1351800)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
tn : &lt;a href=&quot;http://svn.apache.org/viewvc/?view=rev&amp;amp;rev=1351800&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/?view=rev&amp;amp;rev=1351800&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/commons/proper/collections/trunk/src/main/java/org/apache/commons/collections/set/ListOrderedSet.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12595135">COLLECTIONS-409</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12559038">COLLECTIONS-408</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12530579" name="Test.java" size="744" author="adriannistor" created="Fri, 1 Jun 2012 17:55:58 +0000"/>
                            <attachment id="12530578" name="patch.diff" size="569" author="adriannistor" created="Fri, 1 Jun 2012 17:55:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 19 Jun 2012 07:16:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>292951</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 22 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0shr3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164353</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>