<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Nov 19 21:46:34 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/COLLECTIONS-240/COLLECTIONS-240.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[COLLECTIONS-240] MultiValueMap should implement Serializable</title>
                <link>https://issues.apache.org/jira/browse/COLLECTIONS-240</link>
                <project id="12310465" key="COLLECTIONS">Commons Collections</project>
                    <description>&lt;p&gt;Collection classes should be serializable as they are frequently used in model classes which need to be serializable, for example in a HttpSession object within a servlet container cluster.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12360935">COLLECTIONS-240</key>
            <summary>MultiValueMap should implement Serializable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="wouterv">Wouter de Vaal</reporter>
                        <labels>
                    </labels>
                <created>Sat, 20 Jan 2007 14:09:02 +0000</created>
                <updated>Sun, 9 Nov 2014 14:31:24 +0000</updated>
                            <resolved>Thu, 28 Feb 2013 20:04:15 +0000</resolved>
                                    <version>3.2</version>
                                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Map</component>
                        <due></due>
                            <votes>11</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="12493478" author="bayard" created="Thu, 3 May 2007 19:38:28 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12493647" author="joerg.heinicke@gmx.de" created="Fri, 4 May 2007 11:15:00 +0000"  >&lt;p&gt;I second this since I use the deprecated MultiHashMap and can&apos;t migrate my code since I need the serialization.&lt;/p&gt;</comment>
                            <comment id="12522194" author="bayard" created="Thu, 23 Aug 2007 16:53:50 +0000"  >&lt;p&gt;An easy change to make (obviously); but TestMultiHashMap doesn&apos;t extend AbstractTestMap and get the automatic Serialization testing, so need to either a) duplicate said testing or b) figure out how to make MultiHashMap fit the TestMap contract. 12 Failures and 4 errors for a simple try.&lt;/p&gt;</comment>
                            <comment id="12528351" author="alanmehio" created="Tue, 18 Sep 2007 11:02:15 +0000"  >&lt;p&gt;I found a bug in the in the method below from a related  test class; however, this has been fixed in the latest svn at &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/viewvc/commons/proper/collections/trunk/src/java/org/apache/commons/collections/map/MultiValueMap.java?revision=560660&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/commons/proper/collections/trunk/src/java/org/apache/commons/collections/map/MultiValueMap.java?revision=560660&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;public boolean putAll(Object key, Collection values) {&lt;/p&gt;

&lt;p&gt;   if (coll.size() &amp;gt; 0) &lt;/p&gt;
{

                 coll = createCollection(values.size()); 
                 boolean result = coll.addAll(values);
                // only add if non-zero size to maintain class state
                getMap().put(key, coll);
                result = false;  // here  should be true since collection has been changed 
                // returns true for a none zero one 
            }
&lt;p&gt;            return result;&lt;br/&gt;
}&lt;/p&gt;


&lt;p&gt;Another issue which  I have noticed is the code line &lt;br/&gt;
 coll = createCollection(values.size());  &lt;/p&gt;

&lt;p&gt;the method  &lt;br/&gt;
 protected Collection createCollection(int size) &lt;/p&gt;
{
        return (Collection) collectionFactory.create();
    }

&lt;p&gt;does not use the  &quot;size&quot;;  I am guessing the method signature is left because of backward compatibility&lt;/p&gt;

&lt;p&gt;It would be nice it we can create the correct size for the ArrayList instead of the default one which is 10 &lt;br/&gt;
when we add the collection to the newly created ArrrayList  as below&lt;/p&gt;

&lt;p&gt;coll = createCollection(values.size()); &lt;br/&gt;
                 boolean result = coll.addAll(values);&lt;/p&gt;

&lt;p&gt;this will give better code optimization &lt;/p&gt;




&lt;p&gt;I think MultiValueMap should implement Serializable ( can be serialized)&lt;/p&gt;


&lt;p&gt;Regards,&lt;br/&gt;
Alan Mehio&lt;/p&gt;
</comment>
                            <comment id="12529387" author="alanmehio" created="Fri, 21 Sep 2007 11:29:08 +0000"  >&lt;p&gt;&amp;lt;quoted-statemen&amp;gt;&lt;br/&gt;
It would be nice it we can create the correct size for the ArrayList instead of the default one which is 10 &lt;br/&gt;
&amp;lt;/quoted-statement&amp;gt;&lt;/p&gt;


&lt;p&gt;This will not optimize the code since the ArrayList ; please refere to the below methods in the ArrayList based on &lt;br/&gt;
the constructor with empty array size i.e new ArrayList();&lt;/p&gt;

&lt;p&gt; public boolean addAll(Collection&amp;lt;? extends E&amp;gt; c) &lt;/p&gt;
{
	Object[] a = c.toArray();
        int numNew = a.length;
	ensureCapacity(size + numNew);  // Increments modCount
        System.arraycopy(a, 0, elementData, size, numNew);
        size += numNew;
	return numNew != 0;
    }
&lt;p&gt; &lt;/p&gt;


&lt;p&gt;public boolean add(E o) &lt;/p&gt;
{
	ensureCapacity(size + 1);  // Increments modCount!!
	elementData[size++] = o;
	return true;
    }


&lt;p&gt; public void ensureCapacity(int minCapacity) {&lt;br/&gt;
	modCount++;&lt;br/&gt;
	int oldCapacity = elementData.length;&lt;br/&gt;
	if (minCapacity &amp;gt; oldCapacity) &lt;/p&gt;
{ 
	    Object oldData[] = elementData;
	    int newCapacity = (oldCapacity * 3)/2 + 1;
    	    if (newCapacity &amp;lt; minCapacity)
		newCapacity = minCapacity;
	    elementData = (E[])new Object[newCapacity];
	    System.arraycopy(oldData, 0, elementData, 0, size);
	}
&lt;p&gt;    }&lt;/p&gt;



&lt;p&gt;Cheers&lt;br/&gt;
Alan Mehio&lt;br/&gt;
London, UK&lt;/p&gt;
</comment>
                            <comment id="12545686" author="joerg.heinicke@gmx.de" created="Tue, 27 Nov 2007 02:20:30 +0000"  >&lt;p&gt;The Cocoon team had to revert back code changes to MultiHashMap due to missing serializability as mentioned in the linked issue. This issue seems to bug a lot of people &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;PS: Alan, please write up new logs for your findings instead of reusing this one since it is really only about implementing Serializable.&lt;/p&gt;</comment>
                            <comment id="12545731" author="wouterv" created="Tue, 27 Nov 2007 07:01:04 +0000"  >&lt;p&gt;I think it is time this bug receives the attention it needs (see the cocoon issues) &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12579309" author="bayard" created="Mon, 17 Mar 2008 05:28:43 +0000"  >&lt;p&gt;I&apos;ve started work on this. Here is the current state.&lt;/p&gt;

&lt;p&gt;The fullCollection obj file is presumably bad as I&apos;m making no effort to fill it. There are 11 failures and 3 errors. &lt;/p&gt;

&lt;p&gt;The failures are generally due to hashCodes not matching before and after serialization - I think. The errors are NullPointerExceptions.&lt;/p&gt;

&lt;p&gt;It&apos;s a start &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12587756" author="davemeikle" created="Thu, 10 Apr 2008 19:14:21 +0000"  >&lt;p&gt;Most of the errors are down to the hashCode being different. This is because the MultiValueMap in the test is wrapping values up in an ArrayList where as the comparison map is expecting the raw value.&lt;/p&gt;

&lt;p&gt;I am trying to use the existing base test to correct this by means of overriding some methods to some success but have been hit by a laptop screen failure! Will get the code of and see where I get too.&lt;/p&gt;

&lt;p&gt;Dave&lt;/p&gt;</comment>
                            <comment id="12597369" author="bayard" created="Fri, 16 May 2008 07:28:42 +0000"  >&lt;p&gt;Right. First step is getting MultiValueMap on the test structure. That has 11 errors; regardless of serialization being used. So either a) that gets fixed, or b) just write a different bit of serialization testing. Very tempted by the latter by this stage.&lt;/p&gt;</comment>
                            <comment id="12597378" author="bayard" created="Fri, 16 May 2008 08:11:23 +0000"  >&lt;p&gt;I&apos;ve gone ahead and made MultiValueMap serializable:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/viewvc?view=rev&amp;amp;revision=656960&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?view=rev&amp;amp;revision=656960&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Any review would be very welcome. &lt;/p&gt;</comment>
                            <comment id="12599288" author="bayard" created="Fri, 23 May 2008 06:45:21 +0000"  >&lt;p&gt;No comments - closing as fixed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12383280">COCOON-2151</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12382216">COCOON-2146</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12378019" name="COLLECTIONS-240.patch" size="3609" author="bayard" created="Mon, 17 Mar 2008 05:28:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 3 May 2007 19:38:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18759</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 27 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0seq7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>163862</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>