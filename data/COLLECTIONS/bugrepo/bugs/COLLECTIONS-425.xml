<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Nov 19 22:59:27 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/COLLECTIONS-425/COLLECTIONS-425.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[COLLECTIONS-425] performance problem in ListOrderedMap.remove()</title>
                <link>https://issues.apache.org/jira/browse/COLLECTIONS-425</link>
                <project id="12310465" key="COLLECTIONS">Commons Collections</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I am encountering a performance problem in ListOrderedMap.remove().&lt;br/&gt;
It appears in version 3.2.1 and also in revision 1365132.  I attached&lt;br/&gt;
a test that exposes this problem and a simple patch that fixes it.  On&lt;br/&gt;
my machine, for this test, the patch provides a 213X speedup.&lt;/p&gt;

&lt;p&gt;To run the test, just do:&lt;/p&gt;

&lt;p&gt;$ java Test&lt;/p&gt;

&lt;p&gt;The output for the un-patched version is:&lt;br/&gt;
Time is 1497&lt;/p&gt;

&lt;p&gt;The output for the patched version is:&lt;br/&gt;
Time is 7&lt;/p&gt;

&lt;p&gt;The patch changes the &quot;ListOrderedMap.remove(Object key)&quot; code from:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; result = getMap().remove(key);
insertOrder.remove(key);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;to:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (decorated().containsKey(key)) {
    result = decorated().remove(key);
    insertOrder.remove(key);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If &quot;decorated()&quot; does not contain the key, there is no need to remove&lt;br/&gt;
it.  This change significantly speeds up the code by avoiding the call&lt;br/&gt;
to &quot;insertOrder.remove(key)&quot;, which is very expensive because&lt;br/&gt;
&quot;insertOrder&quot; is an ArrayList, and removing from an ArrayList is a&lt;br/&gt;
linear time operation.&lt;/p&gt;

&lt;p&gt;It may appear that the check &quot;if (decorated().containsKey(key))&quot; may&lt;br/&gt;
slow down the code when &quot;decorated()&quot; contains the key, because it&lt;br/&gt;
adds a new operation &quot;decorated().containsKey(key)&quot;, without avoiding&lt;br/&gt;
the calls to &quot;getMap().remove(key)&quot; and &quot;insertOrder.remove(key)&quot;.&lt;/p&gt;

&lt;p&gt;I attached a test, TestWorstCase.java, that show that, even when&lt;br/&gt;
removing only existing keys (i.e., &quot;decorated().containsKey(key)&quot;&lt;br/&gt;
always returns &quot;true&quot;), the patched version takes almost the same time&lt;br/&gt;
as the un-patched version.&lt;/p&gt;

&lt;p&gt;To run TestWorstCase, just do:&lt;/p&gt;

&lt;p&gt;$ java TestWorstCase&lt;/p&gt;

&lt;p&gt;The output for the un-patched version for TestWorstCase is:&lt;br/&gt;
Time is 96&lt;/p&gt;

&lt;p&gt;The output for the patched version for TestWorstCase is:&lt;br/&gt;
Time is 97&lt;/p&gt;

&lt;p&gt;The reason why the patch does not slow down the code, even for this&lt;br/&gt;
worst case, is because &quot;decorated().containsKey(key)&quot; is a&lt;br/&gt;
&quot;containsKey()&quot; on a HashMap (very fast, constant time operation),&lt;br/&gt;
whereas &quot;insertOrder.remove(key);&quot; is a &quot;remove()&quot; on an ArrayList&lt;br/&gt;
(very slow, linear time operation).  So the time taken by&lt;br/&gt;
&quot;decorated().containsKey(key)&quot; is negligible compared to the time&lt;br/&gt;
taken by &quot;insertOrder.remove(key);&quot;.  In other words, most of the time&lt;br/&gt;
is spent inside &quot;insertOrder.remove(key)&quot;, and performing one&lt;br/&gt;
additional fast operation cannot be noticed.&lt;/p&gt;

&lt;p&gt;Is this truly a bug? If so, can you please confirm if the patch is&lt;br/&gt;
correct?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Adrian&lt;/p&gt;</description>
                <environment>&lt;p&gt;java 1.6.0_24&lt;br/&gt;
Ubuntu 11.10&lt;/p&gt;</environment>
        <key id="12600047">COLLECTIONS-425</key>
            <summary>performance problem in ListOrderedMap.remove()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="adriannistor">Adrian Nistor</reporter>
                        <labels>
                    </labels>
                <created>Tue, 24 Jul 2012 18:15:42 +0000</created>
                <updated>Sun, 9 Nov 2014 14:31:43 +0000</updated>
                            <resolved>Wed, 25 Jul 2012 21:15:28 +0000</resolved>
                                    <version>3.2.1</version>
                                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13422620" author="tn" created="Wed, 25 Jul 2012 21:15:28 +0000"  >&lt;p&gt;Fixed in r1365749. Thanks for the report and patch!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12537722" name="Test.java" size="732" author="adriannistor" created="Tue, 24 Jul 2012 18:15:59 +0000"/>
                            <attachment id="12537723" name="TestWorstCase.java" size="736" author="adriannistor" created="Tue, 24 Jul 2012 18:15:59 +0000"/>
                            <attachment id="12537721" name="patch.diff" size="664" author="adriannistor" created="Tue, 24 Jul 2012 18:15:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 25 Jul 2012 21:15:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>292941</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 17 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0shov:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164343</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>