<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun Nov 20 01:46:49 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/COLLECTIONS-237/COLLECTIONS-237.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[COLLECTIONS-237] MultiValueMap: behavior of entrySet().iterator() is not the expected one</title>
                <link>https://issues.apache.org/jira/browse/COLLECTIONS-237</link>
                <project id="12310465" key="COLLECTIONS">Commons Collections</project>
                    <description>&lt;p&gt;The entrySet() method of the MultiValueMap delegates the entrySet() call to the decorated map, which is HashMap by default. The default hashmap iterator is used, which causes the iterator to return one Map.Entry for every key. The value returned for the key is an ArrayList, and not the value of the entry which was put into the map.&lt;/p&gt;

&lt;p&gt;The expected behavior would be the iterator to return the whole set of entries in the map, which requires iteration over the different array lists contained in the decorated map.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12358457">COLLECTIONS-237</key>
            <summary>MultiValueMap: behavior of entrySet().iterator() is not the expected one</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="nika">Nils Kaiser</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Dec 2006 18:09:44 +0000</created>
                <updated>Sun, 9 Nov 2014 14:31:42 +0000</updated>
                            <resolved>Sat, 27 Apr 2013 11:09:45 +0000</resolved>
                                    <version>3.2</version>
                                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Map</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12457899" author="bayard" created="Tue, 12 Dec 2006 21:57:18 +0000"  >
&lt;p&gt;Given that we flatten values(), it makes a lot of sense to return a flattened entrySet() and not an unflattened one; however entrySet() returns a Set which to me implies that there should not be a duplicated key,value pair. MultiValueMap doesn&apos;t stop the value having dupes so it&apos;s entirely possible.&lt;/p&gt;

&lt;p&gt;So, that seems that either:&lt;/p&gt;

&lt;p&gt;1/ We define entrySet as matching keySet and mark this issue WONTFIX.&lt;br/&gt;
2/ We define entrySet as matching values and make sure our Map.Entry classes do not equal each other.&lt;br/&gt;
3/ We define entrySet as matching unique key-values pairs - so that:&lt;/p&gt;

&lt;p&gt;keySet().size() &amp;lt;= entrySet().size() &amp;lt;= values().size()&lt;/p&gt;

&lt;p&gt;Anyone have thoughts on which should be done?&lt;/p&gt;

&lt;p&gt;Bear in mind that 2+3 both involve backwards compat issues if people are expecting 1.&lt;/p&gt;</comment>
                            <comment id="12529378" author="alanmehio" created="Fri, 21 Sep 2007 11:10:25 +0000"  >&lt;p&gt;&amp;lt;quoted-statement&amp;gt;&lt;br/&gt;
The value returned for the key is an ArrayList, and not the value of the entry which was put into the map&lt;br/&gt;
&amp;lt;/quoted-statement&amp;gt;&lt;br/&gt;
What if we overload the method below &lt;/p&gt;

&lt;p&gt;public Iterator iterator(Object key) &lt;/p&gt;

&lt;p&gt;with &lt;/p&gt;

&lt;p&gt;   public Iterator iterator() &lt;/p&gt;
{
       return getMap().entrySet().iterator();
    }


&lt;p&gt;otherwise I am in favour of point one &lt;br/&gt;
&amp;lt;point-one&amp;gt;&lt;br/&gt;
1/ We define entrySet as matching keySet and mark this issue WONTFIX.&lt;br/&gt;
&amp;lt;/point-one&amp;gt;&lt;/p&gt;


&lt;p&gt;Regards,&lt;br/&gt;
Alan Mehio&lt;br/&gt;
London, UK&lt;/p&gt;


</comment>
                            <comment id="12580251" author="bayard" created="Wed, 19 Mar 2008 06:49:42 +0000"  >&lt;p&gt;+1 to the iterator() idea. Needs to be coded up with unit test for anyone that wants to dive in.&lt;/p&gt;</comment>
                            <comment id="12596280" author="bayard" created="Tue, 13 May 2008 05:12:24 +0000"  >&lt;p&gt;#1 gets the vote. On iterator....&lt;/p&gt;

&lt;p&gt;Shouldn&apos;t the iterator() be returning a flattened iteration of values from all of the contained ArrayLists; and also be generating ConcurrentModificationException in some fun way?&lt;/p&gt;

&lt;p&gt;I don&apos;t think this will be simple to implement, so pushing up to 3.4.&lt;/p&gt;</comment>
                            <comment id="12597364" author="bayard" created="Fri, 16 May 2008 06:22:04 +0000"  >&lt;p&gt;Ironically, this is the same bug that causes errors with the serialization tests in &lt;a href=&quot;https://issues.apache.org/jira/browse/COLLECTIONS-240&quot; title=&quot;MultiValueMap should implement Serializable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COLLECTIONS-240&quot;&gt;&lt;del&gt;COLLECTIONS-240&lt;/del&gt;&lt;/a&gt;. containsAll fails because the elements are now all inside arraylists.&lt;/p&gt;</comment>
                            <comment id="12928440" author="modsiw" created="Fri, 5 Nov 2010 00:46:52 +0000"  >&lt;p&gt;I have a possible solution (perhaps unacceptable) that was coded for in-house use.&lt;/p&gt;

&lt;p&gt;In this solution, MultiMap.entrySet returns a flattened &quot;set&quot; that violates the general contract of set by allowing two Entry that are .equals . It behaves as an IdentitySet, similar to th keys of java.util.IdentityHashMap .&lt;/p&gt;

&lt;p&gt;Another note is that the set supports .remove and if all values for a key are removed, the key is also removed. I&apos;m unsure if the removal of the key is desired. It would be trivial to change.&lt;/p&gt;

&lt;p&gt;If this solution is desired for the library, I&apos;ll work it up as a proper patch.&lt;/p&gt;</comment>
                            <comment id="13643628" author="tn" created="Sat, 27 Apr 2013 11:09:45 +0000"  >&lt;p&gt;In r1476553, I have implemented the #iterator() method as suggested and clarified the javadoc for #entrySet().&lt;/p&gt;

&lt;p&gt;The Map.Entry objects returned by iterator() do not support setValue(Object), but I guess this is ok for now.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 12 Dec 2006 21:57:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18762</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 30 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ftk7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90387</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>