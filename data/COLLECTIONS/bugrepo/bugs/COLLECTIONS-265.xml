<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Nov 19 20:56:34 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/COLLECTIONS-265/COLLECTIONS-265.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[COLLECTIONS-265] TreeBag allows uncomparable item to be added, breaking toString</title>
                <link>https://issues.apache.org/jira/browse/COLLECTIONS-265</link>
                <project id="12310465" key="COLLECTIONS">Commons Collections</project>
                    <description>&lt;p&gt;The following code throws an exception not when the Object is added, but when toString is called:&lt;/p&gt;

&lt;p&gt;		TreeBag bag = new TreeBag();&lt;br/&gt;
		bag.add(new Object());&lt;br/&gt;
		bag.toString();&lt;/p&gt;

&lt;p&gt;Trace:&lt;/p&gt;

&lt;p&gt;java.lang.ClassCastException: java.lang.Object&lt;br/&gt;
	at java.util.TreeMap.compare(TreeMap.java:1093)&lt;br/&gt;
	at java.util.TreeMap.getEntry(TreeMap.java:347)&lt;br/&gt;
	at java.util.TreeMap.get(TreeMap.java:265)&lt;br/&gt;
	at org.apache.commons.collections.bag.AbstractMapBag.getCount(AbstractMapBag.java:116)&lt;br/&gt;
	at org.apache.commons.collections.bag.AbstractMapBag.toString(AbstractMapBag.java:581)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;In a client program, toString should never throw an exception--it makes debugging much harder, for one thing.  I believe that TreeBag should defend against the addition of uncomparable objects, so that toString will never throw an exception.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12377915">COLLECTIONS-265</key>
            <summary>TreeBag allows uncomparable item to be added, breaking toString</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dsaff">David Saff</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Sep 2007 19:38:09 +0000</created>
                <updated>Sun, 9 Nov 2014 14:31:37 +0000</updated>
                            <resolved>Thu, 28 Feb 2013 20:04:25 +0000</resolved>
                                    <version>3.2</version>
                                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Bag</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12526455" author="bayard" created="Tue, 11 Sep 2007 13:35:34 +0000"  >&lt;p&gt;Maybe the solution is to change the toString so it doesn&apos;t try to get the count of the object if not comparable.&lt;/p&gt;

&lt;p&gt;How would that be?&lt;/p&gt;

&lt;p&gt;Could just be &quot;Not a Comparable:java.lang.Object@47b480&quot; or something.&lt;/p&gt;</comment>
                            <comment id="12526543" author="dsaff" created="Tue, 11 Sep 2007 18:09:44 +0000"  >&lt;p&gt;It would prevent the exception, but I can think of two other possibilities that seem more orthogonal to existing functionality:&lt;/p&gt;

&lt;p&gt;1) A java.util.TreeSet will hold a single uncomparable element, and treat it the same as a single comparable element, until a second element is added.  TreeBag could do the same.  &lt;br/&gt;
2) Or, TreeBag could gripe on add, just like both TreeBag and TreeSet do on the addition of a second incomparable object:&lt;/p&gt;

&lt;p&gt;		TreeBag bag = new TreeBag();&lt;br/&gt;
		Object object = new Object();&lt;br/&gt;
		bag.add(object);&lt;br/&gt;
		bag.add(object);  // exception thrown here&lt;/p&gt;
</comment>
                            <comment id="12528607" author="bayard" created="Tue, 18 Sep 2007 23:19:56 +0000"  >&lt;p&gt;Sorry for the delay David.&lt;/p&gt;

&lt;p&gt;For 2) doesn&apos;t seem like it would stop the exception - toString dies when one object is added, not two?&lt;/p&gt;

&lt;p&gt;For 1), the idea is to have a TreeMap with the comparable data, and a single Object with the uncomparable? Then all methods would need to include the uncomparable object with the comparable when returning? &lt;/p&gt;</comment>
                            <comment id="12528762" author="dsaff" created="Wed, 19 Sep 2007 13:32:30 +0000"  >&lt;p&gt;I prefer #2, but stated it poorly.  I would prefer if the first add of an uncomparable Object raised an exception.  The example code above is the current, somewhat odd behavior: add accepts the object the first time, but rejects it the second.  I think it should reject it the first time for consistency.&lt;/p&gt;

&lt;p&gt;I agree that #1 is odd.  It is the de facto behavior of java.util.TreeSet: that&apos;s not terribly important to me, but if it is to the maintainers, TreeBag could follow the example.&lt;/p&gt;</comment>
                            <comment id="12529173" author="scolebourne" created="Thu, 20 Sep 2007 17:59:03 +0000"  >&lt;p&gt;I would prefer an &quot;instanceof Comparable&quot; check on each add().&lt;/p&gt;</comment>
                            <comment id="12557059" author="hdiwan" created="Tue, 8 Jan 2008 22:41:07 +0000"  >&lt;p&gt;adds the add method with the following semantics:&lt;/p&gt;

&lt;p&gt;public boolean add(Object o) {&lt;br/&gt;
   if (o instanceof Comparable) &lt;/p&gt;
{
      return super.add(o);
  }
&lt;p&gt;  else return false;&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;can this be committed asap as well?&lt;/p&gt;</comment>
                            <comment id="12579114" author="bayard" created="Sun, 16 Mar 2008 02:07:11 +0000"  >&lt;p&gt;Returning false because the object was not comparable is not the contract agreed on in the javadoc: &lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;@return &amp;lt;code&amp;gt;true&amp;lt;/code&amp;gt; if the object was not already in the &amp;lt;code&amp;gt;uniqueSet&amp;lt;/code&amp;gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Stephen - were you implying an Exception be thrown? ie) TreeBag will not allow any class that is not Comparable?&lt;/p&gt;</comment>
                            <comment id="12579182" author="scolebourne" created="Sun, 16 Mar 2008 10:38:57 +0000"  >&lt;p&gt;Yes, an exception on add() makes most sense. However, if there is a Comparator then the instanceof check should not happen.&lt;/p&gt;</comment>
                            <comment id="12579293" author="bayard" created="Mon, 17 Mar 2008 04:06:21 +0000"  >&lt;p&gt;Attaching a test/patch for comments.&lt;/p&gt;

&lt;p&gt;Throws an IllegalArgumentException if comparator() returns null and the object is not Comparable.&lt;/p&gt;</comment>
                            <comment id="12582135" author="bayard" created="Wed, 26 Mar 2008 06:07:20 +0000"  >&lt;p&gt;svn ci -m &quot;Applying my patch from &lt;a href=&quot;https://issues.apache.org/jira/browse/COLLECTIONS-265&quot; title=&quot;TreeBag allows uncomparable item to be added, breaking toString&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COLLECTIONS-265&quot;&gt;&lt;del&gt;COLLECTIONS-265&lt;/del&gt;&lt;/a&gt;. TreeBag no longer accepts non-Comparable classes when it naturally ordered (ie: no comparator has been set)&quot; src&lt;/p&gt;

&lt;p&gt;Sending        src/java/org/apache/commons/collections/TreeBag.java&lt;br/&gt;
Sending        src/java/org/apache/commons/collections/bag/TreeBag.java&lt;br/&gt;
Sending        src/test/org/apache/commons/collections/TestTreeBag.java&lt;br/&gt;
Sending        src/test/org/apache/commons/collections/bag/TestTreeBag.java&lt;br/&gt;
Transmitting file data ....&lt;br/&gt;
Committed revision 641166.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12378017" name="COLLECTIONS-265.patch" size="3166" author="bayard" created="Mon, 17 Mar 2008 04:06:21 +0000"/>
                            <attachment id="12372744" name="TreeBag.pat" size="610" author="hdiwan" created="Tue, 8 Jan 2008 22:41:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 11 Sep 2007 13:35:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18735</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 35 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0siev:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164460</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>