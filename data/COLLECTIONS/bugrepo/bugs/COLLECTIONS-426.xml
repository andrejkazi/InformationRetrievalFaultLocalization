<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Nov 19 23:01:31 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/COLLECTIONS-426/COLLECTIONS-426.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[COLLECTIONS-426] performance problem in ListOrderedSet.retainAll()</title>
                <link>https://issues.apache.org/jira/browse/COLLECTIONS-426</link>
                <project id="12310465" key="COLLECTIONS">Commons Collections</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I am encountering a performance problem in ListOrderedSet.retainAll().&lt;br/&gt;
It appears in version 3.2.1 and also in revision 1365132.  I attached&lt;br/&gt;
a test that exposes this problem and a patch that fixes it.  On my&lt;br/&gt;
machine, for this test, the patch provides a 263X speedup.&lt;/p&gt;

&lt;p&gt;To run the test, just do:&lt;/p&gt;

&lt;p&gt;$ java Test&lt;/p&gt;

&lt;p&gt;The output for the un-patched version is:&lt;br/&gt;
Time is 3682&lt;/p&gt;

&lt;p&gt;The output for the patched version is:&lt;br/&gt;
Time is 14&lt;/p&gt;

&lt;p&gt;The problem is that the code for method&lt;br/&gt;
&quot;ListOrderedSet.retainAll(Collection&amp;lt;?&amp;gt; coll)&quot; is:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; retainAll(Collection&amp;lt;?&amp;gt; coll) {
    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; result = collection.retainAll(coll);
....
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;because &quot;collection.retainAll(coll)&quot; has quadratic complexity if&lt;br/&gt;
parameter &quot;coll&quot; is a List.  Conceptually, the solution is to call&lt;br/&gt;
&quot;coll.retainAll(collection)&quot; which has linear complexity (not&lt;br/&gt;
quadratic), because &quot;collection&quot; is always a HashSet (we know this,&lt;br/&gt;
because &quot;collection&quot; is an inherited field of ListOrderedSet, and thus&lt;br/&gt;
cannot have another type).  See the&lt;br/&gt;
&quot;java.util.AbstractCollection.retainAll()&quot; code inlined below for why&lt;br/&gt;
one call has quadratic complexity, and the other has linear&lt;br/&gt;
complexity.&lt;/p&gt;

&lt;p&gt;Directly calling &quot;coll.retainAll(collection)&quot; would change the&lt;br/&gt;
behavior of ListOrderedSet.retainAll(), which is why the patch seems a&lt;br/&gt;
bit involved.  In reality, the patch simulates the behavior of&lt;br/&gt;
&quot;coll.retainAll(collection)&quot; (which is just the intersection of two&lt;br/&gt;
collections).  You can easily see this by looking at the patch and at&lt;br/&gt;
the &quot;java.util.AbstractCollection.retainAll()&quot; code inlined below.&lt;/p&gt;

&lt;p&gt;&quot;collection.retainAll(coll)&quot; is &quot;java.util.HashSet.retainAll()&quot;, which&lt;br/&gt;
is &quot;java.util.AbstractCollection.retainAll()&quot;, which has the code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; retainAll(Collection&amp;lt;?&amp;gt; c) {
    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; modified = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
    Iterator&amp;lt;E&amp;gt; e = iterator();
    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (e.hasNext()) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!c.contains(e.next())) {
            e.remove();
            modified = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
        }
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; modified;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 


&lt;p&gt;Is this a bug, or am I misunderstanding the intended behavior?  If so,&lt;br/&gt;
can you please confirm if the patch is correct?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Adrian&lt;/p&gt;</description>
                <environment>&lt;p&gt;java 1.6.0_24&lt;br/&gt;
Ubuntu 11.10&lt;/p&gt;</environment>
        <key id="12600077">COLLECTIONS-426</key>
            <summary>performance problem in ListOrderedSet.retainAll()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="adriannistor">Adrian Nistor</reporter>
                        <labels>
                    </labels>
                <created>Tue, 24 Jul 2012 22:04:01 +0000</created>
                <updated>Fri, 27 Nov 2015 21:11:16 +0000</updated>
                            <resolved>Tue, 27 Jan 2015 15:06:21 +0000</resolved>
                                    <version>3.2.1</version>
                                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                    <fixVersion>4.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="14290740" author="tn" created="Sat, 24 Jan 2015 18:06:54 +0000"  >&lt;p&gt;This fix is wrong imho and should be reverted for 4.1&lt;/p&gt;</comment>
                            <comment id="14290912" author="adriannistor" created="Sun, 25 Jan 2015 00:40:29 +0000"  >&lt;p&gt;Hi Thomas,&lt;/p&gt;

&lt;p&gt;Oh, ok.  Why is the fix wrong?  What is the bug in this fix?&lt;/p&gt;

&lt;p&gt;Best,&lt;/p&gt;

&lt;p&gt;Adrian&lt;/p&gt;</comment>
                            <comment id="14293655" author="tn" created="Tue, 27 Jan 2015 15:06:21 +0000"  >&lt;p&gt;Reverted the performance improvement and added clarifying javadoc wrt runtime complexity in r1655060.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12537758" name="Test.java" size="665" author="adriannistor" created="Tue, 24 Jul 2012 22:04:36 +0000"/>
                            <attachment id="12537757" name="patch.diff" size="1445" author="adriannistor" created="Tue, 24 Jul 2012 22:04:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 24 Jan 2015 18:06:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>255280</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0eqnr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>84081</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>