<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Thu Dec 22 21:38:23 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SPR-9098/SPR-9098.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SPR-9098] Decode URI variable values when UrlPathHelper.setUrlDecode() is set to false </title>
                <link>https://jira.spring.io/browse/SPR-9098</link>
                <project id="10000" key="SPR">Spring Framework</project>
                    <description>&lt;p&gt;Say I have a Controller with the following request mapping:&lt;/p&gt;

&lt;p&gt;@RequestMapping(value = &quot;/&lt;/p&gt;
{group}
&lt;p&gt;/&lt;/p&gt;
{identifier}
&lt;p&gt;&quot;, method = RequestMethod.GET)&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Current behavior:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;If one of the PathVariable components (e.g. &quot;identifier&quot; in the above example) contains a URL encoded slash (%2F), the handler is NOT invoked for that request, e.g.&lt;br/&gt;
&lt;a href=&quot;http://myhost/myservlet/group/a%2Fb&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://myhost/myservlet/group/a%2Fb&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Expected behavior:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;If one of the PathVariable comonents (e.g. &quot;identifier&quot; in the above example) contains a URL encoded slash (%2F), the handler is invoked for that request and the URL decoded value is assigned to the path variable, e.g. &lt;br/&gt;
&lt;a href=&quot;http://myhost/myservlet/group/a%2Fb&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://myhost/myservlet/group/a%2Fb&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;calls the handler method above with group=&quot;group&quot; and identifier=&quot;a/b&quot;&lt;/p&gt;


&lt;p&gt;This is supported by the RFC which assigns special meaning to the slash character and states a slash and a URL encoded slash are NOT the same character:&lt;/p&gt;

&lt;p&gt;RFC 3986 says (section 2.2) :&lt;br/&gt;
   The purpose of reserved characters is to provide a set of delimiting&lt;br/&gt;
   characters that are distinguishable from other data within a URI.&lt;br/&gt;
   URIs that differ in the replacement of a reserved character with its&lt;br/&gt;
   corresponding percent-encoded octet are not equivalent.  Percent-&lt;br/&gt;
   encoding a reserved character, or decoding a percent-encoded octet&lt;br/&gt;
   that corresponds to a reserved character, will change how the URI is&lt;br/&gt;
   interpreted by most applications.  Thus, characters in the reserved&lt;br/&gt;
   set are protected from normalization and are therefore safe to be&lt;br/&gt;
   used by scheme-specific and producer-specific algorithms for&lt;br/&gt;
   delimiting data subcomponents within a URI.&lt;/p&gt;


&lt;p&gt;The actual URL decoding happens in UrlPathHelper.getLookupPathForRequest which eventually calls getRequestUri which calls decodeAndCleanUriString. This is basically too early. First the handler should be chosen and the PathVariables assigned. Then URL decoding should happen on each of the path variables&apos; values.&lt;/p&gt;


&lt;p&gt;If desired I can write a unit test or include a sample Controller to reproduce the above.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Note:&lt;/b&gt; Tomcat MUST be started with the -Dorg.apache.tomcat.util.buf.UDecoder.ALLOW_ENCODED_SLASH=true option or the request will never even land at the Spring DispatcherServlet.&lt;/p&gt;</description>
            <key id="42143">SPR-9098</key>
            <summary>Decode URI variable values when UrlPathHelper.setUrlDecode() is set to false </summary>
                <type id="4" iconUrl="https://jira.spring.io/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Complete</resolution>
                                        <assignee username="rstoya05-aop">Rossen Stoyanchev</assignee>
                                    <reporter username="fransflippo">Frans Flippo</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Feb 2012 01:51:13 +0000</created>
                <updated>Tue, 29 Jan 2013 08:48:50 +0000</updated>
                            <resolved>Thu, 17 May 2012 13:05:50 +0000</resolved>
                                    <version>3.1 GA</version>
                                    <fixVersion>3.2 M1</fixVersion>
                                    <component>Web</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="75585" author="rstoya05-aop" created="Wed, 8 Feb 2012 06:28:35 +0000"  >&lt;p&gt;The default behavior is to decode the URL prior to mapping the request. You can use the setUrlDecode(boolean) property on AbstractHandlerMapping to change this behavior and basically not decode the URL, which should make the mapping in your example work but the extracted URI variables will still be encoded. For that you can overwrite RequestMappingInforHandlerMapping.handleMatch().&lt;/p&gt;</comment>
                            <comment id="75656" author="fransflippo" created="Thu, 9 Feb 2012 07:23:45 +0000"  >&lt;p&gt;OK, that&apos;s a workable workaround for my situation.&lt;/p&gt;

&lt;p&gt;However, wouldn&apos;t you agree the behavior I describe under &quot;Expected behavior&quot; should be the default, and that it would break very few installed code bases if implemented in Spring Web?&lt;/p&gt;

&lt;p&gt;The problem with the workaround is that now my Controller class needs to have knowledge of how the HandlerMapping is configured. If urlDecode is false, it should manually decode the PathVariables&apos; values, of urlDecode is true, it shouldn&apos;t. Not very elegant.&lt;/p&gt;</comment>
                            <comment id="75661" author="rstoya05-aop" created="Thu, 9 Feb 2012 10:02:28 +0000"  >&lt;p&gt;We can&apos;t change the default value of urlDecode so easily I am afraid. If switched from &quot;true&quot; to &quot;false&quot;, applications would need switch their mappings throughout from not encoded to encoded URL paths (the literal parts at least) &amp;#8211; e.g. from @RequestMapping(&quot;/foo bar&quot;) to @RequestMapping(&quot;/foo%20bar&quot;). I do agree that when set to false, we should probably decode the path variables. I would consider that an improvement.&lt;/p&gt;</comment>
                            <comment id="75662" author="rstoya05-aop" created="Thu, 9 Feb 2012 10:04:49 +0000"  >&lt;p&gt;Modified title (from: &quot;AbstractHandlerMethodMapping should not decode request path when finding handler but decode PathVariables individually later&quot;)&lt;/p&gt;</comment>
                            <comment id="78957" author="rstoya05-aop" created="Thu, 17 May 2012 13:05:42 +0000"  >&lt;p&gt;UrlPathHelper now includes an additional method for decoding URI path variables. It checks the urlDecode property and decodes only if false since that path (from which the variables were extracted) wouldn&apos;t have been decoded.&lt;/p&gt;</comment>
                            <comment id="87454" author="anthonygerrard" created="Tue, 29 Jan 2013 08:48:50 +0000"  >&lt;p&gt;I think this has changed the behaviour with regards to url path parameters.&lt;/p&gt;

&lt;p&gt;e.g. &lt;br/&gt;
@RequestMapping(&quot;/something&quot;)&lt;/p&gt;

&lt;p&gt;used to match&lt;br/&gt;
/something&lt;br/&gt;
and also&lt;br/&gt;
/something;else=true&lt;/p&gt;

&lt;p&gt;now you get a not found for the second request&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="30461">SPR-6951</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10180" key="com.atlassian.jira.toolkit:dayslastcommented">
                        <customfieldname>Days since last comment</customfieldname>
                        <customfieldvalues>
                                        3 years, 47 weeks, 2 days ago
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 8 Feb 2012 06:28:35 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10181" key="com.atlassian.jira.toolkit:lastusercommented">
                        <customfieldname>Last commented by a User</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>true</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10182" key="com.atlassian.jira.toolkit:lastupdaterorcommenter">
                        <customfieldname>Last updater</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>anthonygerrard</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i045q7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24302</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>