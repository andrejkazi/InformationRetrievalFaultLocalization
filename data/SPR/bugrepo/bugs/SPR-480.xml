<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Thu Dec 22 20:33:30 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SPR-480/SPR-480.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SPR-480] HibernateTransactionManager  and SQLExceptionTranslator</title>
                <link>https://jira.spring.io/browse/SPR-480</link>
                <project id="10000" key="SPR">Spring Framework</project>
                    <description>&lt;p&gt;According to SQLErrorCodesFactory (&lt;a href=&quot;http://www.springframework.org/docs/api/org/springframework/jdbc/support/SQLErrorCodesFactory.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.springframework.org/docs/api/org/springframework/jdbc/support/SQLErrorCodesFactory.html&lt;/a&gt;), when sql-error-codes.xml is found in the classpath, the error codes defined in that file will be used to translate SQLExceptions.&lt;/p&gt;

&lt;p&gt;However, it appears that HibernateTransactionManager has a bug that will prevent the use of this exception translator.  In the class definition, the getter method for SQLExceptionTranslator will create a SQLErrorCodeSQLExceptionTranslator if the HibernateTransactionManager is aware of a DataSource:&lt;/p&gt;

&lt;p&gt;/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Return the JDBC exception translator for this transaction manager.&lt;/li&gt;
	&lt;li&gt;Creates a default one for the specified SessionFactory if none set.&lt;br/&gt;
 */&lt;br/&gt;
public SQLExceptionTranslator getJdbcExceptionTranslator() {&lt;br/&gt;
  if (this.jdbcExceptionTranslator == null) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    if (getDataSource() != null) {
      setJdbcExceptionTranslator(new 
        SQLErrorCodeSQLExceptionTranslator(getDataSource()));
    }    else {
      setJdbcExceptionTranslator(
        SessionFactoryUtils.newJdbcExceptionTranslator(
        getSessionFactory()));
    }  }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;  return this.jdbcExceptionTranslator;&lt;br/&gt;
}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;However, in the class definition the translator is initialized when the class is created:&lt;/p&gt;

&lt;p&gt;private SQLExceptionTranslator jdbcExceptionTranslator = new SQLStateSQLExceptionTranslator();&lt;/p&gt;

&lt;p&gt;Therefore, the setter never gets a chance to create a translator to use the defined error codes; instead it always falls back to SQLStateSQLExceptionTranslator.&lt;/p&gt;

&lt;p&gt;I suspect that the fix for this bug is to simply initialize jdbcExceptionTranslator to null and let the getter method do its thing.  A workaround for now is to set jdbcExceptionTranslator to null in the xml configuration file so that it can be initialized correctly:&lt;/p&gt;

&lt;p&gt;&amp;lt;bean id=&quot;transactionManager&quot; &lt;br/&gt;
class=&quot;org.springframework.orm.hibernate.HibernateTransactionManager&quot;&amp;gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;property name=&quot;sessionFactory&quot;&amp;gt;&lt;br/&gt;
  &amp;lt;ref bean=&quot;sessionFactory&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;/property&amp;gt;&lt;br/&gt;
&amp;lt;property name=&quot;jdbcExceptionTranslator&quot;&amp;gt;&amp;lt;null/&amp;gt;&amp;lt;/property&amp;gt;&lt;br/&gt;
&amp;lt;/bean&amp;gt;&lt;/p&gt;</description>
            <key id="10765">SPR-480</key>
            <summary>HibernateTransactionManager  and SQLExceptionTranslator</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="juergen.hoeller">Juergen Hoeller</assignee>
                                    <reporter username="pperalta">Patrick Peralta</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Nov 2004 01:19:48 +0000</created>
                <updated>Tue, 23 Nov 2004 18:04:01 +0000</updated>
                            <resolved>Tue, 23 Nov 2004 18:04:01 +0000</resolved>
                                    <version>1.1.2</version>
                                    <fixVersion>1.1.3</fixVersion>
                                    <component>Data</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="11579" author="juergen.hoeller" created="Tue, 23 Nov 2004 18:04:01 +0000"  >&lt;p&gt;Indeed - don&apos;t know how that slipped in! I&apos;ve removed the default SQLExceptionTranslator instance. Thanks for spotting this!&lt;/p&gt;

&lt;p&gt;Juergen&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10180" key="com.atlassian.jira.toolkit:dayslastcommented">
                        <customfieldname>Days since last comment</customfieldname>
                        <customfieldvalues>
                                        12 years, 6 weeks, 2 days ago
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 23 Nov 2004 18:04:01 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10181" key="com.atlassian.jira.toolkit:lastusercommented">
                        <customfieldname>Last commented by a User</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>false</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10182" key="com.atlassian.jira.toolkit:lastupdaterorcommenter">
                        <customfieldname>Last updater</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>tmarshall</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i00zmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5817</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>