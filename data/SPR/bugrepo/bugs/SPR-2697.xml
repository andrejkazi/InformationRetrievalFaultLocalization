<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Thu Dec 22 20:44:33 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SPR-2697/SPR-2697.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SPR-2697] LocalSessionFactoryBean.buildSessionFactory call to updateDatabaseSchema always fails in Spring 2.0 final</title>
                <link>https://jira.spring.io/browse/SPR-2697</link>
                <project id="10000" key="SPR">Spring Framework</project>
                    <description>&lt;p&gt;Just upgraded from 2.0-RC2 to 2.0-Final. The refactoring of LocalSessionFactoryBean to introduce an Abstract baseclass seems to have broken the call to updateDatabaseSchema on initialisation. This means that setting schemaUpdate to true always causes a failure on startup.&lt;/p&gt;

&lt;p&gt;Previously the SessionFactory was created entirely within the afterPropertiesSet method, at the end of which updateDatabaseSchema was called.&lt;/p&gt;

&lt;p&gt;However, now the behaviour is as follows:&lt;/p&gt;

&lt;p&gt;AbstractSessionFactoryBean:&lt;br/&gt;
	public void afterPropertiesSet() throws Exception &lt;/p&gt;
{
		SessionFactory rawSf = buildSessionFactory();
		this.sessionFactory = wrapSessionFactoryIfNecessary(rawSf);
	}

&lt;p&gt;LocalSessionFactoryBean:&lt;br/&gt;
	protected SessionFactory buildSessionFactory() throws Exception {&lt;br/&gt;
		SessionFactory sf = null;&lt;/p&gt;

&lt;p&gt;                ...&lt;/p&gt;

&lt;p&gt;		// Execute schema update if requested.&lt;br/&gt;
		if (this.schemaUpdate) &lt;/p&gt;
{
			updateDatabaseSchema();
		}

&lt;p&gt;		return sf;&lt;br/&gt;
	}&lt;/p&gt;

&lt;p&gt;LocalSessionFactoryBean:&lt;br/&gt;
	public void updateDatabaseSchema() throws DataAccessException &lt;/p&gt;
{
		logger.info(&quot;Updating database schema for Hibernate SessionFactory&quot;);
		HibernateTemplate hibernateTemplate = new HibernateTemplate(getSessionFactory());
                ...
	}

&lt;p&gt;AbstractSessionFactoryBean:&lt;br/&gt;
	protected final SessionFactory getSessionFactory() {&lt;br/&gt;
		if (this.sessionFactory == null) &lt;/p&gt;
{
			throw new IllegalStateException(&quot;SessionFactory not initialized yet&quot;);
		}
&lt;p&gt;		return this.sessionFactory;&lt;br/&gt;
	}&lt;/p&gt;

&lt;p&gt;At which point an &quot;java.lang.IllegalStateException: SessionFactory not initialized yet&quot; is thrown every time. This is because the call to getSessionFactory() happens as part of updatedDatabaseSchema(), which is called from buildSessionFactory() - which has not yet returned, and therefore the sessionFactory has not been assigned yet. Possibly the sessionFactory &quot;sf&quot; in the buildSessionFactory method should be passed as an argument to updateDatabaseSchema.&lt;/p&gt;
</description>
            <key id="15171">SPR-2697</key>
            <summary>LocalSessionFactoryBean.buildSessionFactory call to updateDatabaseSchema always fails in Spring 2.0 final</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://jira.spring.io/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dhewitt">David Hewitt</reporter>
                        <labels>
                    </labels>
                <created>Sun, 8 Oct 2006 22:28:18 +0000</created>
                <updated>Sun, 8 Oct 2006 22:44:55 +0000</updated>
                            <resolved>Sun, 8 Oct 2006 22:44:55 +0000</resolved>
                                    <version>2.0 final</version>
                                                    <component>Data</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="20168" author="dhewitt" created="Sun, 8 Oct 2006 22:34:58 +0000"  >&lt;p&gt;Note - just seen this is fixed in the CVS HEAD.&lt;/p&gt;</comment>
                            <comment id="20169" author="dhewitt" created="Sun, 8 Oct 2006 22:37:12 +0000"  >&lt;p&gt;Also just seen this is a dupicate of &lt;a href=&quot;https://jira.spring.io/browse/SPR-2669&quot; title=&quot;LocalSessionFactoryBean initialization fails with  &amp;quot;java.lang.IllegalStateException: SessionFactory not initialized yet &amp;quot; when schemaUpdate is set to true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPR-2669&quot;&gt;&lt;del&gt;SPR-2669&lt;/del&gt;&lt;/a&gt;. Don&apos;t know why I didn&apos;t spot that one before - please close as duplicate.&lt;/p&gt;</comment>
                            <comment id="20170" author="springboy" created="Sun, 8 Oct 2006 22:44:55 +0000"  >&lt;p&gt;Closed as duplicate at user request.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10180" key="com.atlassian.jira.toolkit:dayslastcommented">
                        <customfieldname>Days since last comment</customfieldname>
                        <customfieldvalues>
                                        10 years, 12 weeks, 3 days ago
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 8 Oct 2006 22:44:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10181" key="com.atlassian.jira.toolkit:lastusercommented">
                        <customfieldname>Last commented by a User</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>false</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10182" key="com.atlassian.jira.toolkit:lastupdaterorcommenter">
                        <customfieldname>Last updater</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>tmarshall</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01efj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8215</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>