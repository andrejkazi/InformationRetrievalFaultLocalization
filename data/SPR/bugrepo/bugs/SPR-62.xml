<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Thu Dec 22 20:08:49 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SPR-62/SPR-62.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SPR-62] Error in constructor resolving algorithm</title>
                <link>https://jira.spring.io/browse/SPR-62</link>
                <project id="10000" key="SPR">Spring Framework</project>
                    <description>&lt;p&gt;I encountered a problem with the constructor resolution based on indices. I have a bean configured via a DefaultListableBeanFactory from an XML file. The bean provides two constructors and configuration fails due to selecting the wrong constructor (in spite of using the index attributes).&lt;/p&gt;

&lt;p&gt;The simplified scenario is as following:&lt;/p&gt;

&lt;p&gt;--------------------&lt;br/&gt;
class P1 {}&lt;/p&gt;

&lt;p&gt;class P2 extends P1 {}&lt;/p&gt;


&lt;p&gt;class MyBean {&lt;br/&gt;
  public MyBean(int i, String s) {} // Ctor1&lt;/p&gt;

&lt;p&gt;  public MyBean(int i, P1 p) {}  // Ctor2&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;--------------------&lt;/p&gt;

&lt;p&gt;The configuration looks like this:&lt;/p&gt;

&lt;p&gt;&amp;lt;bean id=&quot;MyBean&quot; class=&quot;MyBean&quot;&amp;gt;&lt;br/&gt;
  &amp;lt;constructor-arg index=&quot;0&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;value&amp;gt;42&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;/constructor-arg&amp;gt;&lt;/p&gt;

&lt;p&gt;  &amp;lt;constructor-arg index=&quot;1&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;ref local=&quot;PBean&quot;/&amp;gt;&lt;br/&gt;
  &amp;lt;/constructor-arg&amp;gt;&lt;br/&gt;
&amp;lt;/bean&amp;gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;bean id=&quot;PBean&quot; class=&quot;P2&quot;&amp;gt;&lt;br/&gt;
&amp;lt;/bean&amp;gt;&lt;/p&gt;

&lt;p&gt;--------------------&lt;/p&gt;

&lt;p&gt;I debugged the configuration and found an explanation for the erroneous behaviour in the Method DefaultListableBeanFactory#autowireConstructor(String beanName, RootBeanDefinition mergedBeanDefinition);&lt;/p&gt;

&lt;p&gt;As I saw, for each constructor an argument list is being created. In that step conversions are applied as applicable (BeanWrapperImpl#doTypeConversionIfNecessary). In case of Ctor1 the second argument cannot be converted (P2 -&amp;gt; String) and is left as is. In the case of Ctor2 a conversion is not necessary.&lt;/p&gt;

&lt;p&gt;Afterwards in the Method DefaultListableBeanFactory#getTypeDifferenceWeight the conversion from P2 -&amp;gt; String is assumed to be better than the conversion P2 -&amp;gt; P1. So the wrong constructor will be chosen.&lt;/p&gt;

&lt;p&gt;I see two possible solutions: Either discard Ctor1 if the argument conversion cannot be applied on building the argument list, or modify the weight calculation for the case, that a type does not match at all.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Andreas&lt;/p&gt;

</description>
            <key id="10170">SPR-62</key>
            <summary>Error in constructor resolving algorithm</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="juergen.hoeller">Juergen Hoeller</assignee>
                                    <reporter username="asenft">Andreas Senft</reporter>
                        <labels>
                    </labels>
                <created>Thu, 4 Mar 2004 01:47:31 +0000</created>
                <updated>Mon, 8 Mar 2004 03:57:04 +0000</updated>
                            <resolved>Mon, 8 Mar 2004 03:57:04 +0000</resolved>
                                    <version>1.0 RC2</version>
                                    <fixVersion>1.0 final</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="10197" author="juergen.hoeller" created="Mon, 8 Mar 2004 03:57:04 +0000"  >&lt;p&gt;Thanks for the report - I&apos;ve just fixed the type difference weight algorithm to correctly ignore non-matching arguments (and explictly check for matching values for primitive types). Juergen&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10180" key="com.atlassian.jira.toolkit:dayslastcommented">
                        <customfieldname>Days since last comment</customfieldname>
                        <customfieldvalues>
                                        12 years, 43 weeks, 3 days ago
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 8 Mar 2004 03:57:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10181" key="com.atlassian.jira.toolkit:lastusercommented">
                        <customfieldname>Last commented by a User</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>false</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10182" key="com.atlassian.jira.toolkit:lastupdaterorcommenter">
                        <customfieldname>Last updater</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>tmarshall</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i04yq7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29000</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>