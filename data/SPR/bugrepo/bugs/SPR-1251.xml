<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Thu Dec 22 19:59:48 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SPR-1251/SPR-1251.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SPR-1251] Auto proxy with optimize flag set to true results in advice not being executed</title>
                <link>https://jira.spring.io/browse/SPR-1251</link>
                <project id="10000" key="SPR">Spring Framework</project>
                    <description>&lt;p&gt;When configuring auto proxying with optimize set to true advice is not executed. If the opmptize property is set to false and JDK proxies are used then advice is executed. &lt;/p&gt;

&lt;p&gt;I have debuged the application and confirmed that the cglib proxies are being created for the class and in fact are being accessed at runtime for the methods defined in the pointcut. However, the advice is not executed, specifically the invoke method is not called on the MethodInterceptor.&lt;/p&gt;

&lt;p&gt;Attached is the spring config with the aop configuration and the MethodInterceptor implementation in question. &lt;/p&gt;</description>
            <key id="12271">SPR-1251</key>
            <summary>Auto proxy with optimize flag set to true results in advice not being executed</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://jira.spring.io/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="robh">Rob Harrop</assignee>
                                    <reporter username="mlesk">Mark Lesk</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Aug 2005 01:07:53 +0000</created>
                <updated>Tue, 19 Jun 2012 03:54:22 +0000</updated>
                            <resolved>Sun, 11 Sep 2005 21:34:23 +0000</resolved>
                                    <version>1.2.1</version>
                                    <fixVersion>1.2.5</fixVersion>
                                    <component>Core:AOP</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="14464" author="mlesk" created="Wed, 24 Aug 2005 01:08:56 +0000"  >&lt;p&gt;Config of auto proxy with optimize = true&lt;/p&gt;</comment>
                            <comment id="14465" author="mlesk" created="Wed, 24 Aug 2005 01:12:15 +0000"  >&lt;p&gt;Ignore the first file attached it was the wrong file and is in RTF. This is the correct file as simple text and has optimize set to true&lt;/p&gt;</comment>
                            <comment id="14467" author="mlesk" created="Wed, 24 Aug 2005 01:23:48 +0000"  >&lt;p&gt;Advice that is not being executed&lt;/p&gt;</comment>
                            <comment id="14468" author="mlesk" created="Wed, 24 Aug 2005 01:33:08 +0000"  >&lt;p&gt;I will create and post a simple test scenerio to execute that will demonstrate this problem in the next day. Maybe doing this will let me resolve it myself or determine that it is just my limited knowledge of cglib and is not a bug at all.&lt;/p&gt;</comment>
                            <comment id="14666" author="robh" created="Sun, 11 Sep 2005 21:34:23 +0000"  >&lt;p&gt;The issue here relates to how Regex matching works for the different proxy types. When matching on JDK proxies it is matching against the methods as defined in the interface and when matching against CGLIB proxies it is matching against the method as defined in the class. So, in your example the patterns are written in terms of the interface (the I prefix) but the matching will be against the class (without the I prefix I assume). To match on both you can use a pattern such as this:&lt;/p&gt;

&lt;p&gt;.&lt;b&gt;beans.I?TestBean.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Which will match for both the interface and class. I added a test to the AdvisorAutoProxyCreatorTests class to show this in action.&lt;/p&gt;

&lt;p&gt;Rob&lt;/p&gt;</comment>
                            <comment id="14715" author="mlesk" created="Sun, 18 Sep 2005 00:53:09 +0000"  >&lt;p&gt;This approach assumes that the implementation of the interface is contained within the same package. In our case it is not and in general it probably will not be. &lt;/p&gt;

&lt;p&gt;The ability to configure the flag optimize  on the AutoProxyCreator should be entirely independent of the pointcuts utilized. Otherwise, modifying this one flag requires all pointcuts to be changed. &lt;/p&gt;

&lt;p&gt;In our case we treat pieces of our spring configuration as independent, the aspect configuration file does not and should not be aware of the bean config file to the degree that it knows which class implement which interfaces. By taking this approach we can change the implementors of our interfaces without the need to worry about updating all of the other configuration files. &lt;/p&gt;

&lt;p&gt;Is this a hard limitation of cglib or just the due to current choices in the implementation of the pointcut matching algorithm ? I am having some difficulty locating exactly where this matching occurs, I believe it happens in the AopUtils.canApply method. I have used JDKRegexpMethodPointcut for the pointcut definition so I presume the matching is managed by this class. However, I do not see any differentiation in the application of the pointcut between JDK proxies and cglib proxies.&lt;/p&gt;

&lt;p&gt;Unless I am reading the code wrong, the determination of which advice to apply to which bean is handled prior to creation of the cglib proxy. Can you point me in a direction here or at least relieve me of the misconception that there is a way to get optimization to work when specifying pointcuts using interfaces ? &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="11112" name="RequestLevelCacheAspect.java" size="6539" author="mlesk" created="Wed, 24 Aug 2005 01:23:48 +0000"/>
                            <attachment id="11111" name="Spring-Aop-Config.xml" size="2809" author="mlesk" created="Wed, 24 Aug 2005 01:12:15 +0000"/>
                            <attachment id="11110" name="Spring-Aop-Config.xml" size="5403" author="mlesk" created="Wed, 24 Aug 2005 01:08:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10180" key="com.atlassian.jira.toolkit:dayslastcommented">
                        <customfieldname>Days since last comment</customfieldname>
                        <customfieldvalues>
                                        11 years, 15 weeks, 4 days ago
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 11 Sep 2005 21:34:23 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10181" key="com.atlassian.jira.toolkit:lastusercommented">
                        <customfieldname>Last commented by a User</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>true</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10182" key="com.atlassian.jira.toolkit:lastupdaterorcommenter">
                        <customfieldname>Last updater</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>tmarshall</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03o2f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21441</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>