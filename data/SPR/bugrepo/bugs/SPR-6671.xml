<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Thu Dec 22 19:08:15 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SPR-6671/SPR-6671.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SPR-6671] ClassCastException on EventListener invocation when proxies come into play</title>
                <link>https://jira.spring.io/browse/SPR-6671</link>
                <project id="10000" key="SPR">Spring Framework</project>
                    <description>&lt;p&gt;There is a subtle issue with &lt;tt&gt;EventListener&lt;/tt&gt; handling. &lt;tt&gt;EventListeners&lt;/tt&gt; are generic since Spring 3.0 and works perfectly fine in most cases. Suppose the folloeing case:&lt;/p&gt;

&lt;p&gt;You have an interface as well as an implementation. The implementation is using &lt;tt&gt;@Transactional&lt;/tt&gt; for transaction demarcation &lt;b&gt;and&lt;/b&gt; implements &lt;tt&gt;EventListener&amp;lt;ContextRefreshedEvent&amp;gt;&lt;/tt&gt;. As there is a JDK dynamic proxy created by Spring, the reflective lookup of the event type fails, which causes Spring to assume the implementation actually declares a raw &lt;tt&gt;EventListener&lt;/tt&gt; and thus also hands &lt;tt&gt;ContextClosedEvent&lt;/tt&gt; e.g. which then in turn leads to a &lt;tt&gt;ClassCastException&lt;/tt&gt; as the method only accepts &lt;tt&gt;ContextRefreshedEvent&lt;/tt&gt; as parameter.&lt;/p&gt;

&lt;p&gt;The major problem is that I see no correct way of solving this as Spring cannot simply reject the listener instead of blindly handing all events to it. As the main issue with the current situation is, that it is not really obvious &lt;b&gt;why&lt;/b&gt; the &lt;tt&gt;ClassCastException&lt;/tt&gt; occurs, a feasible solution might be to check the inspected listener instance for implementing &lt;tt&gt;Adviced&lt;/tt&gt; and log a warning if also implements &lt;tt&gt;EventListener&lt;/tt&gt; &lt;b&gt;and&lt;/b&gt; does not return the event type.&lt;/p&gt;

&lt;p&gt;Test case reproducing the issue attached.&lt;/p&gt;</description>
            <key id="29598">SPR-6671</key>
            <summary>ClassCastException on EventListener invocation when proxies come into play</summary>
                <type id="4" iconUrl="https://jira.spring.io/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://jira.spring.io/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="juergen.hoeller">Juergen Hoeller</assignee>
                                    <reporter username="olivergierke">Oliver Gierke</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Jan 2010 07:19:58 +0000</created>
                <updated>Tue, 19 Jun 2012 02:28:23 +0000</updated>
                            <resolved>Mon, 11 Jan 2010 20:22:30 +0000</resolved>
                                    <version>3.0 GA</version>
                                                    <component>[Documentation]</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="50111" author="juergen.hoeller" created="Mon, 11 Jan 2010 20:22:30 +0000"  >&lt;p&gt;This fortunately got discovered and fixed a while ago. The fix should be available in recent 3.0.1 snapshots already...&lt;/p&gt;

&lt;p&gt;Juergen&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="29346">SPR-6596</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="16081" name="event-listener-bug.zip" size="10958" author="olivergierke" created="Mon, 11 Jan 2010 07:20:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10180" key="com.atlassian.jira.toolkit:dayslastcommented">
                        <customfieldname>Days since last comment</customfieldname>
                        <customfieldvalues>
                                        6 years, 50 weeks, 2 days ago
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 11 Jan 2010 20:22:30 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10181" key="com.atlassian.jira.toolkit:lastusercommented">
                        <customfieldname>Last commented by a User</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>false</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10182" key="com.atlassian.jira.toolkit:lastupdaterorcommenter">
                        <customfieldname>Last updater</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>tmarshall</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i00xu7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5527</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>