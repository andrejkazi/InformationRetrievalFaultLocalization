<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Thu Dec 22 19:08:30 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SPR-1234/SPR-1234.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SPR-1234] DB error when setting SqlTypeValue.TYPE_UNKNOWN to null</title>
                <link>https://jira.spring.io/browse/SPR-1234</link>
                <project id="10000" key="SPR">Spring Framework</project>
                    <description>&lt;p&gt;The StatementCreatorUtils.setParameterValue automatically sets parameters even if we don&apos;t specify the type. However when this parameter is NULL, DB2 returns a &quot;CLI0613E  Program type out of range. SQLSTATE=S1003&quot; error.&lt;/p&gt;

&lt;p&gt;In the code you have a commented out line of ps.setNull(paramIndex, Types.NULL);&lt;/p&gt;

&lt;p&gt;Can you please use this line instead of ps.setObject(paramIndex, null);&lt;/p&gt;</description>
            <key id="12220">SPR-1234</key>
            <summary>DB error when setting SqlTypeValue.TYPE_UNKNOWN to null</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thomas.risberg">Thomas Risberg</assignee>
                                    <reporter username="gethin">Gethin James</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Aug 2005 01:27:11 +0000</created>
                <updated>Tue, 19 Jun 2012 03:54:10 +0000</updated>
                            <resolved>Wed, 21 May 2008 15:01:59 +0000</resolved>
                                    <version>1.2.2</version>
                                    <fixVersion>2.5.5</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="14373" author="juergen.hoeller" created="Wed, 17 Aug 2005 05:51:29 +0000"  >&lt;p&gt;Thomas, what do you think? It sounds reasonable to me to use the setNull call instead.&lt;/p&gt;

&lt;p&gt;Juergen&lt;/p&gt;</comment>
                            <comment id="14377" author="thomas.risberg" created="Thu, 18 Aug 2005 01:59:53 +0000"  >&lt;p&gt;Sounds reasonable - but this is driver specific behavior and we should test the most commonly used ones before we commit to a change.  Oracle 10g driver works fine either way.  I&apos;d like to try MySQL and Postgres before we make the change.&lt;/p&gt;</comment>
                            <comment id="14379" author="juergen.hoeller" created="Thu, 18 Aug 2005 08:42:16 +0000"  >&lt;p&gt;I agree - we should test the common drivers before changing this. It would be great if you could give MySQL and PostgreSQL a try till Saturday, which would allow us to get this change into 1.2.4. Else, it would take a while until it could appear in a Spring production release, as 1.3 final is still a while away.&lt;/p&gt;

&lt;p&gt;JUergen&lt;/p&gt;</comment>
                            <comment id="14382" author="thomas.risberg" created="Thu, 18 Aug 2005 17:27:29 +0000"  >&lt;p&gt;Tests OK with recent versions of common drivers except Oracle 9i (9.2.0.5) but the old way did not work with this driver either so we will not lose any functionality.  &lt;/p&gt;

&lt;p&gt;Tested OK:&lt;br/&gt;
  mysql-connector-java-3.1.10&lt;br/&gt;
  Oracle 10g 10.1.0.3.0&lt;br/&gt;
  HSQLDB 1.8.0&lt;br/&gt;
  PostgreSQL 8.0 JDBC3 with SSL (build 312)&lt;/p&gt;</comment>
                            <comment id="14767" author="gethin" created="Sun, 25 Sep 2005 20:53:33 +0000"  >&lt;p&gt;Sorry Gents, that didn&apos;t fix it for DB2.  It still seems to call the same method in the driver.  The work around is to specify the TYPES, then it seems to work.  Here&apos;s the stack trace for your information.&lt;/p&gt;

&lt;p&gt;BEFORE THE FIX:&lt;br/&gt;
COM.ibm.db2.jdbc.DB2Exception: &lt;span class=&quot;error&quot;&gt;&amp;#91;IBM&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;JDBC Driver&amp;#93;&lt;/span&gt; CLI0613E  Program type out of range. SQLSTATE=S1003&lt;br/&gt;
	at COM.ibm.db2.jdbc.app.SQLExceptionGenerator.pstmtException(SQLExceptionGenerator.java:653)&lt;br/&gt;
	at COM.ibm.db2.jdbc.app.DB2PreparedStatement.setNull(DB2PreparedStatement.java:1821)&lt;br/&gt;
	at COM.ibm.db2.jdbc.app.DB2PreparedStatement.setObject(DB2PreparedStatement.java:3226)&lt;br/&gt;
	at COM.ibm.db2.jdbc.app.DB2PreparedStatement.setObject(DB2PreparedStatement.java:3167)&lt;br/&gt;
	at org.apache.commons.dbcp.DelegatingPreparedStatement.setObject(DelegatingPreparedStatement.java:165)&lt;br/&gt;
	at org.springframework.jdbc.core.StatementCreatorUtils.setParameterValue(StatementCreatorUtils.java:92)&lt;/p&gt;

&lt;p&gt;AFTER THE FIX:&lt;br/&gt;
COM.ibm.db2.jdbc.DB2Exception: &lt;span class=&quot;error&quot;&gt;&amp;#91;IBM&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;JDBC Driver&amp;#93;&lt;/span&gt; CLI0613E  Program type out of range. SQLSTATE=S1003&lt;br/&gt;
	at COM.ibm.db2.jdbc.app.SQLExceptionGenerator.pstmtException(SQLExceptionGenerator.java:653)&lt;br/&gt;
	at COM.ibm.db2.jdbc.app.DB2PreparedStatement.setNull(DB2PreparedStatement.java:1821)&lt;br/&gt;
	at org.apache.commons.dbcp.DelegatingPreparedStatement.setNull(DelegatingPreparedStatement.java:104)&lt;br/&gt;
	at org.springframework.jdbc.core.StatementCreatorUtils.setParameterValue(StatementCreatorUtils.java:95)&lt;/p&gt;

&lt;p&gt;WORKAROUND:&lt;br/&gt;
Specifiy the types,eg.	new int[] &lt;/p&gt;
{
		Types.INTEGER,
		Types.VARCHAR,
		Types.TIMESTAMP,
		Types.VARCHAR,
		Types.VARCHAR }</comment>
                            <comment id="27622" author="david_syer" created="Wed, 14 Nov 2007 05:09:15 +0000"  >&lt;p&gt;I&apos;m going to take the liberty of re-opening this issue even though it is really old - it didn&apos;t seem like a big deal so maybe it can be fixed finally in a new release.  I know that it is not actually resolved for DB2 because we came across it on a project.  Apache Derby also has the same issue (and the same workaround).&lt;/p&gt;</comment>
                            <comment id="27680" author="thomas.risberg" created="Thu, 15 Nov 2007 07:23:13 +0000"  >&lt;p&gt;I&apos;m not able to reproduce this - can you give me some more details regarding the statement and JdbcTemplate methods that were used?  &lt;/p&gt;

&lt;p&gt; I ran the following:&lt;/p&gt;

&lt;p&gt;        String insertData = &quot;INSERT INTO test_table (id, name, a_date, a_timestamp, a_number, a_decimal)&quot; +&lt;br/&gt;
                &quot; values(?, ?, ?, ?, ?, ?)&quot;;&lt;/p&gt;

&lt;p&gt;        int r = jdbcTemplate.update(insertData, new Object[] &lt;/p&gt;
{2L, null, null, null, null, null}
&lt;p&gt;);&lt;/p&gt;

&lt;p&gt;on DB2 and Derby without issues.&lt;/p&gt;

&lt;p&gt;This is the Derby info:&lt;/p&gt;

&lt;p&gt;Database Name: Apache Derby&lt;br/&gt;
Database Version: 10.2.2.0 - (485682)&lt;br/&gt;
Driver Name: Apache Derby Network Client JDBC Driver&lt;br/&gt;
Driver Version: 10.2.2.0 - (485682)&lt;/p&gt;

&lt;p&gt;and this is my DB2 info:&lt;/p&gt;

&lt;p&gt;Database Name: DB2/LINUX&lt;br/&gt;
Database Version: SQL09012&lt;br/&gt;
Driver Name: IBM DB2 JDBC Universal Driver Architecture&lt;br/&gt;
Driver Version: 3.1.57&lt;/p&gt;
</comment>
                            <comment id="27688" author="david_syer" created="Thu, 15 Nov 2007 19:04:06 +0000"  >&lt;p&gt;Did you try SQL TIMESTAMP (as opposed to DATE)?&lt;/p&gt;

&lt;p&gt;Attached Eclipse/Maven project with Derby example that fails.&lt;/p&gt;</comment>
                            <comment id="27704" author="thomas.risberg" created="Thu, 15 Nov 2007 22:45:26 +0000"  >&lt;p&gt;The difference is the JDBC driver.  I was using the client driver while your test uses the embedded driver.  We already have an exception for Informix where we use setObject instead of setNull - I&apos;ll try adding a similar exception for the embedded driver to see what happens.  &lt;/p&gt;

&lt;p&gt;This doesn&apos;t solve the DB2 problem though.  My test runs fine n DB2, but I&apos;m using a fairly recent driver.  Maybe the DB2 issue is in an older driver.  If someone can give me a version that fails I can do some further investigation.&lt;/p&gt;</comment>
                            <comment id="27714" author="thomas.risberg" created="Thu, 15 Nov 2007 23:25:50 +0000"  >&lt;p&gt;The Derby embedded driver doesn&apos;t seem to support either setNull(ix, Types.NULL) or setObject(ix, null).  Seems like the only option is to provide the type information either with the type array or by embedding the null value in a SqlParameterValue like &quot;new SqlParameterValue(Types.TIMESTAMP, null)&quot;.  And it&apos;s not just timestamps, I see an error passing in null when using plain VARCHAR columns as well. &lt;/p&gt;</comment>
                            <comment id="27718" author="thomas.risberg" created="Thu, 15 Nov 2007 23:50:58 +0000"  >&lt;p&gt;Resolution:&lt;/p&gt;

&lt;p&gt;For Derby:&lt;/p&gt;

&lt;p&gt;Use the &quot;client&quot; driver (&quot;org.apache.derby.jdbc.ClientDriver&quot;) from &quot;derbyclient.jar&quot;.  This involves starting up a separate database process that accepts network connections - &quot;java -jar derbyrun.jar server start&quot;.&lt;/p&gt;

&lt;p&gt;When using the &quot;embedded&quot; driver (&quot;org.apache.derby.jdbc.EmbeddedDriver&quot;)  you must provide type information for any parameters with a &apos;null&apos; value.&lt;/p&gt;

&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2550&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/DERBY-2550&lt;/a&gt; for more info.&lt;/p&gt;

&lt;p&gt;For DB2:&lt;/p&gt;

&lt;p&gt;Use a recent version of the DB2 UDB JDBC Universal Driver if possible.  See &lt;a href=&quot;http://www.ibm.com/developerworks/db2/library/techarticle/dm-0512kokkat/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.ibm.com/developerworks/db2/library/techarticle/dm-0512kokkat/&lt;/a&gt; for more info on this driver.&lt;/p&gt;</comment>
                            <comment id="27722" author="david_syer" created="Fri, 16 Nov 2007 00:35:50 +0000"  >&lt;p&gt;I love it when two vendors both blame each other for an issue.&lt;/p&gt;

&lt;p&gt;Can we at least translate the exception into something more meningful for developers?&lt;/p&gt;</comment>
                            <comment id="27726" author="thomas.risberg" created="Fri, 16 Nov 2007 01:57:36 +0000"  >&lt;p&gt;We aren&apos;t blaming anyone, it&apos;s just that (as far as I can tell), using the Derby embedded driver, there is no way of setting a &apos;null&apos; on a prepared statement parameter without knowing the actual SQL Type.  If there were a way, we could implement some special handling.&lt;/p&gt;

&lt;p&gt;We translate the exception to a DataIntegrityViolationException.  As for the error message, we never translate the error messages.  We just wrap the SQLException re-using the original message.&lt;/p&gt;</comment>
                            <comment id="27736" author="david_syer" created="Fri, 16 Nov 2007 03:12:36 +0000"  >&lt;p&gt;OK.  Maybe I would argue that it is an InvalidDatAccessApiUsageException, or even something else more specific?  It confuses everyone that comes across it because it seems from the exception that you must have violated a server side integrity constraint, but actually its just the driver telling you it doesn&apos;t have enough information.&lt;/p&gt;</comment>
                            <comment id="27749" author="thomas.risberg" created="Fri, 16 Nov 2007 10:58:21 +0000"  >&lt;p&gt;We don&apos;t translate SQLExceptions to InvalidDatAccessApiUsageException.  This exception is just used internally by the framework code.  The actual error code could also be thrown for other issues so I would prefer to stick to the current translation.  &lt;/p&gt;

&lt;p&gt;I could however switch to using setObject(ix, null) which results in a different error mesage that seems a bit more meaningful &amp;#8211; An attempt was made to get a data value of type &apos;TIMESTAMP&apos; from a data value of type &apos;null&apos;.&lt;/p&gt;

&lt;p&gt;I think that&apos;s the best we can do for now.&lt;/p&gt;</comment>
                            <comment id="35957" author="thomas.risberg" created="Wed, 21 May 2008 14:40:45 +0000"  >&lt;p&gt;This seems to be solved by using setNull with a type of Types.VARCHAR.  Works regardless of the actual column type. We already do this for DB2 and Sybase.  I will include Apache Derby Embedded for this strategy as well.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Related</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="22116">SPR-4809</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13112" name="SPRING-1234-Derby.zip" size="6228" author="david_syer" created="Thu, 15 Nov 2007 19:04:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10180" key="com.atlassian.jira.toolkit:dayslastcommented">
                        <customfieldname>Days since last comment</customfieldname>
                        <customfieldvalues>
                                        8 years, 32 weeks, 1 day ago
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 17 Aug 2005 05:51:29 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10181" key="com.atlassian.jira.toolkit:lastusercommented">
                        <customfieldname>Last commented by a User</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>false</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10182" key="com.atlassian.jira.toolkit:lastupdaterorcommenter">
                        <customfieldname>Last updater</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>tmarshall</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i04s7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>27945</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>