<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Thu Dec 22 21:20:16 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SPR-9051/SPR-9051.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SPR-9051] spring-test allows you to reference configuration classes that aren&apos;t annotated with @Configuration</title>
                <link>https://jira.spring.io/browse/SPR-9051</link>
                <project id="10000" key="SPR">Spring Framework</project>
                    <description>&lt;p&gt;When a @ContextConfiguration test class references a config class missing a @Configuration annotation, @Bean dependencies are wired successfully but the bean lifecycle is not applied (no init methods are invoked, for example). Adding the missing @Configuration annotation solves the problem, however the problem and solution isn&apos;t obvious since wiring/injection appeared to work.&lt;/p&gt;

&lt;p&gt;It would be better if an integration test failed-fast if you reference a config class with no @Configuration annotation.&lt;/p&gt;</description>
            <key id="41865">SPR-9051</key>
            <summary>spring-test allows you to reference configuration classes that aren&apos;t annotated with @Configuration</summary>
                <type id="4" iconUrl="https://jira.spring.io/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://jira.spring.io/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://jira.spring.io/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="sbrannen">Sam Brannen</assignee>
                                    <reporter username="kdonald">Keith Donald</reporter>
                        <labels>
                            <label>test</label>
                    </labels>
                <created>Tue, 24 Jan 2012 06:35:33 +0000</created>
                <updated>Thu, 10 Oct 2013 08:58:12 +0000</updated>
                            <resolved>Fri, 11 May 2012 15:50:06 +0000</resolved>
                                    <version>3.1 GA</version>
                                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="75626" author="almson" created="Wed, 8 Feb 2012 20:12:10 +0000"  >&lt;p&gt;Also nested static @Configuration classes aren&apos;t loaded.&lt;/p&gt;

&lt;p&gt;Noticed this myself today. This doesn&apos;t have consistent behavior one way or another. Sure, it lets you quickly swap in a stub class. But why have this inflexible one-trick pony? Just make it an error rather than fix the inconsistencies.&lt;/p&gt;</comment>
                            <comment id="77679" author="kdonald" created="Mon, 16 Apr 2012 07:24:03 +0000"  >&lt;p&gt;This is a pretty important issue to address from a user experience perspective. If you forget @Configuration on your test config class, things appear to &quot;half work&quot; and it&apos;s very difficult to debug what the hell is going on. As one example, if you forget @Configuration on a @Transactional test, transaction rollbacks will just not work even though the logging indicates otherwise. It&apos;s not obvious at all that the cause of a transaction not being rolled back is related to forgetting a @Configuration annotation on a config class.&lt;/p&gt;

&lt;p&gt;Please enforce that @Configuration is present if it&apos;s going to lead to all kinds of silent undesirable behavior.&lt;/p&gt;</comment>
                            <comment id="77680" author="jkuipers" created="Mon, 16 Apr 2012 07:44:25 +0000"  >&lt;p&gt;My code is actually relying on this behavior: I&apos;m using inner config classes in my test code not annotated with @Configuration, to prevent the inner class from being picked up by component scanning. A workaround is to exclude inner classes during component scanning using a reg-exp based exclusion, but I&apos;m not all that unhappy with the current behavior (although it&apos;s not properly documented): Spring supports @Bean on classes not annotated with @Configuration as a quick factory method, and this seems consistent with that feature to me. &lt;/p&gt;</comment>
                            <comment id="77681" author="kdonald" created="Mon, 16 Apr 2012 08:11:49 +0000"  >&lt;p&gt;I guess you haven&apos;t run into problems yet because the bean lifecycle is not invoked, consider yourself lucky.&lt;/p&gt;</comment>
                            <comment id="78689" author="sbrannen" created="Fri, 11 May 2012 14:27:36 +0000"  >&lt;p&gt;Hi Aleksandr,&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Also nested static @Configuration classes aren&apos;t loaded.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Nested static &lt;tt&gt;@Configuration&lt;/tt&gt; classes are detected automatically as the default configuration class &lt;b&gt;&lt;em&gt;if&lt;/em&gt;&lt;/b&gt; you do not specify explicit &lt;em&gt;locations&lt;/em&gt; or &lt;em&gt;classes&lt;/em&gt; via &lt;tt&gt;@ContextConfiguration&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;So if this is not the behavior you are experiencing, could you please put together a minimal working example project (or classes) that reproduces the unexpected behavior?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Sam&lt;/p&gt;</comment>
                            <comment id="78696" author="sbrannen" created="Fri, 11 May 2012 15:46:36 +0000"  >&lt;p&gt;Hi guys,&lt;/p&gt;

&lt;p&gt;Based on &lt;a href=&quot;https://github.com/SpringSource/spring-framework/commit/78c6d70f0b3123d53708544324a8bbc734b81251&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;tests I just checked in&lt;/a&gt;, I cannot reproduce the claims raised in this issue.&lt;/p&gt;

&lt;p&gt;Specifically, &lt;tt&gt;AnnotatedConfigClassesWithoutAtConfigurationTests&lt;/tt&gt; demonstrates that &lt;tt&gt;@Bean&lt;/tt&gt; methods in non-&lt;tt&gt;@Configuration&lt;/tt&gt; classes are properly handled as &lt;em&gt;annotated factory bean methods&lt;/em&gt; and that lifecycle callbacks in fact apply to such factory beans.&lt;/p&gt;

&lt;p&gt;This is in line with Joris&apos; comments. Specifically, classes that are declared via &lt;tt&gt;@ContextConfiguration(classes=...)&lt;/tt&gt; are only required to be &lt;em&gt;annotated classes&lt;/em&gt;. &lt;em&gt;Annotated classes&lt;/em&gt; include annotated components (e.g., &lt;tt&gt;@Service&lt;/tt&gt;, et al), &lt;tt&gt;@Configuration&lt;/tt&gt; classes, and any class that contains &lt;tt&gt;@Bean&lt;/tt&gt; annotated methods. The latter are effectively &lt;em&gt;annotated factory bean methods&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Thus I concur with Joris that the JavaDoc and Reference Manual for this support is misleading: the documentation typically refers to &lt;em&gt;configuration classes&lt;/em&gt; when it should in fact refer to (and explain) &lt;em&gt;annotated classes&lt;/em&gt;. This will be addressed in a &lt;a href=&quot;https://jira.spring.io/browse/SPR-9401&quot; title=&quot;Improve documentation for @Bean &amp;#39;lite&amp;#39; mode and annotated class support in the TestContext Framework&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPR-9401&quot;&gt;&lt;del&gt;SPR-9401&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;@Keith: if you have a use case where the lifecycle callbacks are not honored, please raise a separate JIRA issue with an example that reproduces that.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Sam&lt;/p&gt;</comment>
                            <comment id="78697" author="sbrannen" created="Fri, 11 May 2012 15:50:06 +0000"  >&lt;p&gt;Resolving this issue since I could not reproduce the claimed improper behavior.&lt;/p&gt;</comment>
                            <comment id="78698" author="kdonald" created="Fri, 11 May 2012 15:53:22 +0000"  >&lt;p&gt;I provided a use case &amp;#8211; @Transactional test methods. I guess you&apos;re putting the onus on me to show you that not working concretely. There is a bug.&lt;/p&gt;</comment>
                            <comment id="78699" author="sbrannen" created="Fri, 11 May 2012 16:14:57 +0000"  >&lt;p&gt;Hi Keith,&lt;/p&gt;

&lt;p&gt;I&apos;m not trying to put the onus on you per se; I&apos;m just trying to ensure that the code works &lt;em&gt;as expected&lt;/em&gt;. I believe that the tests I checked in demonstrate the expected behavior, but that of course may not cover enough use cases. That&apos;s why I&apos;d like to see a failing use case so that I can assess if it&apos;s just a configuration error (perhaps due to a misunderstanding and/or misleading documentation) or rather a true bug in the framework.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;This is a pretty important issue to address from a user experience perspective. If you forget @Configuration on your test config class, things appear to &quot;half work&quot; and it&apos;s very difficult to debug what the hell is going on.&lt;/p&gt;

&lt;p&gt;Please enforce that @Configuration is present if it&apos;s going to lead to all kinds of silent undesirable behavior.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We certainly want to do the best we can to support the user experience, but enforcing that &lt;tt&gt;@Configuration&lt;/tt&gt; is present is not an option since it is perfectly viable to declare &lt;em&gt;annotation classes&lt;/em&gt; that are not &lt;tt&gt;@Configuration&lt;/tt&gt; classes. So that is not an error. Perhaps we could warn the user (via a log statement), but I fear that the warning would be annoying to those who intentionally declared other types of annotated classes.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;As one example, if you forget @Configuration on a @Transactional test, transaction rollbacks will just not work even though the logging indicates otherwise. It&apos;s not obvious at all that the cause of a transaction not being rolled back is related to forgetting a @Configuration annotation on a config class.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;d really like to see at least a small code and configuration snippet to understand what your set up is there.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Sam&lt;/p&gt;</comment>
                            <comment id="78700" author="kdonald" created="Fri, 11 May 2012 16:47:22 +0000"  >&lt;p&gt;It&apos;s a simple test to reproduce the problem I experienced. I assumed it might be a specific instance of a more general problem that had something to do with Spring bean lifecycle not being managed properly in a context text environment, but I may have been mistaken. In any case, there is a definite, easily reproducible specific problem (despite the fact I don&apos;t know what the cause is--I have not had a chance to investigate the code).&lt;/p&gt;

&lt;p&gt;To reproduce:&lt;/p&gt;

&lt;p&gt;Take a Transactional test that mutates the database:&lt;/p&gt;

&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;@ContextConfiguration(classes=Spr9051TestsConfig.class)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;@Transactional&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;@RunWith(value=SpringJUnit4ClassRunner.class)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;public class Spr9051Tests {&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&amp;nbsp;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    @Inject&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    private JdbcTemplate jdbcTemplate;&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    &lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    @Test&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    public void testInsert() throws Exception {&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;       // do a insert &lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    }&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&amp;nbsp;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;

&lt;p&gt;&quot;testInsert&quot; should do something like assert the row isn&apos;t there, then insert the row, then verify the row is there, then rollback.  If the referenced Spr9051TestsConfig class is annotated with @Configuration, a rollback is performed as you expect. If @Configuration is NOT there, like it was in my case because I accidentally left it off, the rollback doesn&apos;t happen. Instead the data is committed and the next time you run the test it fails along with every other test related to the table (I&apos;m running these tests against an external Postgres DB not an in-memory store). So yeah, it probably took me a hour or more to determine the cause of the non-rollback was due to a missing @Configuration annotation. In the process my hair turned a shade more of gray and I came close to throwing my computer out the window.&lt;/p&gt;

&lt;p&gt;Is this enough or do you need me to go to Github and submit a project you can clone and run? I just verified the problem again in my local environment. I can do a Skype screen-share as well; whatever, I&apos;m easy to reach.&lt;/p&gt;</comment>
                            <comment id="78793" author="kdonald" created="Tue, 15 May 2012 06:41:53 +0000"  >&lt;p&gt;Just a bump. Please advise if you need any more info &lt;img class=&quot;emoticon&quot; src=&quot;https://jira.spring.io/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="78798" author="sbrannen" created="Tue, 15 May 2012 06:52:12 +0000"  >&lt;p&gt;Hi Keith,&lt;/p&gt;

&lt;p&gt;Thanks for the details of the use case. I think that should be enough to go on for now, and I&apos;ll try to take a look at that today.&lt;/p&gt;

&lt;p&gt;Cheers,&lt;/p&gt;

&lt;p&gt;Sam&lt;/p&gt;</comment>
                            <comment id="78901" author="sbrannen" created="Wed, 16 May 2012 10:09:50 +0000"  >&lt;p&gt;Hi guys,&lt;/p&gt;

&lt;p&gt;Based on Keith&apos;s use case, I put together some tests that investigate the issue.&lt;/p&gt;

&lt;p&gt;You can find details about my findings in the message of this &lt;a href=&quot;https://github.com/SpringSource/spring-framework/commit/1cec0f9c6575edb9f81ef39a7019b5d3edc0d656&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;commit&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;These are the tests involved:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/SpringSource/spring-framework/blob/master/spring-test/src/test/java/org/springframework/test/context/junit4/spr9051/AbstractTransactionalAnnotatedConfigClassTests.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;AbstractTransactionalAnnotatedConfigClassTests&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/SpringSource/spring-framework/blob/master/spring-test/src/test/java/org/springframework/test/context/junit4/spr9051/TransactionalAnnotatedConfigClassWithAtConfigurationTests.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;TransactionalAnnotatedConfigClassWithAtConfigurationTests&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/SpringSource/spring-framework/blob/master/spring-test/src/test/java/org/springframework/test/context/junit4/spr9051/TransactionalAnnotatedConfigClassesWithoutAtConfigurationTests.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;TransactionalAnnotatedConfigClassesWithoutAtConfigurationTests&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Pay attention to the JavaDoc and &lt;em&gt;NOTEs&lt;/em&gt; in the code, especially with regard to the the data sources in &lt;tt&gt;TransactionalAnnotatedConfigClassesWithoutAtConfigurationTests&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Based on the assumption that Keith&apos;s use case is similar, my conclusion is that the use of such annotated classes in &lt;em&gt;configuration lite mode&lt;/em&gt; is not a bug in Spring Core or the TestContext Framework but rather a configuration error.&lt;/p&gt;

&lt;p&gt;Of course, as previously mentioned, this could potentially be a rather common &lt;em&gt;configuration error&lt;/em&gt;, and &lt;a href=&quot;https://jira.springsource.org/browse/SPR-9401&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;SPR-9401&lt;/a&gt; will hopefully help to alleviate such errors in testing scenarios.&lt;/p&gt;

&lt;p&gt;I&apos;d also like to point out that similar configuration errors can occur in production code. So this scenario is not limited to integration tests.&lt;/p&gt;

&lt;p&gt;@Keith: can you please confirm that the cause of the undesired behavior in your tests is in fact related to the use of multiple data sources (or similar), resulting from the implicit use of &lt;em&gt;configuration lite mode&lt;/em&gt;?&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;

&lt;p&gt;Sam&lt;/p&gt;</comment>
                            <comment id="78904" author="kdonald" created="Wed, 16 May 2012 12:10:10 +0000"  >&lt;p&gt;Ok, so because I forgot @Configuration my dataSource() @Bean method was used as a factory method not a bean method. I&apos;m sure that&apos;s what was causing the problem in my case, then.&lt;/p&gt;

&lt;p&gt;I agree forgetting @Configuration that leads to strange behavior will be a common error that&apos;s difficult to trace, especially without clear documentation and logging. I expect most people would think a @Bean to be treated as a @Bean whether or not there is a @Configuration annotation on the enclosing class. I&apos;m not sure what the use cases are for &quot;lite&quot; mode. In any case it&apos;s not obvious what it means or when it&apos;s enabled.&lt;/p&gt;</comment>
                            <comment id="78914" author="cbeams" created="Wed, 16 May 2012 14:37:25 +0000"  >&lt;p&gt;I never advocate the use of &quot;lite&quot; mode.  It is literally there as an escape hatch for people who really don&apos;t want a CGLIB dependency.  Beyond that, it is simply a less functional version of &quot;full&quot; mode.  There are no functional use cases where it is an advantage.&lt;/p&gt;</comment>
                            <comment id="78998" author="sbrannen" created="Fri, 18 May 2012 13:03:05 +0000"  >&lt;p&gt;FYI: I added tests to verify proper scoping support for &lt;tt&gt;@Bean&lt;/tt&gt; methods in &lt;em&gt;lite mode&lt;/em&gt; in the TCF. Details on &lt;a href=&quot;https://github.com/SpringSource/spring-framework/commit/dc6b2abe46bc3edfaaf7020d2c95427412bed74c&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;GitHub&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Just to clarify: beans created in &lt;em&gt;lite mode&lt;/em&gt; &lt;b&gt;do&lt;/b&gt; in fact get scoped.&lt;/p&gt;</comment>
                            <comment id="79014" author="sbrannen" created="Fri, 18 May 2012 15:11:50 +0000"  >&lt;p&gt;If you are following this issue, you may also be interested in &lt;a href=&quot;https://jira.spring.io/browse/SPR-9425&quot; title=&quot;Document @Bean &amp;#39;lite&amp;#39; mode and annotated classes in the reference manual&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPR-9425&quot;&gt;&lt;del&gt;SPR-9425&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="43759">SPR-9479</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10151">
                    <name>Relate</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="43405">SPR-9425</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="47722">SPR-10369</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="51262">SPR-10971</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10130">
                    <name>Supersede</name>
                                                                <inwardlinks description="is superseded by">
                                        <issuelink>
            <issuekey id="43315">SPR-9401</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10180" key="com.atlassian.jira.toolkit:dayslastcommented">
                        <customfieldname>Days since last comment</customfieldname>
                        <customfieldvalues>
                                        4 years, 31 weeks, 6 days ago
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 8 Feb 2012 20:12:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10181" key="com.atlassian.jira.toolkit:lastusercommented">
                        <customfieldname>Last commented by a User</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>false</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10182" key="com.atlassian.jira.toolkit:lastupdaterorcommenter">
                        <customfieldname>Last updater</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>sbrannen</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03ndz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21331</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>