<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Thu Dec 22 19:14:42 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SPR-726/SPR-726.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SPR-726] BindException calls setValue() with toString&apos;ed() version of Object</title>
                <link>https://jira.spring.io/browse/SPR-726</link>
                <project id="10000" key="SPR">Spring Framework</project>
                    <description>&lt;p&gt;I have written my own PropertyEditor that converts JDK 1.5 style Enums to Strings and back. I am using that editor in the following context:&lt;/p&gt;

&lt;p&gt;&amp;lt;spring:bind path=&quot;command.invitationType&quot;&amp;gt;&lt;br/&gt;
&amp;lt;c:forEach var=&quot;type&quot; items=&quot;$&lt;/p&gt;
{invitation_types}
&lt;p&gt;&quot;&amp;gt;&lt;br/&gt;
&amp;lt;spring:transform value=&quot;$&lt;/p&gt;
{type}
&lt;p&gt;&quot; var=&quot;typeString&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;/c:forEach&amp;gt;&lt;br/&gt;
&amp;lt;/spring:bind&amp;gt;&lt;/p&gt;

&lt;p&gt;Unfortunately, the spring:transform tag yields the following Exception:&lt;/p&gt;

&lt;p&gt;java.lang.ClassCastException: java.lang.String&lt;br/&gt;
	EnumEditor.getAsText(EnumEditor.java:26)&lt;/p&gt;

&lt;p&gt;It seems as if some part of Spring uses setValue() on my EnumEditor to set a String (the toString()ed Enum to be exact). Of course, it is expecting an Enum class.&lt;/p&gt;

&lt;p&gt;In the example I will upload shortly I have overridden my Enums (InvitationType) toString() to return &quot;0xdeadbeef&quot;, and my PropertyEditors (EnumEditor) setValue() to throw an UnsupportedOperationException with the parameter as message.&lt;/p&gt;

&lt;p&gt;The following exception is thrown:&lt;/p&gt;

&lt;p&gt;java.lang.UnsupportedOperationException: value: 0xdeadbeef&lt;br/&gt;
	EnumEditor.setValue(EnumEditor.java:36)&lt;br/&gt;
org.springframework.validation.BindException.getFieldValue(BindException.java:306)&lt;br/&gt;
org.springframework.web.servlet.support.BindStatus.&amp;lt;init&amp;gt;(BindStatus.java:114)&lt;br/&gt;
org.springframework.web.servlet.tags.BindStatus.&amp;lt;init&amp;gt;(BindStatus.java:38)&lt;br/&gt;
org.springframework.web.servlet.tags.BindTag.doStartTagInternal(BindTag.java:105)&lt;br/&gt;
org.springframework.web.servlet.tags.RequestContextAwareTag.doStartTag(RequestContextAwareTag.java:71)&lt;br/&gt;
org.apache.jsp.demo_jspx._jspService(demo_jspx.java:67)&lt;/p&gt;

&lt;p&gt;Why does this BindException call setValue() with a toString&apos;ed() version of my Enum? Shouldn&apos;t it use the object itself?? I suspect there is something very wrong here.&lt;/p&gt;

&lt;p&gt;I will upload a complete demonstration shortly.&lt;/p&gt;</description>
            <key id="11170">SPR-726</key>
            <summary>BindException calls setValue() with toString&apos;ed() version of Object</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="juergen.hoeller">Juergen Hoeller</assignee>
                                    <reporter username="goonie">Andreas Schildbach</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Feb 2005 04:48:05 +0000</created>
                <updated>Mon, 28 Feb 2005 00:18:38 +0000</updated>
                            <resolved>Mon, 28 Feb 2005 00:18:38 +0000</resolved>
                                    <version>1.1.4</version>
                                    <fixVersion>1.1.5</fixVersion>
                                    <component>Web</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12360" author="goonie" created="Fri, 18 Feb 2005 04:51:42 +0000"  >&lt;p&gt;This bug demonstration is an Eclipse/Webtools project (Eclipse 3.0M4, WTP M2++). I have left out spring.jar. Either copy it to WebContext/WEB-INF/lib or to your Tomcat common/lib. If you want to run the example, just set a context docBase to WebContent.&lt;/p&gt;</comment>
                            <comment id="12365" author="goonie" created="Sat, 19 Feb 2005 21:38:01 +0000"  >&lt;p&gt;I tried to do some more debugging:&lt;/p&gt;

&lt;p&gt;First, I made sure that there is really an instance of my enum (InvitationType) in the attribute (called &quot;type&quot;):&lt;/p&gt;

&lt;p&gt;&amp;lt;jsp:expression&amp;gt;&lt;br/&gt;
pageContext.getAttribute(&quot;type&quot;).getClass()&lt;br/&gt;
&amp;lt;/jsp:expression&amp;gt;&lt;/p&gt;

&lt;p&gt;This outputs &quot;class InvitationType&quot; rather than &quot;class String&quot;.&lt;/p&gt;

&lt;p&gt;Then, I set a breakpoint to the TransformTag, line 84:&lt;/p&gt;

&lt;p&gt;Object resolvedValue = ExpressionEvaluationUtils.evaluate(&quot;value&quot;, this.value, Object.class, pageContext);&lt;/p&gt;

&lt;p&gt;Upon approaching this statement, there is already the wrong (toString()&apos;ed) value in this.value: &quot;0xdeadbeef&quot;. Why?&lt;/p&gt;

&lt;p&gt;After evaluating, resolvedValue contains &quot;0xdeadbeef&quot;, too. This String is later (line 97) set into the PropertyEditor that expects instances of Enum only. No wonder that ClassCastException happens.&lt;/p&gt;

&lt;p&gt;Could someone perhaps check the taglib configuration of the TransformTag? I don&apos;t know much about taglibs (and their descriptors). Maybe its configured that values are always coerced to String?&lt;/p&gt;
</comment>
                            <comment id="12452" author="juergen.hoeller" created="Mon, 28 Feb 2005 00:18:38 +0000"  >&lt;p&gt;Thanks for your debugging efforts! I&apos;ve continued from there to track the down the root cause: It&apos;s that you are using EL expressions in JSP 2.0, which get evaluated in the JSP container itself and then passed to TransformTag&apos;s &quot;value&quot; property.&lt;/p&gt;

&lt;p&gt;TransformTag itself is capable of evaluating EL expressions (turning EL input sSrings into Object values), but it never receives the EL expression String in this case: it only receives the evaluated result from the JSP 2.0 container. And TransformTag&apos;s &quot;value&quot; property is of type String, so the JSP 2.0 container turns the EL expression into a String result...&lt;/p&gt;

&lt;p&gt;The solution is to change TransformTag&apos;s &quot;value&quot; property from type String to type Object. Passed-in Strings will be treated as before, getting evaluated by TransformTag itself. But when running in a JSP 2.0 container, &quot;value&quot; will be able to accept resolved values as Objects, properly passing them into the corresponding PropertyEditor.&lt;/p&gt;

&lt;p&gt;Juergen&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="10530" name="bugdemo.zip" size="9570" author="goonie" created="Fri, 18 Feb 2005 04:51:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10180" key="com.atlassian.jira.toolkit:dayslastcommented">
                        <customfieldname>Days since last comment</customfieldname>
                        <customfieldvalues>
                                        11 years, 44 weeks, 3 days ago
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 28 Feb 2005 00:18:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10181" key="com.atlassian.jira.toolkit:lastusercommented">
                        <customfieldname>Last commented by a User</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>false</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10182" key="com.atlassian.jira.toolkit:lastupdaterorcommenter">
                        <customfieldname>Last updater</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>tmarshall</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01aqf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7616</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>