<?xml version = "1.0" encoding = "UTF-8" ?>
<bugrepository name="DATAMONGO">
	<bug id="1513" opendate="2016-10-25 09:44:29" fixdate="2016-11-03 08:16:02" resolution="Fixed">
		<buginformation>
			<summary>Non-ObjectId identifiers generated by event listeners are not populated if documents are inserted as batch</summary>
			<description>We have observed issues when persisting multiple entities at a time. The id does not get populated. It&amp;amp;apos;s caused by insertDBObjectList() handling ids different compared to insertDBObject(). In our use case we define our own ids when persisting to Mongo. They are Strings. We use a MongoEventListener to set the id like this:






public void onBeforeSave(BaseEntity p, DBObject dbo) {




        if (p.isNew()) {




            String id = ....;




            dbo.put("_id", id);




        }




    }






This works fine when we persist only one instance at a time because the insertDBObject() does not care about the type of the id, but insertDBObjectList() does. It goes like this:






if (id instanceof ObjectId) {




    ids.add((ObjectId) id);




} else {




    // no id was generated




    ids.add(null);




}






Result is that we do no get the id populated in the entities we persist.</description>
			<version>1.8.6 (Gosling SR6)</version>
			<fixedVersion>1.10 RC1 (Ingalls), 1.8.7 (Gosling SR7), 1.9.5 (Hopper SR5)</fixedVersion>
			<type>Bug</type>
		</buginformation>
		<fixedFiles>
			<file type="M">org.springframework.data.mongodb.core.MongoTemplateTests.java</file>
			<file type="M">org.springframework.data.mongodb.core.MongoTemplate.java</file>
		</fixedFiles>
		<links>
			<link type="Relate" description="relates to">1519</link>
		</links>
	</bug>
</bugrepository>