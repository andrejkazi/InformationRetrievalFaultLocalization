<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Thu Dec 22 15:14:57 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/DATAMONGO-753/DATAMONGO-753.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[DATAMONGO-753] Add support for nested field references in group operations</title>
                <link>https://jira.spring.io/browse/DATAMONGO-753</link>
                <project id="10701" key="DATAMONGO">Spring Data MongoDB</project>
                    <description>&lt;p&gt; use Spring Data (1.3.0.RC1) to access our MongoDB and for some new queries I want to use the aggregation framework.&lt;/p&gt;

&lt;p&gt;In the mongo shell the command would be:&lt;/p&gt;

&lt;p&gt;db.spotreports.aggregate(&lt;br/&gt;
 &lt;/p&gt;
{ &quot;$unwind&quot; : &quot;$pd&quot;}
&lt;p&gt; , { &quot;$group&quot; : { &quot;_id&quot; : &quot;$pd.PDch&quot;, &quot;base&quot; : {$sum : &quot;$pd.aBL&quot;}, &quot;uplift&quot; : {$sum : &quot;$pd.up&quot;}}})&lt;br/&gt;
{&lt;br/&gt;
&quot;result&quot; : [&lt;br/&gt;
{&lt;br/&gt;
&quot;_id&quot; : 5,&lt;br/&gt;
&quot;base&quot; : 529133,&lt;br/&gt;
&quot;uplift&quot; : 21516&lt;br/&gt;
},&lt;br/&gt;
...&lt;br/&gt;
The Spring Code I use is:&lt;/p&gt;

&lt;p&gt;Aggregation agg = Aggregation.newAggregation(&lt;br/&gt;
Aggregation.unwind(&quot;pd&quot;),&lt;br/&gt;
Aggregation.group(&quot;pd.PDch&quot;).sum(&quot;pd.aBL&quot;).as(&quot;base&quot;).sum(&quot;pd.up&quot;).as(&quot;uplift&quot;)&lt;br/&gt;
);&lt;/p&gt;

&lt;p&gt;AggregationResults&amp;lt;SpotReportResult&amp;gt; result = mongoTemplate.aggregate(agg, resolveCollection(), SpotReportResult.class);&lt;br/&gt;
I get the following error:&lt;/p&gt;

&lt;p&gt;java.lang.IllegalArgumentException: Invalid reference &apos;PDch&apos;!&lt;br/&gt;
at org.springframework.data.mongodb.core.aggregation.ExposedFieldsAggregationOperationContext.getReference(ExposedFieldsAggregationOperationContext.java:63)&lt;br/&gt;
at org.springframework.data.mongodb.core.aggregation.ExposedFieldsAggregationOperationContext.getReference(ExposedFieldsAggregationOperationContext.java:47)&lt;br/&gt;
at org.springframework.data.mongodb.core.aggregation.GroupOperation.toDBObject(GroupOperation.java:284)&lt;br/&gt;
at org.springframework.data.mongodb.core.aggregation.Aggregation.toDbObject(Aggregation.java:228)&lt;br/&gt;
I wonder why spring want to reference &apos;PDch&apos; instead of &apos;pd.PDch&apos;?&lt;/p&gt;</description>
                <environment></environment>
        <key id="50840">DATAMONGO-753</key>
            <summary>Add support for nested field references in group operations</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://jira.spring.io/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thomasd">Thomas Darimont</assignee>
                                    <reporter username="thomasd">Thomas Darimont</reporter>
                        <labels>
                    </labels>
                <created>Tue, 10 Sep 2013 21:16:34 +0000</created>
                <updated>Fri, 25 Oct 2013 08:50:28 +0000</updated>
                            <resolved>Thu, 26 Sep 2013 07:33:31 +0000</resolved>
                                    <version>1.3.1</version>
                                    <fixVersion>1.3.2 (Babbage SR1)</fixVersion>
                    <fixVersion>1.4 M1 (Codd)</fixVersion>
                                    <component>Aggregation framework</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="93883" author="thomasd" created="Wed, 25 Sep 2013 03:40:26 +0000"  >&lt;p&gt;Original ussue title: Aggregation Framework - invalid reference in group Operation&lt;/p&gt;</comment>
                            <comment id="93885" author="thomasd" created="Wed, 25 Sep 2013 04:41:04 +0000"  >&lt;p&gt;Added PR: &lt;a href=&quot;https://github.com/spring-projects/spring-data-mongodb/pull/74&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/spring-projects/spring-data-mongodb/pull/74&lt;/a&gt; , please revise.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                                                                                    <customfield id="customfield_10280" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37334</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10182" key="com.atlassian.jira.toolkit:lastupdaterorcommenter">
                        <customfieldname>Last updater</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>tmarshall</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i008lj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1413</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10381" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Ranking</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37036</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10120" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>Reference URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[http://stackoverflow.com/questions/18653574/spring-data-mongodb-aggregation-framework-invalid-reference-in-group-operati]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10480" key="com.pyxis.greenhopper.jira:gh-sprint">
                        <customfieldname>Sprint</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="22">SpringOne Aftermath</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>