<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 18:09:19 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LANG-862/LANG-862.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[LANG-862] CharSequenceTranslator causes StringIndexOutOfBoundsException during translation of unicode codepoints with length &gt; 1 character</title>
                <link>https://issues.apache.org/jira/browse/LANG-862</link>
                <project id="12310481" key="LANG">Commons Lang</project>
                    <description>&lt;p&gt;When translating a string with unicode characters in, I&apos;ve encountered an index exception:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
	java.lang.StringIndexOutOfBoundsException: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; index out of range: 50
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.charAt(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.java:686)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Character&lt;/span&gt;.codePointAt(&lt;span class=&quot;code-object&quot;&gt;Character&lt;/span&gt;.java:2335)
	at org.apache.commons.lang3.text.translate.CharSequenceTranslator.translate(CharSequenceTranslator.java:95)
	at org.apache.commons.lang3.text.translate.CharSequenceTranslator.translate(CharSequenceTranslator.java:59)
	at org.apache.commons.lang3.StringEscapeUtils.escapeCsv(StringEscapeUtils.java:556)
	...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The input string was from a twitter status:&lt;br/&gt;
org.apache.commons.lang3.StringEscapeUtils.escapeCsv(&quot;pink &amp;amp; black adidas suit for this rainy weather \ud83d\udc4d&#141;&quot;);&lt;/p&gt;

&lt;p&gt;Both those characters are &apos;Invalid&apos; unicode characters, so presumably there is a conversion error somewhere. However, this shouldn&apos;t cause the translator to crash.&lt;/p&gt;


&lt;p&gt;At line 94, the loop which generates the exception increments the position by the size of the codepoint, which seems to grow faster than the number of characters. I don&apos;t really know how codepoints work, but it looks to me like there are two indexes which are treated as if they are the same one by this loop:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;pt is incrementing by one character each iteration&lt;/li&gt;
	&lt;li&gt;pos is incrementing by one or more characters each iteration&lt;/li&gt;
	&lt;li&gt;pos is being used to index into the character array&lt;/li&gt;
	&lt;li&gt;pt is the value actually being tested in the loop test, so pos can be bigger than pt, causing an index problem at the end of the array&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;My guess would be that the loop should read something like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; pt = 0; pt &amp;lt; consumed;) {
                &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; count = &lt;span class=&quot;code-object&quot;&gt;Character&lt;/span&gt;.charCount(&lt;span class=&quot;code-object&quot;&gt;Character&lt;/span&gt;.codePointAt(input, pos));
                pt += count;
                pos += count;
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m not sure if that was the intention, hope it makes some sense!&lt;/p&gt;

&lt;p&gt;Stepping through that code with the input string &quot; \ud83d\udc4d&#141;&quot;:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the input string becomes &quot; \ud83d\udc4d&#141;\u008d&quot; (appended &apos;Reverse Line Feed&apos; - no idea why)&lt;/li&gt;
	&lt;li&gt;consumed == 4&lt;/li&gt;
	&lt;li&gt;Iterating the loop gives pt=0, pos=0 -&amp;gt; pt=1, pos=1 -&amp;gt; pt=2, pos=3 -&amp;gt; pt-3, pos=4 (Index exception)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So \ud83d\udc4d seems to be a codepoint with a width of 2, which puts the index off by one after that.&lt;/p&gt;

&lt;p&gt;Anyway, hope that helps,&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Mike.&lt;/p&gt;</description>
                <environment>&lt;p&gt;OS X, Java 1.6&lt;/p&gt;</environment>
        <key id="12623131">LANG-862</key>
            <summary>CharSequenceTranslator causes StringIndexOutOfBoundsException during translation of unicode codepoints with length &gt; 1 character</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kothar">Michael Houston</reporter>
                        <labels>
                            <label>bug</label>
                            <label>text</label>
                            <label>unicode</label>
                    </labels>
                <created>Mon, 10 Dec 2012 12:04:44 +0000</created>
                <updated>Tue, 15 Oct 2013 02:33:01 +0000</updated>
                            <resolved>Thu, 16 May 2013 21:35:38 +0000</resolved>
                                    <version>3.1</version>
                                    <fixVersion>3.2</fixVersion>
                                    <component>lang.text.translate.*</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13527896" author="kothar" created="Mon, 10 Dec 2012 12:11:43 +0000"  >&lt;p&gt;Apologies, I see this is fixed in the latests SVN - should have browsed the source code first! Although, the pos is still going to be bigger than the length of the input string, which seems odd to me, since it&apos;s just using pt to index into the string.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12616923">LANG-857</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>296726</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 51 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14gx3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>234204</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>