<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 18:09:50 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LANG-1042/LANG-1042.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[LANG-1042] StringEscapeUtils.escapeHtml() does not escape single quote</title>
                <link>https://issues.apache.org/jira/browse/LANG-1042</link>
                <project id="12310481" key="LANG">Commons Lang</project>
                    <description>&lt;p&gt;The String Escape Utils should ensure that encoded data cannot escape from a string. However in HTML (starting with 1.0 and until the present), attribute values may be denoted by either single or double quotes. Therefore single quotes need to be escaped just as much as double quotes. &lt;/p&gt;

&lt;p&gt;From the standard: &lt;a href=&quot;http://www.w3.org/TR/html4/intro/sgmltut.html#h-3.2.2&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.w3.org/TR/html4/intro/sgmltut.html#h-3.2.2&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;By default, SGML requires that all attribute values be delimited using either double quotation marks (ASCII decimal 34) or single quotation marks (ASCII decimal 39). Single quote marks can be included within the attribute value when the value is delimited by double quote marks, and vice versa. Authors may also use numeric character references to represent double quotes (&amp;amp;#34;) and single quotes (&amp;amp;#39;). For double quotes authors can also use the character entity reference &amp;amp;quot;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Note that there have been several bugs in the wild in which string encoders use this library under the hood, and as a result fail to properly escape html attributes in which user input is stored:&lt;/p&gt;

&lt;p&gt;&amp;lt;div title=&apos;&amp;lt;%=user_data%&amp;gt;&apos;&amp;gt;Howdy&amp;lt;/div&amp;gt;&lt;br/&gt;
if user_data = &apos; onclick=&apos;payload&apos; &apos; &lt;/p&gt;

&lt;p&gt;then an attacker can inject their code into the page even if the developer is using the string escape utils to escape the user string.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12746574">LANG-1042</key>
            <summary>StringEscapeUtils.escapeHtml() does not escape single quote</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rsussland">Robert Sussland</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Oct 2014 01:00:59 +0000</created>
                <updated>Sun, 6 Nov 2016 15:48:57 +0000</updated>
                            <resolved>Sun, 6 Nov 2016 15:48:56 +0000</resolved>
                                                                    <component>lang.*</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="14162960" author="kinow" created="Wed, 8 Oct 2014 02:25:37 +0000"  >&lt;p&gt;Hello Robert, &lt;/p&gt;

&lt;p&gt;I tried the following code&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;Sample.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class Sample {

	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
		&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; s = StringEscapeUtils.escapeHtml3(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;div title=&apos;&amp;lt;%=user_data%&amp;gt;&apos;&amp;gt;Howdy&amp;lt;/div&amp;gt;&quot;&lt;/span&gt;);
		&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(s);
	}
	
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And it resulted in:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;amp;lt;div title=&apos;&amp;amp;lt;%=user_data%&amp;amp;gt;&apos;&amp;amp;gt;Howdy&amp;amp;lt;/div&amp;amp;gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Using the escapeHtml4 method code gives similar output &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;amp;lt;div title=&apos;&amp;amp;lt;%=user_data%&amp;amp;gt;&apos;&amp;amp;gt;Howdy&amp;amp;lt;/div&amp;amp;gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I didn&apos;t understand how to reproduce the issue, could you elaborate more or provide a test case? &lt;/p&gt;</comment>
                            <comment id="14162966" author="rsussland" created="Wed, 8 Oct 2014 02:33:18 +0000"  >&lt;p&gt;Sorry for not being clear. Generally the escaping is done on user data that is quoted in the template &amp;#8211; you wouldn&apos;t escape the entire template. A simple example, without a template, would be&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;Bar.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class Sample {

  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
   
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; taint = &lt;span class=&quot;code-quote&quot;&gt;&quot;\&apos; onclick=\&apos;payload\&apos; &quot;&lt;/span&gt;;

    &lt;span class=&quot;code-comment&quot;&gt;//now we should be able to safely assign to an html attribute
&lt;/span&gt;    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; escaped = StringEscapeUtils.escapeHtml3(taint);

    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; generatedHtml = &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;div title=\&apos; &quot;&lt;/span&gt; + escaped + &lt;span class=&quot;code-quote&quot;&gt;&quot;\&apos;&amp;gt;Howdy&amp;lt;/div&amp;gt;&quot;&lt;/span&gt;;
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(generatedHtml); &lt;span class=&quot;code-comment&quot;&gt;//&apos;&amp;lt;div title=&apos; &apos; onclick=&apos;alert(1)&apos; &apos;&apos;&amp;gt;Howdy&amp;lt;/div&amp;gt; is unsafe &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; html rendering
&lt;/span&gt;  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14163426" author="dmjones500" created="Wed, 8 Oct 2014 12:34:46 +0000"  >&lt;p&gt;It&apos;s not really clear from the Javadocs what these methods are supposed to achieve. Clearly you were expecting the methods to render safe any user input that might be directly injected into other pieces of HTML. Looking at the code, it seems they only replace named entities (for XML this includes escaping &lt;tt&gt;&apos;&lt;/tt&gt; to &lt;tt&gt;&amp;amp;apos;&lt;/tt&gt;). At the very least, we should improve the Javadocs to make it clearer what is being escaped. &lt;/p&gt;

&lt;p&gt;If our goal is to sanitise user input, then we should consider whether escaping single quotes is the only change to make. Any such change would break compatibility with earlier versions, so I&apos;m not sure we could address this before 4.0 (unless we are convinced it&apos;s a bug, which is hard to prove since the docs are so vague).&lt;/p&gt;
</comment>
                            <comment id="14164093" author="rsussland" created="Wed, 8 Oct 2014 20:19:57 +0000"  >&lt;p&gt;I was not expecting this data to be safe for arbitrary injection into html. String escaping has a well-defined meaning &amp;#8211; the output of this function should not be able break out of a string data context, because all characters that could be interpreted by the html parser as closing out the string data context are escaped.&lt;/p&gt;

&lt;p&gt;This is exactly the string escaping behavior of other methods in this package, and what is commonly known as string escaping. &lt;/p&gt;

&lt;p&gt;c.f. &lt;a href=&quot;https://tomcat.apache.org/taglibs/standard/apidocs/org/apache/taglibs/standard/util/EscapeXML.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://tomcat.apache.org/taglibs/standard/apidocs/org/apache/taglibs/standard/util/EscapeXML.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In terms of which characters need to be escaped, HTML as well as XML only allow string data in two places: attribute values and text nodes. Control characters that denote start/end of attribute values and text nodes are well-defined and finite: single/double quote for attribute values and brackets &amp;lt;, &amp;gt;.  This assumes that the template as a whole is valid html. &lt;/p&gt;

&lt;p&gt;Additionally, the escaping symbol should also be escaped so that the method is a bijection and an unescaping method is possible. &lt;/p&gt;

&lt;p&gt;Finally, there is little value to a method that performs only html entity encoding &amp;#8211; unless you are building an html entity encoding demonstration method. The list of html entities was selected as a convenience so that html developers would not need to memorize ascii/unicode values for commonly used symbols such as e-accent, the less than sign, or the euro sign. The list of html entities is not the list of html control characters and is not relevant for an html string escaping method.&lt;/p&gt;</comment>
                            <comment id="14165055" author="dmjones500" created="Thu, 9 Oct 2014 12:07:59 +0000"  >&lt;blockquote&gt;&lt;p&gt;String escaping has a well-defined meaning &#8211; the output of this function should not be able break out of a string data context, because all characters that could be interpreted by the html parser as closing out the string data context are escaped.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t think there&apos;s anything in the documentation that suggests the escaped data will be safe in a string data context. In fact, not describing the context is one of the many flaws in the current docs.&lt;/p&gt;

&lt;p&gt;Because the current documentation is so woefully inadequate, I don&apos;t think we can&apos;t change any behaviour here under the rationale of &quot;it&apos;s a bug&quot;. Therefore, I see we have two things to do:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Have a good think about the current functionality, then document it better so that people truly understand what it does and in which contexts it is useful (if any).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Decide if we should offer other escape methods that work in a wider range of contexts (including attribute values). If our goal with these methods is to prevent XSS attacks (amongst other things), then this should be stated clearly in any resulting method documentation.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I don&apos;t entirely understand why these escaping methods are in Lang anyway, so I&apos;m not in favour of extending them further. But that&apos;s just my 2c. I&apos;m certainly in favour of extending the current Javadoc to ensure future users don&apos;t mistake what these methods are doing.&lt;/p&gt;</comment>
                            <comment id="14165080" author="sebb@apache.org" created="Thu, 9 Oct 2014 12:28:43 +0000"  >&lt;p&gt;Note that the escaping that needs to be done depends on the context of the string, i.e. where it is going to be used.&lt;br/&gt;
Also if a string is already partially escaped, it&apos;s very difficult to avoid accidentally escaping parts again.&lt;/p&gt;</comment>
                            <comment id="14171218" author="rsussland" created="Tue, 14 Oct 2014 16:59:25 +0000"  >&lt;p&gt;Is there any chance we could deprecate this method? Regardless of what the original author was intending, they have now permeated the open source eco-system:&lt;/p&gt;

&lt;p&gt;a github search shows 25K hits for StringEscapeUtils.escapeHtml. Looking at the results, users are expecting html string escaping in both attribute values and html nodes, with over 14K hits in JSPs where they are manually using this function to perform security encoding.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/search?utf8=%E2%9C%93&amp;amp;q=StringEscapeUtils.escapeHtml&amp;amp;type=Code&amp;amp;ref=searchresults&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/search?utf8=%E2%9C%93&amp;amp;q=StringEscapeUtils.escapeHtml&amp;amp;type=Code&amp;amp;ref=searchresults&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;What is saving the majority of these users is the (Java) convention that html attributes be double rather than single quoted. However, in Rails, attributes are single quoted by convention, and in JS-land you see a mix. I.e. we cannot rely on users being accidentally safe when using this function.&lt;/p&gt;

&lt;p&gt;This function is also used to encode attribute values in Apache Struts. Spring MVC is not importing the package but effectively copied the code in HtmlUtils.java. &lt;/p&gt;

&lt;p&gt;Then Grails copied Spring&apos;s encoder (c.f. package org.grails.encoder.impl) which was also picked up by Wicket (wicket-util/src/main/java/org/apache/wicket/util/string/Entities.java). &lt;/p&gt;

&lt;p&gt;Point being, you have the vast majority of Java MVC frameworks now improperly escaping html attributes and crucially relying on their double quote conventions for security. This is a concern when they take these same libraries re-use them.&lt;/p&gt;

&lt;p&gt;Here is the Play project, which for the most part uses the StringEscapeUtils methods, except for HTML encoding.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/api/src/main/scala/play/twirl/api/Formats.scala

  def escape(text: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;): Html = {
    &lt;span class=&quot;code-comment&quot;&gt;// Using our own algorithm here because commons lang escaping wasn&apos;t designed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; protecting against XSS, and there
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// don&apos;t seem to be any other good &lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt; escaping tools out there.
&lt;/span&gt;    val sb = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringBuilder(text.length)
    text.foreach {
      &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &apos;&amp;lt;&apos; =&amp;gt; sb.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;amp;lt;&quot;&lt;/span&gt;)
      &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &apos;&amp;gt;&apos; =&amp;gt; sb.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;amp;gt;&quot;&lt;/span&gt;)
      &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &apos;&lt;span class=&quot;code-quote&quot;&gt;&quot;&apos; =&amp;gt; sb.append(&quot;&lt;/span&gt;&amp;amp;quot;&quot;)
      &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &apos;\&apos;&apos; =&amp;gt; sb.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;amp;#x27;&quot;&lt;/span&gt;)
      &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &apos;&amp;amp;&apos; =&amp;gt; sb.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;amp;amp;&quot;&lt;/span&gt;)
      &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; c =&amp;gt; sb += c
    }
    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Html(sb.toString)
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It would be nice if, instead of each developer needing to roll their own escaping library, they could rely on a common string escaping library. The StringEscapeUtils does this except for the html method &amp;#8211; what about deprecating this method and introducing a new one &amp;#8211; secureHtmlEscape &amp;#8211;  that escapes &amp;lt;, &amp;gt;, &apos;, &quot;, and &amp;amp;?&lt;/p&gt;

&lt;p&gt;I understand that encoding is context sensitive. Generally you need to perform a sequence of encodings to match the sequence of browser parsings, but the sequence is built from HTML, JS, CSS, and URI encoding operations, so there is a need for a common definition of these. Then frameworks and toolkits can perform the proper contextual encoding using these functions.&lt;/p&gt;</comment>
                            <comment id="14183879" author="kinow" created="Sat, 25 Oct 2014 02:49:18 +0000"  >&lt;p&gt;&amp;gt; Duncan: Have a good think about the current functionality, then document it better so that people truly understand what it does and in which contexts it is useful (if any).&lt;/p&gt;

&lt;p&gt;+1 &lt;/p&gt;

&lt;p&gt;&amp;gt; Robert: what about deprecating this method and introducing a new one &#8211; secureHtmlEscape &#8211; that escapes &amp;lt;, &amp;gt;, &apos;, &quot;, and &amp;amp;?&lt;/p&gt;

&lt;p&gt;+0&lt;/p&gt;

&lt;p&gt;I think adding a secureHtmlEscape method could fix this issue, but I&apos;m not sure if that wouldn&apos;t mean that we could have further variations or methods for XML, HTML or other formats.&lt;/p&gt;</comment>
                            <comment id="14183884" author="kinow" created="Sat, 25 Oct 2014 02:58:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LANG-1056&quot; title=&quot;StringEscapeUtils.unescapeHtml4 java.lang.IllegalArgumentException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LANG-1056&quot;&gt;LANG-1056&lt;/a&gt; is related here to the vagueness of the Javadocs in the HTML escape methods.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12443837">LANG-572</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12750359">LANG-1056</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 8 Oct 2014 02:25:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 5 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20wtj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>