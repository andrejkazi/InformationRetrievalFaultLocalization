<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Wed Nov 30 23:17:26 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LANG-708/LANG-708.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[LANG-708] StringEscapeUtils.escapeEcmaScript from lang3 cuts off long unicode string</title>
                <link>https://issues.apache.org/jira/browse/LANG-708</link>
                <project id="12310481" key="LANG">Commons Lang</project>
                    <description>&lt;p&gt;Hello, I have a really big JSON string (generated from db) with unicode chars and I need to pass it though StringEscapeUtils.escapeEcmaScript(value). This string is generated and in most cases it works ok, but I have met a specific string (attached below) which is not correctly converted - few symbols (about 10) at the end of the string are cut-off (and actually they are not already unicode chars).&lt;/p&gt;

&lt;p&gt;the original string ends with:&lt;br/&gt;
 &quot;geonameId&quot;:6544329,&quot;valueCode&quot;:&quot;&quot;}]&lt;/p&gt;

&lt;p&gt;and the produced string ends with:&lt;br/&gt;
 \&quot;geonameId\&quot;:6544329,\&quot;value&lt;/p&gt;

&lt;p&gt;So Code&quot;:&quot;&quot;}] part is missing and this does not allow to parse the result as JSON on the client side.&lt;/p&gt;


&lt;p&gt;I have tried to debug a bit with StringEscapeUtils.escapeEcmaScript source code and is seems that the problem is somewhere around here:&lt;/p&gt;

&lt;p&gt;CharSequenceTranslator.translate(...){&lt;br/&gt;
...&lt;br/&gt;
        int sz = Character.codePointCount(input, 0, input.length());&lt;br/&gt;
        for (int i = 0; i &amp;lt; sz; i++) {&lt;br/&gt;
            // consumed is the number of codepoints consumed&lt;br/&gt;
            int consumed = translate(input, i, out);&lt;/p&gt;

&lt;p&gt;            if(consumed == 0) &lt;/p&gt;
{ 
                out.write( Character.toChars( Character.codePointAt(input, i) ) );
            }
&lt;p&gt;...&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;If I put breakpoint condition to stop in the loop when i==(sz-5), I can see that the last chars of &quot;valueCode&quot; literal are being added to the end of &quot;out&quot; stream, but the counter condition ends too early to reach the end of original input String.&lt;/p&gt;

&lt;p&gt;So, it seems that somehow with the provided string either the sz value is calculated incorrectly or the processing loop did wrong counter adjustmes at some point.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12511349">LANG-708</key>
            <summary>StringEscapeUtils.escapeEcmaScript from lang3 cuts off long unicode string</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="benderamp">anton</reporter>
                        <labels>
                    </labels>
                <created>Thu, 23 Jun 2011 12:13:16 +0000</created>
                <updated>Fri, 15 Jul 2011 07:27:26 +0000</updated>
                            <resolved>Fri, 15 Jul 2011 07:27:26 +0000</resolved>
                                                    <fixVersion>3.0.1</fixVersion>
                                    <component>lang.text.translate.*</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13053827" author="benderamp" created="Thu, 23 Jun 2011 12:53:19 +0000"  >&lt;p&gt;It seems that StringEscapeUtils.escapeJavaScript(value) from 2 commons.lang 2.1 does not have this problem with same string.&lt;/p&gt;</comment>
                            <comment id="13053840" author="sebb@apache.org" created="Thu, 23 Jun 2011 13:19:14 +0000"  >&lt;p&gt;Once you have created a JIRA issue, you can use More Actions / Attach Files to attach files.&lt;/p&gt;

&lt;p&gt;Please could you do so with the test data? It&apos;s difficult to use as it is.&lt;/p&gt;

&lt;p&gt;The issue text could then be editted to remove the inline data.&lt;/p&gt;

&lt;p&gt;Thanks very much.&lt;/p&gt;</comment>
                            <comment id="13053861" author="benderamp" created="Thu, 23 Jun 2011 13:51:58 +0000"  >&lt;p&gt;drop both files to same dir and run Test.java as main class - it would print result of conversion with 3.0 and 2.1 to system out - 3.0 will have described problem, 2.1 will not (both libs should be added as project deps).&lt;/p&gt;</comment>
                            <comment id="13065693" author="mbenson" created="Fri, 15 Jul 2011 03:31:54 +0000"  >&lt;p&gt;With &lt;a href=&quot;https://issues.apache.org/jira/browse/LANG-720&quot; title=&quot;StringEscapeUtils.escapeXml(input) outputs wrong results when an input contains characters in Supplementary Planes.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LANG-720&quot;&gt;&lt;del&gt;LANG-720&lt;/del&gt;&lt;/a&gt; fixed, lang3 trunk no longer cuts off the end of the string.&lt;/p&gt;</comment>
                            <comment id="13065747" author="bayard" created="Fri, 15 Jul 2011 07:27:26 +0000"  >&lt;p&gt;Setting fix version to 3.0.1.&lt;/p&gt;

&lt;p&gt;Setting resolution to Fixed; I think we should treat this as a different bug entry to &lt;a href=&quot;https://issues.apache.org/jira/browse/LANG-720&quot; title=&quot;StringEscapeUtils.escapeXml(input) outputs wrong results when an input contains characters in Supplementary Planes.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LANG-720&quot;&gt;&lt;del&gt;LANG-720&lt;/del&gt;&lt;/a&gt;, even if the same code change fixed it. It&apos;s a notably different symptom and worth calling out.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12483594" name="Test.java" size="1906" author="benderamp" created="Thu, 23 Jun 2011 13:51:58 +0000"/>
                            <attachment id="12483595" name="input.txt" size="6038" author="benderamp" created="Thu, 23 Jun 2011 13:51:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 23 Jun 2011 13:19:14 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>67975</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 20 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0d5hz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>74667</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>