<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun Nov 20 16:06:55 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/IO-90/IO-90.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[IO-90] Infinite loop in FileSystemUtils.freeSpaceWindows if share directory empty</title>
                <link>https://issues.apache.org/jira/browse/IO-90</link>
                <project id="12310477" key="IO">Commons IO</project>
                    <description>&lt;p&gt;When using FileSystemUtils.freeSpaceWindows in an empty share directory, the line containing the free space does not exist which causes an infinite loop (the outerloop doesn&apos;t decrease the i index).&lt;/p&gt;

&lt;p&gt;In fact to deal with all possible errors, I propose to test the exitCode of the dir command.&lt;/p&gt;

&lt;p&gt;Here is a proposed new code for this function :&lt;/p&gt;

&lt;p&gt;    /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Find free space on the Windows platform using the &apos;dir&apos; command.&lt;br/&gt;
     *&lt;/li&gt;
	&lt;li&gt;@param path  the path to get free space for, including the colon&lt;/li&gt;
	&lt;li&gt;@return the amount of free drive space on the drive&lt;/li&gt;
	&lt;li&gt;@throws IOException if an error occurs&lt;br/&gt;
     */&lt;br/&gt;
    long freeSpaceWindows(String path) throws IOException {&lt;br/&gt;
        path = FilenameUtils.normalize(path);&lt;br/&gt;
        if (path.length() &amp;gt; 2 &amp;amp;&amp;amp; path.charAt(1) == &apos;:&apos;) 
{
            path = path.substring(0, 2);  // seems to make it work
        }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;        // build and run the &apos;dir&apos; command&lt;br/&gt;
        String[] cmdAttrbs = new String[] &lt;/p&gt;
{&quot;cmd.exe&quot;, &quot;/C&quot;, &quot;dir /-c &quot; + path}
&lt;p&gt;;&lt;/p&gt;

&lt;p&gt;        // read in the output of the command to an ArrayList&lt;br/&gt;
        BufferedReader in = null;&lt;br/&gt;
        String line = null;&lt;br/&gt;
        ArrayList lines = new ArrayList();&lt;br/&gt;
        int errorLevel = 0;&lt;/p&gt;

&lt;p&gt;        try {&lt;br/&gt;
            Process proc = Runtime.getRuntime().exec(cmdAttrbs);&lt;br/&gt;
            in = new BufferedReader(&lt;br/&gt;
                new InputStreamReader(proc.getInputStream()));&lt;br/&gt;
            line = in.readLine();&lt;br/&gt;
            while (line != null) &lt;/p&gt;
{
                line = line.toLowerCase().trim();
                lines.add(line);
                line = in.readLine();
            }

&lt;p&gt;            proc.waitFor();&lt;br/&gt;
            errorLevel = proc.exitValue();&lt;/p&gt;

&lt;p&gt;        } finally &lt;/p&gt;
{
            IOUtils.closeQuietly(in);
        }

&lt;p&gt;        if (lines.size() == 0) &lt;/p&gt;
{
            // unknown problem, throw exception
            throw new IOException(
                    &quot;Command line &apos;dir /-c&apos; did not return any info &quot; +
                    &quot;for command &apos;&quot; + cmdAttrbs[2] + &quot;&apos;&quot;);
        }

&lt;p&gt;        if (errorLevel != 0) {&lt;br/&gt;
            if (errorLevel == 2) &lt;/p&gt;
{
                // Empty directory : unable to calculate the freeSpace
                return Integer.MAX_VALUE; // ???
            }
&lt;p&gt; else &lt;/p&gt;
{
                // unknown problem, throw exception
                throw new IOException(
                        &quot;Command line &apos;dir /-c&apos; error [&quot; + errorLevel +
                        &quot;] for command &apos;&quot; + cmdAttrbs[2] + &quot;&apos;&quot;);
            }
&lt;p&gt;        }&lt;/p&gt;

&lt;p&gt;        // now iterate over the lines we just read and find the LAST&lt;br/&gt;
        // non-empty line (the free space bytes should be in the last element&lt;br/&gt;
        // of the ArrayList anyway, but this will ensure it works even if it&apos;s&lt;br/&gt;
        // not, still assuming it is on the last non-blank line)&lt;br/&gt;
        long bytes = -1;&lt;br/&gt;
        int i = lines.size() - 1;&lt;br/&gt;
        int bytesStart = 0;&lt;br/&gt;
        int bytesEnd = 0;&lt;br/&gt;
        outerLoop: while (i &amp;gt; 0) {&lt;br/&gt;
            line = (String) lines.get&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;;&lt;br/&gt;
            if (line.length() &amp;gt; 0) {&lt;br/&gt;
                // found it, so now read from the end of the line to find the&lt;br/&gt;
                // last numeric character on the line, then continue until we&lt;br/&gt;
                // find the first non-numeric character, and everything between&lt;br/&gt;
                // that and the last numeric character inclusive is our free&lt;br/&gt;
                // space bytes count&lt;br/&gt;
                int j = line.length() - 1;&lt;br/&gt;
                innerLoop1: while (j &amp;gt;= 0) {&lt;br/&gt;
                    char c = line.charAt(j);&lt;br/&gt;
                    if (Character.isDigit(c)) &lt;/p&gt;
{
                      // found the last numeric character, this is the end of
                      // the free space bytes count
                      bytesEnd = j + 1;
                      break innerLoop1;
                    }
&lt;p&gt;                    j--;&lt;br/&gt;
                }&lt;br/&gt;
                innerLoop2: while (j &amp;gt;= 0) {&lt;br/&gt;
                    char c = line.charAt(j);&lt;br/&gt;
                    if (!Character.isDigit(c) &amp;amp;&amp;amp; c != &apos;,&apos; &amp;amp;&amp;amp; c != &apos;.&apos;) &lt;/p&gt;
{
                      // found the next non-numeric character, this is the
                      // beginning of the free space bytes count
                      bytesStart = j + 1;
                      break innerLoop2;
                    }
&lt;p&gt;                    j--;&lt;br/&gt;
                }&lt;br/&gt;
                break outerLoop;&lt;br/&gt;
            } else &lt;/p&gt;
{
                // If the last line is empty we are unable to parse the freeSpace
                throw new IOException(
                        &quot;Command line &apos;dir /-c&apos; did not return valid info &quot; +
                        &quot;for command &apos;&quot; + cmdAttrbs[2] + &quot;&apos;&quot;);
            }
&lt;p&gt;        }&lt;/p&gt;

&lt;p&gt;        // remove commas and dots in the bytes count&lt;br/&gt;
        StringBuffer buf = new StringBuffer(line.substring(bytesStart, bytesEnd));&lt;br/&gt;
        for (int k = 0; k &amp;lt; buf.length(); k++) {&lt;br/&gt;
            if (buf.charAt(k) == &apos;,&apos; || buf.charAt(k) == &apos;.&apos;) &lt;/p&gt;
{
                buf.deleteCharAt(k--);
            }
&lt;p&gt;        }&lt;br/&gt;
        bytes = Long.parseLong(buf.toString());&lt;br/&gt;
        return bytes;&lt;br/&gt;
    }&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows NT or higher&lt;/p&gt;</environment>
        <key id="12347176">IO-90</key>
            <summary>Infinite loop in FileSystemUtils.freeSpaceWindows if share directory empty</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="tledoux">Thomas Ledoux</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Aug 2006 17:13:47 +0000</created>
                <updated>Sat, 26 Aug 2006 00:06:22 +0000</updated>
                            <resolved>Sat, 26 Aug 2006 00:06:22 +0000</resolved>
                                    <version>1.2</version>
                                    <fixVersion>1.3</fixVersion>
                                    <component>Utilities</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12425932" author="bayard" created="Sat, 5 Aug 2006 05:07:32 +0000"  >&lt;p&gt;An important fix for 1.3.&lt;/p&gt;</comment>
                            <comment id="12430673" author="scolebourne" created="Sat, 26 Aug 2006 00:06:22 +0000"  >&lt;p&gt;Fixed (with many other changes for robustness) in rv437031&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 5 Aug 2006 05:07:32 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>139543</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 14 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0smjj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>165129</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>