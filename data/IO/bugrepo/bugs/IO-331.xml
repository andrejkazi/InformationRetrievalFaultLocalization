<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun Nov 20 14:57:26 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/IO-331/IO-331.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[IO-331] BOMInputStream wrongly detects UTF-32LE_BOM files as UTF-16LE_BOM files in method getBOM()</title>
                <link>https://issues.apache.org/jira/browse/IO-331</link>
                <project id="12310477" key="IO">Commons IO</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;The BOMInputStream works great for most UTF encoded files when detecting Byte Order Marks. However, if a file is UTF-32LE encoded with BOM the class takes it as UTF-16LE instead. This is not expected behavior.&lt;/p&gt;

&lt;p&gt;The problem comes from method getBOM(). And the first two bytes for UTF-16LE and UTF-32LE are the same, which might be the root cause of the problem.&lt;/p&gt;

&lt;p&gt;The following lists the bytes for UTF encodings for reference. The content is a BOM followed by letter &apos;t&apos;.&lt;/p&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Encoding&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Byte 1&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Byte 2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Byte 3&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Byte 4&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;UTF8&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;EF&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;BB&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;BF&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;74&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;UTF16-LE&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;FF&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;FE&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;74&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;00&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;UTF16-BE&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;FE&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;FF&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;00&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;74&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;UTF32-LE&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;FF&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;FE&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;00&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;00&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;74&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;00&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;00&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;00&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;UTF32-BE&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;00&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;00&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;FE&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;FF&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;00&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;00&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;00&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;74&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;



&lt;p&gt;I personally used the following code to work around this problem at the moment. Hope it helps.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
	&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void detectBOM(InputStream in) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException{
		List&amp;lt;ByteOrderMark&amp;gt; all=availableBOMs();
		&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; max=0;
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (ByteOrderMark bom : all) {
            max = &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.max(max, bom.length());
        }
		&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] firstBytes=&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[max];
		&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; max; i++) {
			firstBytes[i]=(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) in.read();
			&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.print(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.toHexString(firstBytes[i] &amp;amp; 0xff).toUpperCase()+&lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt;);
		}
		
		&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; found=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
		&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; j = max; j &amp;gt;1; j--) {
			&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] _copy=Arrays.copyOf(firstBytes, j);
			&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (ByteOrderMark mark : all) {
				found=Arrays.equals(_copy, mark.getBytes());
				&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (found) {
					&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;\nBOM is: &quot;&lt;/span&gt;+mark.getCharsetName());
					&lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
				}
			}
			&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (found) &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
		}
	}
	
	&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; List&amp;lt;ByteOrderMark&amp;gt; availableBOMs(){
		List&amp;lt;ByteOrderMark&amp;gt; all=&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;ByteOrderMark&amp;gt;();
		all.add(ByteOrderMark.UTF_8);
		all.add(ByteOrderMark.UTF_16BE);
		all.add(ByteOrderMark.UTF_16LE);
		all.add(ByteOrderMark.UTF_32BE);
		all.add(ByteOrderMark.UTF_32LE);
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; all;
	}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;OS: Win 7 x64&lt;br/&gt;
JDK: 1.7.03&lt;/p&gt;</environment>
        <key id="12558913">IO-331</key>
            <summary>BOMInputStream wrongly detects UTF-32LE_BOM files as UTF-16LE_BOM files in method getBOM()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="davidgjm">David Gao</reporter>
                        <labels>
                            <label>BOMInputStream</label>
                            <label>UTF-32LE</label>
                    </labels>
                <created>Fri, 1 Jun 2012 04:20:09 +0000</created>
                <updated>Tue, 8 Nov 2016 17:57:28 +0000</updated>
                            <resolved>Tue, 5 Jun 2012 14:48:40 +0000</resolved>
                                    <version>2.3</version>
                                    <fixVersion>2.4</fixVersion>
                                    <component>Streams/Writers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13287142" author="davidgjm" created="Fri, 1 Jun 2012 04:21:15 +0000"  >&lt;p&gt;UTF-32LE_BOM encoded sample file.&lt;/p&gt;</comment>
                            <comment id="13287146" author="garydgregory" created="Fri, 1 Jun 2012 04:27:52 +0000"  >&lt;p&gt;See also &lt;a href=&quot;https://issues.apache.org/jira/browse/IO-320&quot; title=&quot;Add XmlStreamReader support for UTF-32&quot; class=&quot;issue-link&quot; data-issue-key=&quot;IO-320&quot;&gt;&lt;del&gt;IO-320&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13289464" author="garydgregory" created="Tue, 5 Jun 2012 14:48:40 +0000"  >&lt;p&gt;Committed revision 1346400.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12530511" name="UTF-32LE_Y.txt" size="588" author="davidgjm" created="Fri, 1 Jun 2012 04:21:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 1 Jun 2012 04:27:52 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>250749</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 24 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0b0m7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>62212</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>