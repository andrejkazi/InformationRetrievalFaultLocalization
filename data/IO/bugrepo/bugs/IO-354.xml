<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun Nov 20 15:25:42 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/IO-354/IO-354.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[IO-354] Commons IO Tailer does not respect UTF-8 Charset</title>
                <link>https://issues.apache.org/jira/browse/IO-354</link>
                <project id="12310477" key="IO">Commons IO</project>
                    <description>&lt;p&gt;I just realized there is a defect in the source code of &quot;org.apache.commons.io.input.Tailer.java&quot;. Basically, the current implementation does not work for multi-byte encoded files. See the following snippet,&lt;/p&gt;

&lt;p&gt;448    private long readLines(RandomAccessFile reader) throws IOException {&lt;br/&gt;
449        StringBuilder sb = new StringBuilder();&lt;br/&gt;
450&lt;br/&gt;
451        long pos = reader.getFilePointer();&lt;br/&gt;
452        long rePos = pos; // position to re-read&lt;br/&gt;
453&lt;br/&gt;
454        int num;&lt;br/&gt;
455        boolean seenCR = false;&lt;br/&gt;
456        while (run &amp;amp;&amp;amp; ((num = reader.read(inbuf)) != -1)) {&lt;br/&gt;
457            for (int i = 0; i &amp;lt; num; i++) {&lt;br/&gt;
458                byte ch = inbuf&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;;&lt;br/&gt;
459                switch (ch) {&lt;br/&gt;
460                case &apos;\n&apos;:&lt;br/&gt;
461                    seenCR = false; // swallow CR before LF&lt;br/&gt;
462                    listener.handle(sb.toString());&lt;br/&gt;
463                    sb.setLength(0);&lt;br/&gt;
464                    rePos = pos + i + 1;&lt;br/&gt;
465                    break;&lt;br/&gt;
466                case &apos;\r&apos;:&lt;br/&gt;
467                    if (seenCR) &lt;/p&gt;
{
468                        sb.append(&apos;\r&apos;);
469                    }
&lt;p&gt;470                    seenCR = true;&lt;br/&gt;
471                    break;&lt;br/&gt;
472                default:&lt;br/&gt;
473                    if (seenCR) &lt;/p&gt;
{
474                        seenCR = false; // swallow final CR
475                        listener.handle(sb.toString());
476                        sb.setLength(0);
477                        rePos = pos + i + 1;
478                    }
&lt;p&gt;479                    sb.append((char) ch); // add character, not its ascii value&lt;br/&gt;
480                }&lt;br/&gt;
481            }&lt;br/&gt;
482&lt;br/&gt;
483            pos = reader.getFilePointer();&lt;br/&gt;
484        }&lt;br/&gt;
485&lt;br/&gt;
486        reader.seek(rePos); // Ensure we can re-read if necessary&lt;br/&gt;
487        return rePos;&lt;br/&gt;
488    }&lt;/p&gt;

&lt;p&gt;At line 479, the conversion of byte to char type breaks the encoding.&lt;/p&gt;</description>
                <environment>&lt;p&gt;JDK 7 &lt;br/&gt;
RHEL Linux&lt;br/&gt;
Apache Commons IO version 2.4&lt;/p&gt;</environment>
        <key id="12613739">IO-354</key>
            <summary>Commons IO Tailer does not respect UTF-8 Charset</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="liyuyi">Liyu Yi</reporter>
                        <labels>
                            <label>Charset</label>
                            <label>Encoding</label>
                            <label>Tailer</label>
                    </labels>
                <created>Sat, 27 Oct 2012 00:08:26 +0000</created>
                <updated>Tue, 8 Nov 2016 17:59:04 +0000</updated>
                            <resolved>Thu, 16 May 2013 13:33:57 +0000</resolved>
                                    <version>2.3</version>
                                    <fixVersion>2.5</fixVersion>
                                    <component>Utilities</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13485300" author="liyuyi" created="Sat, 27 Oct 2012 00:09:48 +0000"  >&lt;p&gt;I used a &quot;hacky&quot; fix to reconstruct the String with right encoding in the handler class. &lt;/p&gt;

&lt;p&gt;	private String rebuildUTF8String(String line) {&lt;br/&gt;
		int len = line.length();&lt;br/&gt;
		byte[] bytes = new byte&lt;span class=&quot;error&quot;&gt;&amp;#91;len&amp;#93;&lt;/span&gt;;&lt;br/&gt;
		for (int i=0; i&amp;lt;len; i++) &lt;/p&gt;
{
			bytes[i] = (byte)line.charAt(i);
		}
&lt;p&gt;		return new String(bytes, UTF8);&lt;br/&gt;
	}&lt;/p&gt;

&lt;p&gt;However, the right approach is to pass in the encoding in the &quot;create&quot; method and handle it in the Tailer.&lt;/p&gt;</comment>
                            <comment id="13485535" author="garydgregory" created="Sun, 28 Oct 2012 00:34:39 +0000"  >&lt;p&gt;Feel free to provide a patch! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13489272" author="liyuyi" created="Fri, 2 Nov 2012 05:53:24 +0000"  >&lt;p&gt;OK, I&apos;ll give it a shot, as a return to the community. Hope this process is a smooth one &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13627297" author="idle_sun" created="Wed, 10 Apr 2013 00:07:54 +0000"  >&lt;p&gt;submit a path &lt;span class=&quot;error&quot;&gt;&amp;#91;Tailer-commonsio-354.patch &amp;#93;&lt;/span&gt;including test cases and tested on Linux/Windows&lt;/p&gt;</comment>
                            <comment id="13633510" author="sebb@apache.org" created="Tue, 16 Apr 2013 22:47:21 +0000"  >&lt;p&gt;Thanks for the patch.&lt;/p&gt;

&lt;p&gt;There&apos;s a minor issue with the patch, which is that the conversion from bytes to String relies on the default encoding.&lt;br/&gt;
This was probably true of the original implementation.&lt;/p&gt;

&lt;p&gt;Perhaps the class needs to support methods which take an encoding parameter?&lt;/p&gt;</comment>
                            <comment id="13633624" author="sebb@apache.org" created="Wed, 17 Apr 2013 01:04:46 +0000"  >&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/r1468703&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/r1468703&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/IO-354&quot; title=&quot;Commons IO Tailer does not respect UTF-8 Charset&quot; class=&quot;issue-link&quot; data-issue-key=&quot;IO-354&quot;&gt;&lt;del&gt;IO-354&lt;/del&gt;&lt;/a&gt; Commons IO Tailer does not respect UTF-8 Charset&lt;/p&gt;

&lt;p&gt;Modified:&lt;br/&gt;
    commons/proper/io/trunk/src/changes/changes.xml&lt;br/&gt;
    commons/proper/io/trunk/src/main/java/org/apache/commons/io/input/Tailer.java&lt;br/&gt;
    commons/proper/io/trunk/src/test/java/org/apache/commons/io/input/TailerTest.java&lt;/p&gt;

&lt;p&gt;Created &lt;a href=&quot;https://issues.apache.org/jira/browse/IO-377&quot; title=&quot;Tailer uses default charset to read the file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;IO-377&quot;&gt;&lt;del&gt;IO-377&lt;/del&gt;&lt;/a&gt; to deal with the default charset issue.&lt;/p&gt;</comment>
                            <comment id="13659456" author="sebb@apache.org" created="Thu, 16 May 2013 11:48:01 +0000"  >&lt;p&gt;Using the default charset for String conversion does not fix the UTF-8 issue.&lt;br/&gt;
Need to redo the fix&lt;/p&gt;</comment>
                            <comment id="13659513" author="sebb@apache.org" created="Thu, 16 May 2013 13:25:24 +0000"  >&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/r1483340&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/r1483340&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/IO-354&quot; title=&quot;Commons IO Tailer does not respect UTF-8 Charset&quot; class=&quot;issue-link&quot; data-issue-key=&quot;IO-354&quot;&gt;&lt;del&gt;IO-354&lt;/del&gt;&lt;/a&gt; Commons IO Tailer does not respect UTF-8 Charset&lt;br/&gt;
Rework to allow charset to be specified&lt;/p&gt;

&lt;p&gt;Modified:&lt;br/&gt;
    commons/proper/io/trunk/src/main/java/org/apache/commons/io/input/Tailer.java&lt;br/&gt;
    commons/proper/io/trunk/src/test/java/org/apache/commons/io/input/TailerTest.java&lt;/p&gt;</comment>
                            <comment id="13659519" author="sebb@apache.org" created="Thu, 16 May 2013 13:33:57 +0000"  >&lt;p&gt;Hope this is really fixed now!&lt;/p&gt;</comment>
                            <comment id="14013450" author="kriegaex" created="Fri, 30 May 2014 09:16:55 +0000"  >&lt;p&gt;This was fixed 1 year+ ago now. I have just bumped into the same problem right after having used Commons IO for the very first time. Are there any plans to release v2.5 anytime soon? I am reluctant to use a developer build, I would prefer to stay on Maven Central as my only upstream repo.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12642839">IO-377</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12577931" name="Tailer-commonsio-354.patch" size="6229" author="idle_sun" created="Wed, 10 Apr 2013 00:07:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 28 Oct 2012 00:34:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>252487</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 25 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ctbb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72693</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>