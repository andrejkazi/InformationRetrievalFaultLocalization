<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Thu Dec 22 13:13:12 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/DATACMNS-917/DATACMNS-917.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[DATACMNS-917] Query methods returning Maps shouldn&apos;t return null if no result is present</title>
                <link>https://jira.spring.io/browse/DATACMNS-917</link>
                <project id="10510" key="DATACMNS">Spring Data Commons</project>
                    <description>&lt;p&gt;It&apos;s possible to return a &lt;tt&gt;Map&amp;lt;Key, Value&amp;gt;&lt;/tt&gt; inside a custom repository using &lt;tt&gt;@Query&lt;/tt&gt;. The problem is that for no results the &lt;tt&gt;Map&lt;/tt&gt; is &lt;tt&gt;null&lt;/tt&gt; instead of empty. In my interpretation if the underlying &lt;tt&gt;ResultList&lt;/tt&gt; is empty then the map is of course &lt;tt&gt;null&lt;/tt&gt;, but could be initiated to empty. Also &lt;tt&gt;Optional&amp;lt;Map&amp;lt;Key, Value&amp;gt;&amp;gt;&lt;/tt&gt; throws an &lt;tt&gt;IllegalStateException&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="69925">DATACMNS-917</key>
            <summary>Query methods returning Maps shouldn&apos;t return null if no result is present</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://jira.spring.io/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="olivergierke">Oliver Gierke</assignee>
                                    <reporter username="daniphp@gmail.com">Daniel Dacar</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Sep 2016 08:41:36 +0000</created>
                <updated>Thu, 29 Sep 2016 12:05:59 +0000</updated>
                            <resolved>Fri, 23 Sep 2016 13:06:08 +0000</resolved>
                                                    <fixVersion>1.11.6 (Gosling SR6)</fixVersion>
                    <fixVersion>1.12.4 (Hopper SR4)</fixVersion>
                    <fixVersion>1.13 RC1 (Ingalls)</fixVersion>
                                    <component>Repositories</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="132362" author="olivergierke" created="Fri, 23 Sep 2016 08:56:34 +0000"  >&lt;p&gt;Good one! Do you have an example project that we could check a potential fix against?&lt;/p&gt;</comment>
                            <comment id="132368" author="daniphp@gmail.com" created="Fri, 23 Sep 2016 10:12:38 +0000"  >&lt;p&gt;Sorry I don&apos;t. My use case is simple: I try to convert a group by result of two sql fields into a Map. The curent workaround is to create a List of custom entities and convert them to the Map.&lt;/p&gt;</comment>
                            <comment id="132370" author="olivergierke" created="Fri, 23 Sep 2016 10:23:20 +0000"  >&lt;p&gt;Which Spring Data JPA version are you using? Also, it&apos;d be still helpful to see what kind of query method you&apos;re actually trying to execute. As per the Javadoc of &lt;tt&gt;getResultList()&lt;/tt&gt;, it doesn&apos;t seem to ever return &lt;tt&gt;null&lt;/tt&gt; in the first place. We actually only return &lt;tt&gt;null&lt;/tt&gt; from a query execution that throws a &lt;tt&gt;NoResultException&lt;/tt&gt;, which &#8212; AFAICT &#8212; is only thrown for executions that use &lt;tt&gt;getSingleResult()&lt;/tt&gt;, which seems to be a weird thing to combine with a &lt;tt&gt;Map&lt;/tt&gt; as return type.&lt;/p&gt;

&lt;p&gt;Again, any bit of more context would be incredibly helpful.&lt;/p&gt;</comment>
                            <comment id="132371" author="daniphp@gmail.com" created="Fri, 23 Sep 2016 10:34:08 +0000"  >&lt;p&gt;spring-data-jpa / 1.10.2.RELEASE&lt;/p&gt;

&lt;p&gt;I can reproduce the problem with this simple case&lt;/p&gt;

&lt;p&gt;    @Query(&quot;SELECT new map(id, id) FROM Entity&quot;)&lt;br/&gt;
    Map&amp;lt;BigDecimal, BigDecimal&amp;gt; findMap();&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if there are values in the table the mapping is correct&lt;/li&gt;
	&lt;li&gt;if there are no values in the table, the Map is null&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="132372" author="olivergierke" created="Fri, 23 Sep 2016 10:42:39 +0000"  >&lt;p&gt;Thanks, that helps!&lt;/p&gt;</comment>
                            <comment id="132373" author="daniphp@gmail.com" created="Fri, 23 Sep 2016 10:45:04 +0000"  >&lt;p&gt;I simplified the example a bit.&lt;/p&gt;</comment>
                            <comment id="132383" author="olivergierke" created="Fri, 23 Sep 2016 13:06:08 +0000"  >&lt;p&gt;That&apos;s fixed in Spring Data Commons. We now return empty &lt;tt&gt;Map&lt;/tt&gt; instances for &lt;tt&gt;null&lt;/tt&gt; values in the final result conversion step. We unfortunately can&apos;t do it earlier as otherwise the wrapping into an &lt;tt&gt;Optional&lt;/tt&gt; would break. However, I am not too sure wrapping a &lt;tt&gt;Map&lt;/tt&gt; into an &lt;tt&gt;Optional&lt;/tt&gt; makes much sense at all.&lt;/p&gt;

&lt;p&gt;Considering your use case, have you thought of rather using a dedicated projection type so that your client code would get type safe access?&lt;/p&gt;

&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: #006699; font-weight: bold; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;interface&lt;/span&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt; MyProjection {&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;  Integer getFirst();&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;  Integer getSecond();&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&amp;nbsp;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: gray; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;@Query&lt;/span&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: blue; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;&quot;select x as first, y as second from Entity&quot;&lt;/span&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;Optional&amp;lt;MyProjection&amp;gt; findByQuery();&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;

&lt;p&gt;That&apos;d give you dedicated indication of the presence or absence as well as type-safe access to tie fields (and you don&apos;t have to access the map entries using String keys or the like).&lt;/p&gt;</comment>
                            <comment id="132385" author="daniphp@gmail.com" created="Fri, 23 Sep 2016 13:14:34 +0000"  >&lt;p&gt;The Optional was just a good workaround in Java8 in case there was no fix from your community. It doesn&apos;t make sense in normal cases.&lt;br/&gt;
Thank you for the suggestion, the query in my example was just a simplification for your quick understanding of the bug. What I was trying to do was getting a Map for this query&lt;/p&gt;

&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: #006699; font-weight: bold; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;Select&lt;/span&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt; x,y &lt;/span&gt;&lt;span style=&quot;color: #006699; font-weight: bold; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;from&lt;/span&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt; entity &lt;/span&gt;&lt;span style=&quot;color: #006699; font-weight: bold; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;group&lt;/span&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #006699; font-weight: bold; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;by&lt;/span&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt; x,y; &lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;
&lt;p&gt;so there are multiple results with a key and a value; and a map was perfect for it.&lt;/p&gt;</comment>
                            <comment id="132386" author="olivergierke" created="Fri, 23 Sep 2016 13:17:55 +0000"  >&lt;p&gt;Ah, the grouping was what I missed. Nonetheless, would be cool if you could give the snapshots a try to see whether it fixes your issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 23 Sep 2016 08:56:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10280" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10182" key="com.atlassian.jira.toolkit:lastupdaterorcommenter">
                        <customfieldname>Last updater</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>olivergierke</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i09g1r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10381" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Ranking</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10480" key="com.pyxis.greenhopper.jira:gh-sprint">
                        <customfieldname>Sprint</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="114">Kay M1</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>