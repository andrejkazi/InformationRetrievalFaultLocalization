<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Thu Dec 22 13:12:56 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/DATACMNS-412/DATACMNS-412.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[DATACMNS-412] Exception &apos; java.lang.IllegalArgumentException: Not an managed type&apos; upon a tomcat context reload</title>
                <link>https://jira.spring.io/browse/DATACMNS-412</link>
                <project id="10510" key="DATACMNS">Spring Data Commons</project>
                    <description>&lt;p&gt;Exception &apos; java.lang.IllegalArgumentException: Not an managed type&apos; upon a tomcat context reload when cached &apos;RepositoryInformation&apos; (change added in  &lt;a href=&quot;https://jira.spring.io/browse/DATACMNS-395&quot; title=&quot;RepositoryFactorySupport should cache RepositoryInformation instances&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DATACMNS-395&quot;&gt;&lt;del&gt;DATACMNS-395&lt;/del&gt;&lt;/a&gt;) is returned by the &apos;RepositoryFactorySupport&apos; class.&lt;/p&gt;

&lt;p&gt;The &apos;Environment&apos; field of this Jira issue contains details on my setup (emdedded tomcat 7).&lt;/p&gt;

&lt;p&gt;The attached file &apos;tomcat-log.txt&apos; contains the full trace of the exception and context reload.&lt;/p&gt;

&lt;p&gt;If I modify RepositoryFactorySupport#getRepositoryInformation and have it always return new RepositoryInformation (i.e. effectively the old behaviour prior to the &lt;a href=&quot;https://jira.spring.io/browse/DATACMNS-395&quot; title=&quot;RepositoryFactorySupport should cache RepositoryInformation instances&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DATACMNS-395&quot;&gt;&lt;del&gt;DATACMNS-395&lt;/del&gt;&lt;/a&gt; change) then this exception does not occur.&lt;/p&gt;

&lt;p&gt;Attached (&quot;RepositoryInformationCmp.txt&quot;) is a dump of the cached version of RepositoryInformation vs a newly created instance (I used ReflectionToStringBuilder with a recursive &apos;ToStringStyle&apos; strategey to produce the dump). The &apos;diff&apos; utility reveals that the content of both instances is identical.&lt;br/&gt;
Note however that the recursion stops at java.lang classes and so does not include the contents of the &apos;Class&apos; classes which is where I believe the difference lies.&lt;/p&gt;

&lt;p&gt;My theory on the cause of this problem is that a new class loader is instantiated when the Tomcat context is reloaded, thereby somehow invalidating existing &apos;Class&apos; meta-information.&lt;/p&gt;

&lt;p&gt;Interestingly, the first comment I saw upon navigating to the Spring Data Commons Jira site, by Seppel Hardt read with words to the effect that he encountered a similar problem and had reached a similar conclusion.&lt;/p&gt;

&lt;p&gt;By anecdotal observation of stack overflow posts, I see there appears to numerous other users facing this issue also.&lt;/p&gt;</description>
                <environment>Spring + hibernate + embedded tomcat 7 (using the tomcat 7 maven plugin)&lt;br/&gt;
I have tomcat run from an exploded WAR that lies within my eclipse project. I supply the attached server.xml file to the embedded tomcat 7 instance to cause it to run from the exploded WAR file and to automatically reload (using the server.xml reloadable=&amp;quot;true&amp;quot; context attribute).&lt;br/&gt;
</environment>
        <key id="52607">DATACMNS-412</key>
            <summary>Exception &apos; java.lang.IllegalArgumentException: Not an managed type&apos; upon a tomcat context reload</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://jira.spring.io/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="olivergierke">Oliver Gierke</assignee>
                                    <reporter username="nickweedon">Nick Weedon</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Jan 2014 03:51:56 +0000</created>
                <updated>Wed, 29 Jan 2014 06:47:42 +0000</updated>
                            <resolved>Fri, 17 Jan 2014 06:56:56 +0000</resolved>
                                    <version>1.7 M1 (Codd)</version>
                    <version>1.6.3 (Babbage SR2)</version>
                                    <fixVersion>1.7 RC1 (Codd)</fixVersion>
                    <fixVersion>1.6.4 (Babbage SR3)</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="97113" author="thomasd" created="Thu, 9 Jan 2014 00:58:41 +0000"  >&lt;p&gt;We could try to detect whether the classloader / classloading infrastracture has changed (servlet context-reload) and invalidate the cached RepositoryInformation, create a new one, cache it and return that newly cached instance.&lt;br/&gt;
We probably have to do this kind of cache invalidation for EntityInformation as well.&lt;/p&gt;</comment>
                            <comment id="97115" author="thomasd" created="Thu, 9 Jan 2014 01:50:27 +0000"  >&lt;p&gt;Would you mind providing a small example that reproduces this issue?&lt;/p&gt;</comment>
                            <comment id="97116" author="nickweedon" created="Thu, 9 Jan 2014 02:05:01 +0000"  >&lt;p&gt;No problem. It will be a bit of an undertaking to reproduce since it is a slightly elaborate scenario. I will aim to provide an example project as soon as possible but probably no earlier than tomorrow (it is 8:00PM here).&lt;/p&gt;</comment>
                            <comment id="97306" author="olivergierke" created="Tue, 14 Jan 2014 08:56:47 +0000"  >&lt;p&gt;I pushed a potential fix to the master branch. Feel free to give it a spin. I effectively turned a static cache (which might survive the redeployment as it keeps references to classes) into a non static one so that it should be garbage collected on &lt;tt&gt;ApplicationContext&lt;/tt&gt; shutdown.&lt;/p&gt;

&lt;p&gt;If you can verify it to solve the issue I&apos;m happy to port it back to the bugfix branch.&lt;/p&gt;</comment>
                            <comment id="97320" author="nickweedon" created="Tue, 14 Jan 2014 18:50:14 +0000"  >&lt;p&gt;I have tested your fix against my project by swapping between 1.7.0M1 and the build that contains your fix. When retesting against the 1.7.0M1 build I can see that the problem still occurs (as expected). When I switch to the build that contains your fix I can see that the problem no longer occurs. I can therefore definitely confirm that your fix resolves the issue. &lt;/p&gt;

&lt;p&gt;Thanks for fixing this so quickly. Last night I had just started putting together a &apos;throw-away&apos; sample spring project to reproduce the issue. The fact that you have now fixed this already saves me a lot of time as I no long need to complete that project. &lt;/p&gt;

&lt;p&gt;Cheers, much appreciated.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10151">
                    <name>Relate</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="51802">DATACMNS-395</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="21590" name="RepositoryInformationCmp.txt" size="3753" author="nickweedon" created="Wed, 8 Jan 2014 03:51:56 +0000"/>
                            <attachment id="21589" name="server.xml" size="6425" author="nickweedon" created="Wed, 8 Jan 2014 03:51:56 +0000"/>
                            <attachment id="21588" name="tomcat-log.txt" size="12533" author="nickweedon" created="Wed, 8 Jan 2014 03:51:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 9 Jan 2014 00:58:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10280" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39087</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10182" key="com.atlassian.jira.toolkit:lastupdaterorcommenter">
                        <customfieldname>Last updater</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thomasd</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i005kv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>914</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10381" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Ranking</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38789</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10480" key="com.pyxis.greenhopper.jira:gh-sprint">
                        <customfieldname>Sprint</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="30">42 - 2014 Kickoff</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>