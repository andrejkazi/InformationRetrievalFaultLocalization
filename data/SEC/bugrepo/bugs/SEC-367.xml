<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Fri Dec 23 11:46:24 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SEC-367/SEC-367.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SEC-367] Multiple Users can get the same Authentication object instance from the UserCache</title>
                <link>https://jira.spring.io/browse/SEC-367</link>
                <project id="10040" key="SEC">Spring Security</project>
                    <description>&lt;p&gt;We&apos;re using version 1.0.0-RC1 of acegi-security.&lt;/p&gt;

&lt;p&gt;During our development cycle everyone is logging into the system with the same userid and password.  We&apos;ve configured Acegi to use a user-cache as shown in the spring config exerpt below.  The issue we ran into is that if 3 or 4 of us all try to log in at the same time (one, two, three, go), and with the same username / password; we often see two or more clients obtain the same user object from the cache.  When one person changes the user object in their session the other person also see&apos;s the change.  There are in fact two sessions created (or one per client), but the same instance of the User object is stored in both sessions.  With only slight differences in login times we see the proper and expected behaviour that each logged in user gets a unique copy of the user from the userCache; yet the problem exists that for a small time-frame (perhaps a second?) it is possible for more than one user to get the same in-memory copy of the user in their session when both people login with the same credentials.&lt;/p&gt;

&lt;p&gt;As a short term workaround we&apos;ve disabled use of the user-cache and it seems to resolve the issue.&lt;/p&gt;

&lt;p&gt;    &amp;lt;bean id=&quot;daoAuthenticationProvider&quot; class=&quot;com.clickbank.dao.security.CBDaoAuthenticationProvider &quot;&amp;gt;&lt;br/&gt;
         &amp;lt;property name=&quot;userDetailsService&quot; ref=&quot;userDAO&quot;/&amp;gt;&lt;br/&gt;
         &amp;lt;&lt;span class=&quot;error&quot;&gt;Unable to render embedded object: File (-- &amp;lt;property name=&amp;quot;userCache&amp;quot; ref=&amp;quot;userCache&amp;quot;/&amp;gt; --&amp;gt; &amp;lt;) not found.&lt;/span&gt;-- TODO: turned off due to issue with same user hitting cache at same time. --&amp;gt;&lt;br/&gt;
         &amp;lt;property name=&quot;passwordEncoder&quot; ref=&quot;passwordEncoder&quot;/&amp;gt;&lt;br/&gt;
         &amp;lt;property name=&quot;saltSource&quot;&amp;gt;&lt;br/&gt;
            &amp;lt;bean class=&quot;org.acegisecurity.providers.dao.salt.ReflectionSaltSource &quot;&amp;gt;&lt;br/&gt;
                &amp;lt;property name=&quot;userPropertyToUse&quot;&amp;gt;&lt;br/&gt;
                    &amp;lt;value&amp;gt;getUserName&amp;lt;/value&amp;gt;&lt;br/&gt;
                &amp;lt;/property&amp;gt;&lt;br/&gt;
            &amp;lt;/bean&amp;gt;&lt;br/&gt;
        &amp;lt;/property&amp;gt;&lt;br/&gt;
    &amp;lt;/bean&amp;gt;&lt;br/&gt;
    &amp;lt;bean id=&quot;userCache&quot; class=&quot;org.acegisecurity.providers.dao.cache.EhCacheBasedUserCache&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;property name=&quot;cache&quot;&amp;gt;&lt;br/&gt;
            &amp;lt;bean class=&quot; org.springframework.cache.ehcache.EhCacheFactoryBean&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;property name=&quot;cacheManager&quot;&amp;gt;&lt;br/&gt;
                    &amp;lt;bean class=&quot;org.springframework.cache.ehcache.EhCacheManagerFactoryBean &quot;/&amp;gt;&lt;br/&gt;
                &amp;lt;/property&amp;gt;&lt;br/&gt;
                &amp;lt;property name=&quot;cacheName&quot; value=&quot;userCache&quot;/&amp;gt;&lt;br/&gt;
            &amp;lt;/bean&amp;gt;&lt;br/&gt;
        &amp;lt;/property&amp;gt;&lt;br/&gt;
    &amp;lt;/bean&amp;gt;&lt;/p&gt;</description>
                <environment>Windows / Linux / FreeBSD, Tomcat 5.5.12, MySQL 5.0.24, SpringFramework 1.2.6</environment>
        <key id="15102">SEC-367</key>
            <summary>Multiple Users can get the same Authentication object instance from the UserCache</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="balex">Ben Alex</assignee>
                                    <reporter username="jghayward">John Hayward</reporter>
                        <labels>
                    </labels>
                <created>Sun, 1 Oct 2006 01:49:02 +0000</created>
                <updated>Sat, 6 Feb 2016 06:31:59 +0000</updated>
                            <resolved>Wed, 15 Nov 2006 08:09:41 +0000</resolved>
                                                    <fixVersion>1.0.3</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="20750" author="balex" created="Sun, 12 Nov 2006 07:39:13 +0000"  >&lt;p&gt;User is supposed to be immutable, so the reported scenario related to changing User is not supposed to happen in the first place. As per the JavaDoc comments for User:&lt;/p&gt;

&lt;p&gt;&quot;Implemented with value object semantics (immutable after construction, like a &amp;lt;code&amp;gt;String&amp;lt;/code&amp;gt;). Developers may use this class directly, subclass it, or write their own &lt;/p&gt;
{@link UserDetails}
&lt;p&gt; implementation from scratch.&quot;&lt;/p&gt;

&lt;p&gt;I&apos;ve also added corresponding clarification to the UserDetails interface contract regarding immutability.&lt;/p&gt;

&lt;p&gt;I would suggest you try to find an alternative way of modifying whatever it is you are modifying in User.&lt;/p&gt;

&lt;p&gt;I&apos;ll leave this issue open for a few days to see if you have any other thoughts on it, but otherwise it&apos;ll be closed as &quot;cannot duplicate&quot;.&lt;/p&gt;</comment>
                            <comment id="20870" author="balex" created="Wed, 15 Nov 2006 08:09:41 +0000"  >&lt;p&gt;Updated documentation to clarify behaviour is by design, as UserDetails instances should be immutable (value objects).&lt;/p&gt;</comment>
                            <comment id="126335" author="issuemaster" created="Sat, 6 Feb 2016 06:31:59 +0000"  >&lt;p&gt;This issue has been migrated to &lt;a href=&quot;https://github.com/spring-projects/spring-security/issues/628&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/spring-projects/spring-security/issues/628&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 12 Nov 2006 07:39:13 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10280" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20470</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01w67:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11089</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10381" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Ranking</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11068</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>