<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Fri Dec 23 10:41:09 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SEC-1606/SEC-1606.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SEC-1606] FirewalledRequest.reset() not called when Filters in the FilterChainProxy do not complete the FilterChain</title>
                <link>https://jira.spring.io/browse/SEC-1606</link>
                <project id="10040" key="SEC">Spring Security</project>
                    <description>&lt;p&gt;When the FilterChain is not completed within FilterChainProxy, FirewalledRequest.reset() is not called. This can cause the wrong pathInfo and servletPath to be exposed when a forward or include is performed within the FilterChainProxy&apos;s filters and using DefaultHttpFirewall. The reason is because the pathInfo and the servletPath are still cached from the original request and reset was never called.&lt;/p&gt;

&lt;p&gt;The following configuration will demonstrate the issue. When an invalid username/password is submitted, the request is forwarded to /login.jsp?login_error=1. However, when the JspServlet attempts to process the URL it sees the HttpServeltRequest.servletPath as RequestWrapper.strippedServletPath (/j_spring_security_check) instead of the new servletPath /login.jsp. &lt;/p&gt;


&lt;p&gt;&amp;lt;http auto-config=&quot;true&quot;&amp;gt;&lt;br/&gt;
  &amp;lt;intercept-url pattern=&quot;/admin/secure.jsp&quot; access=&quot;ROLE_ADMIN&quot;/&amp;gt;&lt;br/&gt;
  &amp;lt;form-login login-page=&quot;/login.jsp&quot; authentication-failure-handler-ref=&quot;afh&quot;/&amp;gt;		&lt;br/&gt;
&amp;lt;/http&amp;gt;	&lt;br/&gt;
&amp;lt;b:bean id=&quot;afh&quot; class=&quot;org.springframework.security.web.authentication.SimpleUrlAuthenticationFailureHandler&quot;&lt;br/&gt;
  p:defaultFailureUrl=&quot;/login.jsp?login_error=1&quot;  &lt;br/&gt;
  p:useForward=&quot;true&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;authentication-manager&amp;gt;&lt;br/&gt;
  &amp;lt;authentication-provider&amp;gt;&lt;br/&gt;
    &amp;lt;user-service&amp;gt;&lt;br/&gt;
      &amp;lt;user name=&quot;un&quot; password=&quot;pwd&quot; authorities=&quot;ROLE_ADMIN&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;/user-service&amp;gt;&lt;br/&gt;
  &amp;lt;/authentication-provider&amp;gt;&lt;br/&gt;
&amp;lt;/authentication-manager&amp;gt;&lt;/p&gt;


&lt;p&gt;I have not yet validated this occurs in 3.1.0.M2 but marked it as impacted to ensure it at least gets looked at.&lt;/p&gt;</description>
                <environment></environment>
        <key id="34620">SEC-1606</key>
            <summary>FirewalledRequest.reset() not called when Filters in the FilterChainProxy do not complete the FilterChain</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Complete</resolution>
                                        <assignee username="rwinch">Rob Winch</assignee>
                                    <reporter username="rwinch">Rob Winch</reporter>
                        <labels>
                    </labels>
                <created>Mon, 1 Nov 2010 14:46:17 +0000</created>
                <updated>Sat, 6 Feb 2016 06:15:50 +0000</updated>
                            <resolved>Wed, 3 Nov 2010 13:48:07 +0000</resolved>
                                    <version>3.0.4</version>
                    <version>2.0.6</version>
                    <version>3.1.0.M2</version>
                                    <fixVersion>3.0.5</fixVersion>
                    <fixVersion>3.1.0.M2</fixVersion>
                    <fixVersion>2.0.7</fixVersion>
                                    <component>Web</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="60158" author="rwinch" created="Mon, 1 Nov 2010 14:47:01 +0000"  >&lt;p&gt;removed code macro because it did not work&lt;/p&gt;</comment>
                            <comment id="60160" author="luke" created="Mon, 1 Nov 2010 15:04:43 +0000"  >&lt;p&gt;Thanks Rob. There&apos;s also a similar bug when using filters=&quot;none&quot; (which is easier to fix). The reset method isn&apos;t called in cases where there are no matching filters.&lt;/p&gt;

&lt;p&gt;I guess we can also wrap calls to request.getRequestDispatcher and create a RequestDispatcher which calls the reset method on the wrapped request when its &quot;forward&quot; method is called. Does that make sense?&lt;/p&gt;</comment>
                            <comment id="60162" author="rwinch" created="Mon, 1 Nov 2010 15:37:00 +0000"  >&lt;p&gt;A place to at least start for those encountering this issue might be to override the Firewall implementation using the attached file. Next update the spring security configuration to ensure that the spring security configuration used is 3.0.4 and override the firewall. An example of the relevant configuration is below:&lt;/p&gt;

&lt;p&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&lt;br/&gt;
&amp;lt;b:beans xmlns:b=&quot;http://www.springframework.org/schema/beans&quot;&lt;br/&gt;
	xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&lt;br/&gt;
	xmlns=&quot;http://www.springframework.org/schema/security&quot;&lt;br/&gt;
	xmlns&lt;img class=&quot;emoticon&quot; src=&quot;https://jira.spring.io/images/icons/emoticons/tongue.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;=&quot;http://www.springframework.org/schema/p&quot;&lt;br/&gt;
	xsi:schemaLocation=&quot;http://www.springframework.org/schema/security &lt;a href=&quot;http://www.springframework.org/schema/security/spring-security-3.0.4.xsd&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.springframework.org/schema/security/spring-security-3.0.4.xsd&lt;/a&gt;&lt;br/&gt;
		&lt;a href=&quot;http://www.springframework.org/schema/beans&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.springframework.org/schema/beans&lt;/a&gt; &lt;a href=&quot;http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&lt;/a&gt;&quot;&amp;gt;&lt;/p&gt;

&lt;p&gt;  &amp;lt;http-firewall ref=&quot;hf&quot;/&amp;gt;&lt;br/&gt;
  &amp;lt;b:bean class=&quot;example.ForwardAndIncludeAwareHttpFirewall&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;/beans&amp;gt;&lt;/p&gt;</comment>
                            <comment id="60163" author="rwinch" created="Mon, 1 Nov 2010 15:40:48 +0000"  >&lt;p&gt;Sorry I got interrupted and didn&apos;t see your post (I had left the tab open). I actually was thinking of the same solution. The attached file is intended for those that are trying for a quick workaround (i.e. it isn&apos;t as clean as I would think a patch would be). For those following the bug, the attached fix doesn&apos;t address the filters=&quot;none&quot;&lt;/p&gt;</comment>
                            <comment id="60220" author="rwinch" created="Wed, 3 Nov 2010 07:20:48 +0000"  >&lt;p&gt;Something else we may need to consider is that forwards can happen from ServletContext as well (i.e. getRequestDispatcher(String path) and getNamedDispatcher(String name)). While Filters injected into the FilterChainProxy may have a hard time getting a hold of FilterConfig that has the ServletContext, they may be implementing ServletContextAware which would inject the ServletContext into them. At the moment I am a bit perplexed on if/how to address this.&lt;/p&gt;</comment>
                            <comment id="60221" author="rwinch" created="Wed, 3 Nov 2010 07:46:20 +0000"  >&lt;p&gt;PS: We may just be able to leverage the presence of forward request attributes (i.e. javax.servlet.forward.request_uri) to determine if the request was forwarded. If it was forwarded, then set stripPaths to false. I think this feature was introduced in Servlet 2.4+ spec, but I am not certain this approach works for all the Servlet Versions we need to support &lt;/p&gt;</comment>
                            <comment id="60233" author="rwinch" created="Wed, 3 Nov 2010 13:53:55 +0000"  >&lt;p&gt;For record keeping purposes. Anyone that is forwarding using ServletContext can provide their own implementation of the HttpFirewall or switch to using the HttpServletRequest to obtain the RequestDispatcher.&lt;/p&gt;</comment>
                            <comment id="60408" author="rwinch" created="Mon, 8 Nov 2010 06:50:12 +0000"  >&lt;p&gt;For those experiencing this issue, a variation of the fix that was submitted can be applied to 3.0.4.RELEASE using the following.&lt;/p&gt;

&lt;p&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&lt;br/&gt;
&amp;lt;b:beans xmlns:b=&quot;http://www.springframework.org/schema/beans&quot;&lt;br/&gt;
xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&lt;br/&gt;
xmlns=&quot;http://www.springframework.org/schema/security&quot;&lt;br/&gt;
xmlns&lt;img class=&quot;emoticon&quot; src=&quot;https://jira.spring.io/images/icons/emoticons/tongue.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;=&quot;http://www.springframework.org/schema/p&quot;&lt;br/&gt;
xsi:schemaLocation=&quot;http://www.springframework.org/schema/security &lt;a href=&quot;http://www.springframework.org/schema/security/spring-security-3.0.4.xsd&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.springframework.org/schema/security/spring-security-3.0.4.xsd&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://www.springframework.org/schema/beans&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.springframework.org/schema/beans&lt;/a&gt; &lt;a href=&quot;http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&lt;/a&gt;&quot;&amp;gt;&lt;/p&gt;

&lt;p&gt;  &amp;lt;http-firewall ref=&quot;firewall&quot;/&amp;gt;&lt;br/&gt;
  &amp;lt;b:bean id=&quot;firewall&quot; class=&quot;example.RequestDispatcherAwareHttpFirewall&quot;/&amp;gt;&lt;br/&gt;
  ...&lt;br/&gt;
&amp;lt;/beans&amp;gt; &lt;/p&gt;</comment>
                            <comment id="60507" author="snicoll" created="Wed, 10 Nov 2010 02:42:55 +0000"  >&lt;p&gt;The fix attached to this issue has two issues:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;The imports on spring security are wrong, it&apos;s missing a web&lt;/li&gt;
	&lt;li&gt;It does not fix the problem with filter=&quot;none&quot;&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="60526" author="rwinch" created="Wed, 10 Nov 2010 08:00:53 +0000"  >&lt;p&gt;Thank you for your feedback.&lt;/p&gt;

&lt;p&gt;&amp;gt; The imports on spring security are wrong, it&apos;s missing a web &lt;/p&gt;

&lt;p&gt;Can you elaborate on what you mean by this?&lt;/p&gt;

&lt;p&gt;&amp;gt; It does not fix the problem with filter=&quot;none&quot; &lt;/p&gt;

&lt;p&gt;You are correct and it does not attempt to. This is logged as a separate issue (&lt;a href=&quot;https://jira.spring.io/browse/SEC-1608&quot; title=&quot;FirewalledRequest.reset() is not called for a resource with no filters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SEC-1608&quot;&gt;&lt;del&gt;SEC-1608&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="60592" author="snicoll" created="Thu, 11 Nov 2010 23:59:29 +0000"  >&lt;p&gt;Rob,&lt;/p&gt;

&lt;p&gt;Your patch is built against Spring Security 2.0.x. I use 3.0.x. In 3.0.x, these classes are in org.springframework.security.web.firewall&lt;/p&gt;

&lt;p&gt;No biggie. For the separated issue, thanks. I can see the support has added a comment with the workarounds.&lt;/p&gt;</comment>
                            <comment id="124537" author="issuemaster" created="Sat, 6 Feb 2016 06:15:50 +0000"  >&lt;p&gt;This issue has been migrated to &lt;a href=&quot;https://github.com/spring-projects/spring-security/issues/1846&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/spring-projects/spring-security/issues/1846&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="35228">SEC-1633</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10151">
                    <name>Relate</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="34627">SEC-1608</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="17339" name="RequestDispatcherAwareHttpFirewall.java" size="1971" author="rwinch" created="Mon, 8 Nov 2010 06:50:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 1 Nov 2010 15:04:43 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10280" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10721</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01yj3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11471</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10381" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Ranking</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11447</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10120" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>Reference URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[http://forum.springsource.org/showthread.php?p=327115#post327115]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>