<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Fri Dec 23 10:41:35 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SEC-1102/SEC-1102.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SEC-1102] CLONE -SecurityContextHolderAwareRequestWrapper isUserInRole always returns null when user is anonymously authenticated</title>
                <link>https://jira.spring.io/browse/SEC-1102</link>
                <project id="10040" key="SEC">Spring Security</project>
                    <description>&lt;p&gt;In our application a user can be fully authenticated or anymous authenticated.&lt;br/&gt;
In the later case the security token is the AnonymousAuthenticationToken.&lt;/p&gt;

&lt;p&gt;When a user is anonymously authenticated and I the isUserInRole(&apos;ROLE_ANONYMOUS&apos;) functionality on the In HttpServletRequest always get &apos;false&apos;.&lt;br/&gt;
I verified the SecurityContextHolder.getContext().getAuthentication() -&amp;gt; I can clearly see that the token is AnonymousAuthenticationToken and that the user has the ROLE_ANONYMOUS credentials, so that is not the problem.&lt;/p&gt;

&lt;p&gt;After debug I found the HttpServletRequest wrapped by the SavedRequestAwareWrapper which in turn inherits the &apos;isUserInRole&apos; behaviour from SecurityContextHolderAwareRequestWrapper&lt;br/&gt;
However, the isUserInRole on the latter class first calls getAuthentication, this method looks like this:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;code&amp;#93;&lt;/span&gt;&lt;br/&gt;
//SecurityContextHolderAwareRequestWrapper - line 74&lt;br/&gt;
  private Authentication getAuthentication() {&lt;br/&gt;
        Authentication auth = SecurityContextHolder.getContext().getAuthentication();&lt;/p&gt;

&lt;p&gt;        if (!authenticationTrustResolver.isAnonymous(auth)) &lt;/p&gt;
{
            return auth;
        }

&lt;p&gt;        return null;&lt;br/&gt;
    }&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;/code&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;So what happens is, is that the Authentication is not returned, but null instead&lt;br/&gt;
Therefore the isUserInRole returns false.&lt;/p&gt;

&lt;p&gt;I think this is a bug; why should isUserInRole not work when the user has the ROLE_ANONYMOUS ?&lt;/p&gt;</description>
                <environment></environment>
        <key id="25588">SEC-1102</key>
            <summary>CLONE -SecurityContextHolderAwareRequestWrapper isUserInRole always returns null when user is anonymously authenticated</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="luke">Luke Taylor</assignee>
                                    <reporter username="errorken">errorken</reporter>
                        <labels>
                    </labels>
                <created>Sun, 8 Feb 2009 18:48:28 +0000</created>
                <updated>Sat, 6 Feb 2016 06:10:23 +0000</updated>
                            <resolved>Tue, 28 Apr 2009 12:59:59 +0000</resolved>
                                    <version>2.0.4</version>
                                    <fixVersion>3.0.0 M1</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="43087" author="luke" created="Sun, 15 Mar 2009 18:27:20 +0000"  >&lt;p&gt;Closing. See comments in the original issue.&lt;/p&gt;</comment>
                            <comment id="123992" author="issuemaster" created="Sat, 6 Feb 2016 06:10:23 +0000"  >&lt;p&gt;This issue has been migrated to &lt;a href=&quot;https://github.com/spring-projects/spring-security/issues/1352&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/spring-projects/spring-security/issues/1352&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="25580">SEC-1101</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 15 Mar 2009 18:27:20 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10280" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10520</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i024af:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12404</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10381" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Ranking</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12242</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>