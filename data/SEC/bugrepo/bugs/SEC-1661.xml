<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Fri Dec 23 11:15:51 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SEC-1661/SEC-1661.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SEC-1661] LDAP search base should not require JNDI escaping in addition to LDAP escaping for special characters</title>
                <link>https://jira.spring.io/browse/SEC-1661</link>
                <project id="10040" key="SEC">Spring Security</project>
                    <description>&lt;p&gt;Having double quotes in the base dn (search base) does not work.  &lt;/p&gt;

&lt;p&gt;The following base dn value is valid, but does not work:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;OU=&quot;Admin Users&quot;,OU=TEST-NC,DC=TESTCustomers,DC=Com&lt;/li&gt;
&lt;/ul&gt;




</description>
                <environment></environment>
        <key id="36029">SEC-1661</key>
            <summary>LDAP search base should not require JNDI escaping in addition to LDAP escaping for special characters</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://jira.spring.io/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="luke">Luke Taylor</assignee>
                                    <reporter username="jkonicki">Jason Konicki</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Jan 2011 13:48:23 +0000</created>
                <updated>Sat, 6 Feb 2016 06:16:26 +0000</updated>
                            <resolved>Tue, 1 Feb 2011 10:49:10 +0000</resolved>
                                    <version>3.0.1</version>
                                    <fixVersion>3.1.0.RC1</fixVersion>
                    <fixVersion>3.0.6</fixVersion>
                                    <component>LDAP</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="62767" author="luke" created="Wed, 26 Jan 2011 07:11:31 +0000"  >&lt;p&gt;If you are reporting an issue, please check with the latest release (3.0.5 in this case).&lt;/p&gt;

&lt;p&gt;The DN you&apos;ve given here is not valid - it would be rejected if you entered it in an LDIF file and attempted to import it into a directory. Likewise if you used it as an argument to any LDAP operation. Quotes in DNs need to be escaped. If the name in the directory contains quotes then you need to use ou= \&quot;Admin Users\&quot;.&lt;/p&gt;

&lt;p&gt;Escaping is further complicated when used from Java, because of JNDI, see:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://download.oracle.com/javase/jndi/tutorial/beyond/names/syntax.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://download.oracle.com/javase/jndi/tutorial/beyond/names/syntax.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;so it wouldn&apos;t surprise me if there were other bugs in this area, but &quot;does not work&quot; isn&apos;t much to go on. Please explain what the directory entries contain, what configuration parameters you are using (make sure DN strings are LDAP escaped), what exceptions occur (if any) and what actually goes wrong.&lt;/p&gt;</comment>
                            <comment id="62772" author="jkonicki" created="Wed, 26 Jan 2011 07:46:19 +0000"  >&lt;p&gt;Sorry about the lack of information:&lt;/p&gt;

&lt;p&gt;I also tested with latest code from git and modified the BindAuthenticatorTests to test the quoted string, but it failed.  &lt;/p&gt;


&lt;p&gt;Here is the stacktrace when the quoted string is used instead of the non-quoted string:&lt;br/&gt;
org.springframework.security.authentication.BadCredentialsException: Bad credentials&lt;br/&gt;
at org.springframework.security.ldap.authentication.LdapAuthenticationProvider.authenticate(LdapAuthenticationProvider.java:266)&lt;br/&gt;
at com.hyperic.hq.security.LdapHQAuthenticationProvider.authenticateFromSearchBase(LdapHQAuthenticationProvider.java:198)&lt;br/&gt;
at com.hyperic.hq.security.LdapHQAuthenticationProvider.authenticate(LdapHQAuthenticationProvider.java:165)&lt;br/&gt;
at org.hyperic.hq.security.InternalAuthenticationProvider.authenticate(InternalAuthenticationProvider.java:88)&lt;br/&gt;
at org.springframework.security.authentication.ProviderManager.doAuthentication(ProviderManager.java:121)&lt;br/&gt;
at org.springframework.security.authentication.AbstractAuthenticationManager.authenticate(AbstractAuthenticationManager.java:49)&lt;br/&gt;
at org.hyperic.hq.auth.server.session.AuthManagerImpl.authenticate(AuthManagerImpl.java:67)&lt;br/&gt;
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:307)&lt;br/&gt;
at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)&lt;br/&gt;
at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)&lt;br/&gt;
at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:80)&lt;br/&gt;
at org.hyperic.hq.monitor.aop.aspects.PerformanceMonitor.monitorServiceMethod(PerformanceMonitor.java:84)&lt;br/&gt;
at sun.reflect.GeneratedMethodAccessor324.invoke(Unknown Source)&lt;br/&gt;
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:622)&lt;br/&gt;
at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:611)&lt;br/&gt;
at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:65)&lt;br/&gt;
at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)&lt;br/&gt;
at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:108)&lt;br/&gt;
at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)&lt;br/&gt;
at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:89)&lt;br/&gt;
at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)&lt;br/&gt;
at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:202)&lt;br/&gt;
at $Proxy46.authenticate(Unknown Source)&lt;/p&gt;</comment>
                            <comment id="62774" author="luke" created="Wed, 26 Jan 2011 09:08:35 +0000"  >&lt;p&gt;Ok, this still doesn&apos;t clear up what the directory contains or what the configuration valuues are. If you write a basic Java LDAP test:&lt;/p&gt;

&lt;p&gt;        Hashtable&amp;lt;String,String&amp;gt; env = new Hashtable&amp;lt;String,String&amp;gt;();&lt;br/&gt;
        env.put(Context.INITIAL_CONTEXT_FACTORY, &quot;com.sun.jndi.ldap.LdapCtxFactory&quot;);&lt;br/&gt;
        env.put(Context.PROVIDER_URL, &quot;ldap://127.0.0.1:22389/dc=springsource,dc=com&quot;); // use your URL&lt;br/&gt;
        env.put(Context.SECURITY_AUTHENTICATION, &quot;simple&quot;);&lt;br/&gt;
        env.put(Context.SECURITY_PRINCIPAL, &quot;cn=admin,dc=springsource,dc=com&quot;); // use whatever username and credentials you need to perform the search&lt;br/&gt;
        env.put(Context.SECURITY_CREDENTIALS, &quot;password&quot;);&lt;/p&gt;

&lt;p&gt;        InitialDirContext idc = new InitialDirContext(env);&lt;br/&gt;
        SearchControls searchControls = new SearchControls();&lt;br/&gt;
        searchControls.setSearchScope(SearchControls.SUBTREE_SCOPE);&lt;/p&gt;

&lt;p&gt;        String baseDn = ?&lt;br/&gt;
        String username = ?&lt;/p&gt;

&lt;p&gt;        NamingEnumeration&amp;lt;SearchResult&amp;gt; matches = idc.search(baseDn, &quot;(cn=&lt;/p&gt;
{0}
&lt;p&gt;)&quot;, new Object[] &lt;/p&gt;
{username}
&lt;p&gt;, searchControls);&lt;/p&gt;

&lt;p&gt;        while(matches.hasMore()) &lt;/p&gt;
{
            SearchResult match = matches.next();
            System.out.println(&quot;**** Match: &quot; +match.getName());

        }

&lt;p&gt;Then what value of the string &quot;baseDn&quot; gives you a match on a valid username?&lt;/p&gt;
</comment>
                            <comment id="62775" author="luke" created="Wed, 26 Jan 2011 09:19:35 +0000"  >&lt;p&gt;I&apos;ve added the use of an LDAP DistinguishedName to the baseDn to avoid the need for JNDI escaping (see the link to the Java Tutorial above). However, the string still needs to be LDAP escaped in the configuration if it contains any special characters.&lt;/p&gt;</comment>
                            <comment id="62970" author="luke" created="Tue, 1 Feb 2011 04:09:14 +0000"  >&lt;p&gt;Does the DN in the directory actually contain quotes?&lt;/p&gt;

&lt;p&gt;If not, then they shouldn&apos;t be there in the configuration (either escaped or otherwise).&lt;/p&gt;

&lt;p&gt;It looks like you are saying that the system should treat one with quotes as if they weren&apos;t there - i.e. that the original system treated DNs with and without the quotes in the same way. I&apos;d regard that as a bug in the original system. Since quotes are valid content in a DN, if the actual value contained in the directory doesn&apos;t have any nor should the value you use to represent it elsewhere.&lt;/p&gt;</comment>
                            <comment id="62979" author="jkonicki" created="Tue, 1 Feb 2011 10:19:13 +0000"  >&lt;p&gt;Luke,&lt;/p&gt;

&lt;p&gt;I received feedback from the customer, their DN was &quot;OU=Admin-Users,OU=TEST-NC,DC=TESTCustomers,DC=Com&quot; (without the quotes around Admin-Users).&lt;br/&gt;
So it appears that the other 3rdparty Ldap must have been stripping off the quotes which would not be correct as you said. &lt;/p&gt;

&lt;p&gt;Thanks for the clarification on this issue. &lt;/p&gt;</comment>
                            <comment id="62980" author="luke" created="Tue, 1 Feb 2011 10:48:58 +0000"  >&lt;p&gt;The initial report is essentially invalid, so changing the title to reflect the minor change to the code that has actually been made - i.e. the search base should now only require LDAP escaping.&lt;/p&gt;</comment>
                            <comment id="124598" author="issuemaster" created="Sat, 6 Feb 2016 06:16:26 +0000"  >&lt;p&gt;This issue has been migrated to &lt;a href=&quot;https://github.com/spring-projects/spring-security/issues/1899&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/spring-projects/spring-security/issues/1899&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 26 Jan 2011 07:11:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10280" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12871</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02sdj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16306</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10381" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Ranking</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>15382</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>