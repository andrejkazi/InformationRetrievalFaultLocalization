<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Fri Dec 23 11:12:31 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SEC-478/SEC-478.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SEC-478] Incorrect decoding of base64 cookie value by TokenBasedRememberMeServices.autoLogin</title>
                <link>https://jira.spring.io/browse/SEC-478</link>
                <project id="10040" key="SEC">Spring Security</project>
                    <description>&lt;p&gt;This bug can be observed by using the contact example application and trying to login with dianne/emu while using the &quot;remember me option&quot;. This user mght not be remembered, as it is the case for other users. this, however, might not be reproductible under certain conditions.&lt;/p&gt;

&lt;p&gt;The heart of the problem is that a user will not be remembered if the resulting base64 encoded value stored in in cookie has a number of significant caracters that is not an exact multiple of 4. In such condition, according to thee base64 specification, the value is padded with trailing &quot;=&quot;. The result is a cookie value padded with &quot;%3D&quot;, which is ok.&lt;/p&gt;

&lt;p&gt;When the cookie value is retrieved by the autoLogin method, the trailing &quot;=&quot; are lost. Although on might think this should be detected by Base64.Base64.isArrayByteBase64(), it is not because this method returns true if the value contains only valid character, even if the value itself is not valid.&lt;/p&gt;

&lt;p&gt;Workaround :&lt;/p&gt;

&lt;p&gt;A simple workaround is to add the missing trailing &quot;=&quot; to the retrieved value, which can be done with the following code :&lt;/p&gt;

&lt;p&gt;  public Authentication autoLogin(HttpServletRequest request, HttpServletResponse response) {&lt;br/&gt;
    Cookie[] cookies = request.getCookies();&lt;/p&gt;

&lt;p&gt;    if ((cookies == null) || (cookies.length == 0)) &lt;/p&gt;
{
      return null;
    }

&lt;p&gt;    for (int i = 0; i &amp;lt; cookies.length; i++) {&lt;br/&gt;
      if (ACEGI_SECURITY_HASHED_REMEMBER_ME_COOKIE_KEY.equals(cookies&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.getName())) {&lt;br/&gt;
        String cookieValue = cookies&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.getValue();&lt;br/&gt;
        /*************************&lt;br/&gt;
          PATCH BEGINS HERE&lt;br/&gt;
         *************************/&lt;br/&gt;
        for (int j = 0; j &amp;lt; cookieValue.length() % 4; j++) &lt;/p&gt;
{
          cookieValue = cookieValue + &quot;=&quot;;
        }
&lt;p&gt;        /************************&lt;br/&gt;
        PATCH ENDS HERE&lt;br/&gt;
        *************************/&lt;br/&gt;
        if (Base64.isArrayByteBase64(cookieValue.getBytes())) {&lt;br/&gt;
          if (logger.isDebugEnabled()) &lt;/p&gt;
{
            logger.debug(&quot;Remember-me cookie detected&quot;);
          }

&lt;p&gt;Fix: &lt;/p&gt;

&lt;p&gt;The real fix would probably concern either Base64.decodeBase64 or Cookie.getValue&lt;/p&gt;</description>
                <environment>Windows XP - Java 5 - Jetty - IE7/Firefox 2</environment>
        <key id="16737">SEC-478</key>
            <summary>Incorrect decoding of base64 cookie value by TokenBasedRememberMeServices.autoLogin</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="balex">Ben Alex</assignee>
                                    <reporter username="volga">Pierre-Yves Saumont</reporter>
                        <labels>
                    </labels>
                <created>Sun, 29 Apr 2007 19:03:34 +0000</created>
                <updated>Sat, 6 Feb 2016 06:33:02 +0000</updated>
                            <resolved>Tue, 22 May 2007 17:46:17 +0000</resolved>
                                    <version>1.0.3</version>
                    <version>1.0.4</version>
                                    <fixVersion>1.0.4</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="23872" author="balex" created="Mon, 21 May 2007 19:33:25 +0000"  >&lt;p&gt;As noted, this is really a bug in Commons Codec 1.3, which provides the Base64 class and static methods being used by TokenBasedRememberMeServices. However, we will add this patch to workaround the issue. It&apos;s suggested you also log a bug report with Commons Codec so it&apos;s fixed in the utility library.&lt;/p&gt;</comment>
                            <comment id="23925" author="balex" created="Tue, 22 May 2007 17:46:17 +0000"  >&lt;p&gt;Fixed in SVN revision 1849.&lt;/p&gt;</comment>
                            <comment id="126458" author="issuemaster" created="Sat, 6 Feb 2016 06:33:02 +0000"  >&lt;p&gt;This issue has been migrated to &lt;a href=&quot;https://github.com/spring-projects/spring-security/issues/739&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/spring-projects/spring-security/issues/739&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 21 May 2007 19:33:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10280" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20366</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02713:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12848</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10381" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Ranking</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12651</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>