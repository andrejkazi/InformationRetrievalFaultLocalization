<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Fri Dec 23 10:58:57 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SEC-725/SEC-725.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SEC-725] PasswordEncoderParser: &lt;security:password-encoder&gt; element does not pick up &apos;base64&apos; attribute value</title>
                <link>https://jira.spring.io/browse/SEC-725</link>
                <project id="10040" key="SEC">Spring Security</project>
                    <description>&lt;p&gt;In my Spring configuration I have the following fragment:&lt;/p&gt;

&lt;p&gt;Code:&lt;br/&gt;
&amp;lt;security:authentication-provider&amp;gt;&lt;br/&gt;
    &amp;lt;security:password-encoder hash=&quot;md5&quot; base64=&quot;true&quot;/&amp;gt;&lt;br/&gt;
    ......&lt;br/&gt;
&amp;lt;/security:authentication-provider&amp;gt;&lt;/p&gt;

&lt;p&gt;The problem is that even although I specified base64=&quot;true&quot; the configuration parser does not pick it up. My PasswordEncoder is still installed with &apos;encodeHashAsBase64&apos; property &apos;false&apos;.&lt;/p&gt;

&lt;p&gt;Analysis: After debugging I was able to locate the reason for the bug. It is located on the line 73 of class org.springframework.security.config.PasswordEncoderParser in the method parse(Element element, ParserContext parserContext)&lt;/p&gt;

&lt;p&gt;This code goes like this:&lt;br/&gt;
Code:&lt;/p&gt;

&lt;p&gt;private void parse(Element element, ParserContext parserContext) {&lt;br/&gt;
    ...&lt;br/&gt;
    if (StringUtils.hasText(ref)) &lt;/p&gt;
{
            ....
    }
&lt;p&gt; else {&lt;br/&gt;
      Class beanClass = (Class) ENCODER_CLASSES.get(hash);&lt;br/&gt;
      RootBeanDefinition beanDefinition = new RootBeanDefinition(beanClass);&lt;br/&gt;
      beanDefinition.setSource(parserContext.extractSource(element));&lt;br/&gt;
      if (useBase64) {&lt;br/&gt;
         if (beanClass.isAssignableFrom(BaseDigestPasswordEncoder.class)) &lt;/p&gt;
{
            beanDefinition.getPropertyValues().addPropertyValue(&quot;encodeHashAsBase64&quot;, &quot;true&quot;);
         }
&lt;p&gt; else &lt;/p&gt;
{
            logger.warn(ATT_BASE_64 + &quot; isn&apos;t compatible with &quot; + OPT_HASH_LDAP_SHA + &quot; and will be ignored&quot;);
         }
&lt;p&gt;      }&lt;br/&gt;
      passwordEncoder = beanDefinition;&lt;br/&gt;
  }&lt;/p&gt;

&lt;p&gt;The problematic part is here:&lt;br/&gt;
if (beanClass.isAssignableFrom(BaseDigestPasswordEncod er.class)) {&lt;br/&gt;
beanDefinition.getPropertyValues().addPropertyValue(&quot;encodeHashAsBase64&quot;, &quot;true&quot;);&lt;br/&gt;
} else {&lt;br/&gt;
logger.warn(ATT_BASE_64 + &quot; isn&apos;t compatible with &quot; + OPT_HASH_LDAP_SHA + &quot; and will be ignored&quot;);&lt;br/&gt;
}&lt;br/&gt;
The condition in the &apos;if&apos; statement should be coded the other way around, i.e.&lt;br/&gt;
if (BaseDigestPasswordEncoder.class.isAssignableFrom(b eanClass))&lt;/p&gt;
{...}
&lt;p&gt; to set up &quot;encodeHashAsBase64&quot; properly.&lt;/p&gt;

&lt;p&gt;Also: the warning message in the &apos;else&apos; clause of &apos;if&apos; statment above is incorrect too. No matter what algorithm you configure in your &amp;lt;securityassword-encoder&amp;gt; it always outputs &apos;&lt;/p&gt;
{sha}
&lt;p&gt;&apos;. The reason is that insead of the runtime &apos;hash&apos; parameter the message hardcodes OPT_HASH_LDAP_SHA.&lt;/p&gt;</description>
                <environment>JDK 1.5, Windows</environment>
        <key id="21237">SEC-725</key>
            <summary>PasswordEncoderParser: &lt;security:password-encoder&gt; element does not pick up &apos;base64&apos; attribute value</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="luke">Luke Taylor</assignee>
                                    <reporter username="petrovs">Sergey Petrov</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Mar 2008 04:26:57 +0000</created>
                <updated>Sat, 6 Feb 2016 06:35:52 +0000</updated>
                            <resolved>Sun, 23 Mar 2008 10:40:15 +0000</resolved>
                                    <version>2.0.0 M2</version>
                                    <fixVersion>2.0.0 RC1</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                    <timeoriginalestimate seconds="0">0d</timeoriginalestimate>
                            <timeestimate seconds="0">0d</timeestimate>
                                        <comments>
                            <comment id="33658" author="petrovs" created="Thu, 20 Mar 2008 05:29:41 +0000"  >&lt;p&gt;There is also another issue with this code. Line 2 of parse(Element element, ParserContext parserContext) goes like this:&lt;/p&gt;

&lt;p&gt;private void parse(Element element, ParserContext parserContext) {&lt;br/&gt;
        ................................&lt;br/&gt;
        boolean useBase64 = StringUtils.hasText(element.getAttribute(ATT_BASE_64));&lt;br/&gt;
        .................................&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;That means that even if the user specified base64=&quot;false&quot; on &amp;lt;security:password-encoder&amp;gt; element, the code will still think that &apos;useBase64&apos; is true!!!!&lt;/p&gt;</comment>
                            <comment id="33750" author="luke" created="Sun, 23 Mar 2008 10:40:15 +0000"  >&lt;p&gt;Thanks for spotting this. I&apos;ve made the change you suggested. The warning message is only a problem because of the other issue. The lDAP sha password encoder is the only one which doesn&apos;t extend BaseDigestPasswordEncoder. However I&apos;ve changed that too for compatitibility with future changes in case we add new hashing algorithms.&lt;/p&gt;</comment>
                            <comment id="126730" author="issuemaster" created="Sat, 6 Feb 2016 06:35:52 +0000"  >&lt;p&gt;This issue has been migrated to &lt;a href=&quot;https://github.com/spring-projects/spring-security/issues/987&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/spring-projects/spring-security/issues/987&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 23 Mar 2008 10:40:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10280" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20143</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i04nhb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>27178</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10381" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Ranking</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21827</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>