<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Fri Dec 23 10:33:23 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SEC-837/SEC-837.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SEC-837] SpringSecurityLdapTemplate.searchForSingleAttributeValues, no string escape for formattedFilter</title>
                <link>https://jira.spring.io/browse/SEC-837</link>
                <project id="10040" key="SEC">Spring Security</project>
                    <description>&lt;p&gt;When formattedFilter looks like this: (member=CN=Jozwicki\, Jakub, ou=IT, dc=example, dc=com)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;please notice &quot;\&quot; before first comma, search doesn&apos;t return any results.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I don&apos;t know if it is MS AD specific but I had to add code replacing \ with &lt;br class=&quot;atl-forced-newline&quot; /&gt;:&lt;/p&gt;

&lt;p&gt;String formattedFilter = MessageFormat.format(filter, params);&lt;br/&gt;
formattedFilter = formattedFilter.replaceAll(&quot;\\\\&quot;, &quot;\\\\\\\\&quot;);&lt;/p&gt;

&lt;p&gt;-------&lt;br/&gt;
Standalone code:&lt;/p&gt;

&lt;p&gt;public class LDAPSearch {&lt;/p&gt;

&lt;p&gt;	public final static void main(String[] args) throws Exception {&lt;/p&gt;

&lt;p&gt;		Hashtable env = new Hashtable();&lt;br/&gt;
		env.put(Context.INITIAL_CONTEXT_FACTORY, &quot;com.sun.jndi.ldap.LdapCtxFactory&quot;);&lt;br/&gt;
		env.put(Context.PROVIDER_URL, &quot;ldap://192.168.1.191:389&quot;);&lt;br/&gt;
		env.put(Context.SECURITY_PRINCIPAL, &quot;pld1&lt;br class=&quot;atl-forced-newline&quot; /&gt;jjozwic&quot;);&lt;br/&gt;
		env.put(Context.SECURITY_CREDENTIALS, &quot;*******&quot;);&lt;/p&gt;

&lt;p&gt;		DirContext ctx = new InitialDirContext(env);&lt;br/&gt;
		SearchControls controls = new SearchControls();&lt;br/&gt;
		controls.setSearchScope(SearchControls.SUBTREE_SCOPE);&lt;br/&gt;
		controls.setReturningObjFlag(true);&lt;br/&gt;
		controls.setReturningAttributes(null);&lt;br/&gt;
		NamingEnumeration result = ctx.search(&quot;dc=pld1,dc=net&quot;, &quot;(member=CN=Jozwicki\\\\, Jakub, OU=IT, DC=pld1, DC=net)&quot;, controls);&lt;br/&gt;
		while (result.hasMoreElements()) &lt;/p&gt;
{
			System.out.println(result.next()+&quot;\n&quot;);
		}
&lt;p&gt;		&lt;br/&gt;
	}&lt;/p&gt;

&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;proved that &lt;br class=&quot;atl-forced-newline&quot; /&gt; is needed.&lt;/p&gt;</description>
                <environment>MS AD @ Windows 2003 R2</environment>
        <key id="22164">SEC-837</key>
            <summary>SpringSecurityLdapTemplate.searchForSingleAttributeValues, no string escape for formattedFilter</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="luke">Luke Taylor</assignee>
                                    <reporter username="jakub007">Jakub Jozwicki</reporter>
                        <labels>
                    </labels>
                <created>Thu, 15 May 2008 20:32:32 +0000</created>
                <updated>Sat, 6 Feb 2016 06:37:13 +0000</updated>
                            <resolved>Wed, 21 May 2008 00:27:41 +0000</resolved>
                                    <version>2.0.1</version>
                                    <fixVersion>2.0.2</fixVersion>
                                    <component>LDAP</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="35874" author="luke" created="Tue, 20 May 2008 06:27:50 +0000"  >&lt;p&gt;I think this is probably a LDAP filter encoding issue (it&apos;s not to do with special characters in JNDI names as I originally thought - the DN is being used as an attribute value, not as a name). The filter strings must be escaped according to RFC 2254. Since the DN contains an escaped comma, the backslash should be escaped as \5c.&lt;/p&gt;

&lt;p&gt;So for a DN of &quot;cn=mouse\, jerry, ou=people, dc=springframework, dc=org&quot;&lt;/p&gt;

&lt;p&gt;the filter should be&lt;/p&gt;

&lt;p&gt;(member=cn=mouse\5c, jerry, ou=people, dc=springframework, dc=org)&lt;/p&gt;

&lt;p&gt;I&apos;ve tested that with Apache Directory and it seems to work. Could you try it against AD please?&lt;/p&gt;</comment>
                            <comment id="35904" author="jakub007" created="Tue, 20 May 2008 19:37:07 +0000"  >&lt;p&gt;Java code:&lt;br/&gt;
NamingEnumeration result = ctx.search(&quot;dc=pld1,dc=net&quot;, &quot;(member=CN=Jozwicki&lt;br class=&quot;atl-forced-newline&quot; /&gt;5c, Jakub, OU=IT, DC=pld1, DC=net)&quot;, controls);&lt;/p&gt;

&lt;p&gt;works.&lt;/p&gt;</comment>
                            <comment id="35918" author="luke" created="Wed, 21 May 2008 00:27:41 +0000"  >&lt;p&gt;Ok, thatnks. The latest snapshots should resolve this issue.&lt;/p&gt;</comment>
                            <comment id="126853" author="issuemaster" created="Sat, 6 Feb 2016 06:37:13 +0000"  >&lt;p&gt;This issue has been migrated to &lt;a href=&quot;https://github.com/spring-projects/spring-security/issues/1096&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/spring-projects/spring-security/issues/1096&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 20 May 2008 06:27:50 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10280" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20043</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02sd3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16304</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10381" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Ranking</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>15380</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>