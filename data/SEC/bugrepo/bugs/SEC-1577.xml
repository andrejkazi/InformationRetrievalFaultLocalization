<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Fri Dec 23 11:40:35 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SEC-1577/SEC-1577.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SEC-1577] NPE in AuthorityUtils in combination with RoleHierarchy and User with empty authorities collection</title>
                <link>https://jira.spring.io/browse/SEC-1577</link>
                <project id="10040" key="SEC">Spring Security</project>
                    <description>&lt;p&gt;If have the following intercept-url defined in my security config (with expressions):&lt;br/&gt;
&amp;lt;security:intercept-url pattern=&quot;/.*/$&lt;/p&gt;
{webapp.context}
&lt;p&gt;/flow/welcome&quot; access=&quot;hasRole(&apos;ROLE_USER&apos;)&quot; /&amp;gt;&lt;/p&gt;

&lt;p&gt;I also use role hierarchies.  After authentication the user arrives at the welcome page.  When the user hasn&apos;t got any authorities, I receive a NPE because in RoleHierarchyImpl, which is called by SecurityExpressionRoot, the empty authorities Set is set to null:&lt;/p&gt;

&lt;p&gt;    public Collection&amp;lt;GrantedAuthority&amp;gt; getReachableGrantedAuthorities(Collection&amp;lt;GrantedAuthority&amp;gt; authorities) {&lt;br/&gt;
        if (authorities == null || authorities.isEmpty()) &lt;/p&gt;
{
            return null;
        }

&lt;p&gt;In AuthorityUtils, the size() method is called on the null collection:&lt;br/&gt;
    public static Set&amp;lt;String&amp;gt; authorityListToSet(Collection&amp;lt;GrantedAuthority&amp;gt; userAuthorities) {&lt;br/&gt;
        Set&amp;lt;String&amp;gt; set = new HashSet&amp;lt;String&amp;gt;(userAuthorities.size());&lt;/p&gt;


&lt;p&gt;java.lang.NullPointerException&lt;br/&gt;
	at org.springframework.security.core.authority.AuthorityUtils.authorityListToSet(AuthorityUtils.java:39)&lt;br/&gt;
	at org.springframework.security.access.expression.SecurityExpressionRoot.getAuthoritySet(SecurityExpressionRoot.java:104)&lt;br/&gt;
	at org.springframework.security.access.expression.SecurityExpressionRoot.hasAnyRole(SecurityExpressionRoot.java:44)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.springframework.expression.spel.support.ReflectiveMethodExecutor.execute(ReflectiveMethodExecutor.java:58)&lt;br/&gt;
	at org.springframework.expression.spel.ast.MethodReference.getValueInternal(MethodReference.java:76)&lt;br/&gt;
	at org.springframework.expression.spel.ast.SpelNodeImpl.getTypedValue(SpelNodeImpl.java:102)&amp;lt;security:intercept-url pattern=&quot;/.*&lt;/p&gt;</description>
                <environment>Windows XP, Java 1.6, Jetty</environment>
        <key id="33483">SEC-1577</key>
            <summary>NPE in AuthorityUtils in combination with RoleHierarchy and User with empty authorities collection</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="luke">Luke Taylor</assignee>
                                    <reporter username="gbuys">Gert Buys</reporter>
                        <labels>
                    </labels>
                <created>Thu, 23 Sep 2010 08:22:50 +0000</created>
                <updated>Sat, 6 Feb 2016 06:15:33 +0000</updated>
                            <resolved>Fri, 15 Oct 2010 09:52:57 +0000</resolved>
                                    <version>3.0.3</version>
                                    <fixVersion>3.0.4</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="59301" author="luke" created="Fri, 15 Oct 2010 09:52:57 +0000"  >&lt;p&gt;Duplicate of &lt;a href=&quot;https://jira.spring.io/browse/SEC-1507&quot; title=&quot;NullPointerException in RoleVoter if original UserDetails#getAuthorities() is empty and if RoleHierarchy is enabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SEC-1507&quot;&gt;&lt;del&gt;SEC-1507&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="124506" author="issuemaster" created="Sat, 6 Feb 2016 06:15:33 +0000"  >&lt;p&gt;This issue has been migrated to &lt;a href=&quot;https://github.com/spring-projects/spring-security/issues/1818&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/spring-projects/spring-security/issues/1818&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="32032">SEC-1507</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 15 Oct 2010 09:52:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10280" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19406</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03u5j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22427</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10381" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Ranking</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18883</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>