<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Fri Dec 23 10:26:41 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SEC-602/SEC-602.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SEC-602] Acl (Acls) class ObjectIdentityRetrievalStrategyImpl doesn&apos;t work well with proxied objects</title>
                <link>https://jira.spring.io/browse/SEC-602</link>
                <project id="10040" key="SEC">Spring Security</project>
                    <description>&lt;p&gt;When using the AclEntryAfterInvocationProvider to check acl access on an object which has been instantiated by (in my case) hibernate, it is possible that hibernate will return a cglib enhanced instance of the object (or it might not).  When  ObjectIdentityRetrievalStrategyImpl then attempts to create an ObjectIdentity for it, that class name it gets is something like &quot;com.mycompany.Foo$$EnhancerByCGLIB$$beb2e4f5&quot;, which does not match up with the class reference in the ObjectIdentity database record which is &quot;com.mycompany.Foo&quot;, and no corresponding ACL entries will be found for the object.&lt;/p&gt;

&lt;p&gt;I&apos;ve found a couple of solutions for this, the first is to deproxy the object immediately after the query using a method something like:&lt;/p&gt;

&lt;p&gt;public static Object deproxy(Object obj)&lt;br/&gt;
  {&lt;br/&gt;
    Hibernate.initialize(obj);&lt;/p&gt;

&lt;p&gt;    if (obj == null)&lt;/p&gt;
    {
      return null;
    }

&lt;p&gt;    if (HibernateProxy.class.isInstance(obj))&lt;/p&gt;
    {
      HibernateProxy proxy = (HibernateProxy) obj;
      return proxy.getHibernateLazyInitializer().getImplementation();
    }

&lt;p&gt;    return obj;&lt;br/&gt;
  } &lt;/p&gt;

&lt;p&gt;NOTE: Hibernate.initialise(object) doesn&apos;t work, because although it may flesh out the proxied object, it returns void, so we are still left holding onto the proxy.&lt;/p&gt;

&lt;p&gt;I don&apos;t particularly like this approach, because for every factory method we need to remember to deproxy the found object, and where collections are returned, we&apos;d need to deproxy every object in the collection.&lt;/p&gt;

&lt;p&gt;An alternative solution is to write a ProxyAwareObjectIdentityRetrievalStrategy implementation.  This is feasible because all (I think) classes that use an ObjectIdentityRetrievalStrategy  support dependency injection.&lt;/p&gt;

&lt;p&gt;I&apos;ve had a go at this, and got the cglib enhanced case taken care of, but I also thought that the case where a Jdk proxy is returned needs to be addressed also.  I&apos;ve found a simple way to detect a Jdk proxy, but cannot figure how to get the class name we actually want out of it, as Jdk proxies only work on interfaces, and it&apos;s the InvokationHandler that does all the delegation.&lt;/p&gt;

&lt;p&gt;class and tests will be attached.&lt;/p&gt;</description>
                <environment>ubuntu gusty, Java HotSpot(TM) Client VM (build 1.6.0_01-b06, mixed mode, sharing)&lt;br/&gt;
tomcat 5.5.16</environment>
        <key id="18524">SEC-602</key>
            <summary>Acl (Acls) class ObjectIdentityRetrievalStrategyImpl doesn&apos;t work well with proxied objects</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="balex">Ben Alex</assignee>
                                    <reporter username="svanders">Simon van der Sluis</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 Nov 2007 07:37:38 +0000</created>
                <updated>Sat, 6 Feb 2016 06:34:17 +0000</updated>
                            <resolved>Fri, 4 Apr 2008 13:47:38 +0000</resolved>
                                    <version>1.0.3</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>ACLs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="27634" author="svanders" created="Wed, 14 Nov 2007 07:42:00 +0000"  >&lt;p&gt;ProxyAwareObjectIdentityRetrievalStrategy and tests.&lt;/p&gt;

&lt;p&gt;NOTE: You&apos;ll have to add &lt;br/&gt;
    &amp;lt;dependency&amp;gt;&lt;br/&gt;
      &amp;lt;groupId&amp;gt;cglib&amp;lt;/groupId&amp;gt;&lt;br/&gt;
      &amp;lt;artifactId&amp;gt;cglib&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
      &amp;lt;version&amp;gt;2.1_3&amp;lt;/version&amp;gt;&lt;br/&gt;
      &amp;lt;optional&amp;gt;true&amp;lt;/optional&amp;gt;&lt;br/&gt;
    &amp;lt;/dependency&amp;gt;&lt;/p&gt;

&lt;p&gt;to the core pom.xml for these to compile and test&lt;/p&gt;
</comment>
                            <comment id="34376" author="balex" created="Fri, 4 Apr 2008 13:47:38 +0000"  >&lt;p&gt;Modified ObjectIdentityImpl to use Spring&apos;s ClassUtils class, which correctly extracts the underlaying superclass from a CGLIB enhanced version. SVN check-in revision 2858. Tests pass.&lt;/p&gt;</comment>
                            <comment id="126597" author="issuemaster" created="Sat, 6 Feb 2016 06:34:17 +0000"  >&lt;p&gt;This issue has been migrated to &lt;a href=&quot;https://github.com/spring-projects/spring-security/issues/863&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/spring-projects/spring-security/issues/863&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10011">
                    <name>Depends</name>
                                                                <inwardlinks description="is depended on by">
                                        <issuelink>
            <issuekey id="17737">SEC-532</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13108" name="ProxyAwareObjectIdentityRetrievalStrategy.java" size="2930" author="svanders" created="Wed, 14 Nov 2007 07:42:00 +0000"/>
                            <attachment id="13109" name="ProxyAwareObjectIdentityRetrievalStrategyTest.java" size="5662" author="svanders" created="Wed, 14 Nov 2007 07:42:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 4 Apr 2008 13:47:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10280" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20253</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i05a2v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30839</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10381" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Ranking</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>27907</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>