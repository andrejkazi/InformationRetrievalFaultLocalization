<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Fri Dec 23 11:21:17 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SEC-1385/SEC-1385.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SEC-1385] AbstractRetryEntryPoint should use DefaultRedirectStrategy for redirects to support proxies</title>
                <link>https://jira.spring.io/browse/SEC-1385</link>
                <project id="10040" key="SEC">Spring Security</project>
                    <description>&lt;p&gt;The AbstractRetryEntryPoint builds the redirect url for the redirect itself in its commence method. The problem is, that the context-path is always used.&lt;/p&gt;

&lt;p&gt;If you run your application through a proxy with a change of the path, than the redirects leeds to a wrong url.&lt;/p&gt;

&lt;p&gt;Example:&lt;br/&gt;
The app is deployed on Tomcat as ajp://localhost:8009/app1 and is accessed via a apache proxy through &lt;a href=&quot;http://yourdomain.com/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://yourdomain.com/&lt;/a&gt;. The redirect url of a secured resource /resource.html will be &lt;a href=&quot;http://yourdomain.com/app1/resource.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://yourdomain.com/app1/resource.html&lt;/a&gt; instead of the correct one &lt;a href=&quot;http://yourdomain.com/resource.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://yourdomain.com/resource.html&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Other parts of Spring Security are using the DefaultRedirectStrategy, which works as expected when setting the contextRelative to true.&lt;/p&gt;

&lt;p&gt;I think if the AbstractRetryEntryPoint uses the same convention (DefaultRedirectStrategy), then the problem with the http-&amp;gt;https redirect in DefaultRedirectStrategy (see comment on the class) will also be fixed.&lt;/p&gt;

&lt;p&gt;As a workaround we implemented our own RetryWithHttpsEntryPoint, which processes the contextRelative flag, and it works. But this is heavily to configure, because you cannot use the namespace configuration any more.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://fisheye.springsource.org/browse/spring-security/web/src/main/java/org/springframework/security/web/access/channel/AbstractRetryEntryPoint.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://fisheye.springsource.org/browse/spring-security/web/src/main/java/org/springframework/security/web/access/channel/AbstractRetryEntryPoint.java&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="29808">SEC-1385</key>
            <summary>AbstractRetryEntryPoint should use DefaultRedirectStrategy for redirects to support proxies</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="luke">Luke Taylor</assignee>
                                    <reporter username="timomeinen">Timo Meinen</reporter>
                        <labels>
                    </labels>
                <created>Sun, 24 Jan 2010 21:22:54 +0000</created>
                <updated>Sat, 6 Feb 2016 06:13:31 +0000</updated>
                            <resolved>Thu, 4 Mar 2010 09:33:16 +0000</resolved>
                                    <version>3.0.1</version>
                                                    <component>Web</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="50484" author="luke" created="Sun, 24 Jan 2010 23:09:50 +0000"  >&lt;p&gt;I don&apos;t think this should be necessary, as the Apache ProxyPassReverse directive rewrite the location URL, regardless of the context path at the back end.&lt;/p&gt;</comment>
                            <comment id="50502" author="timomeinen" created="Mon, 25 Jan 2010 22:57:04 +0000"  >&lt;p&gt;Hi Luke, thanks for the reply. You are right, that the ProxyPassReverse will &quot;decode&quot; the Response-URL to the correct Redirected-URL. But there is a problem when redirecting from http to https and vice versa - in case a reverse proxy is configured:&lt;/p&gt;

&lt;p&gt;&amp;lt;VirtualHost...&amp;gt;&lt;br/&gt;
...&lt;br/&gt;
ServerName app.example.com&lt;br/&gt;
ProxyPass / ajp://127.0.0.1:8009/appcontext/&lt;br/&gt;
ProxyPassReverse / &lt;a href=&quot;http://app.example.com/appcontext/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://app.example.com/appcontext/&lt;/a&gt;&lt;br/&gt;
&amp;lt;/VirtualHost&amp;gt;&lt;/p&gt;

&lt;p&gt;Imagine, the AbstractRetryEntryPoint wants to redirect from http to https, then it will send on an http request an https response-url. This response-url doesn&apos;t match the ProxyPassReverse, because it has an https scheme.&lt;/p&gt;

&lt;p&gt;Example:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://app.example.com/redirectToHTTPS.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://app.example.com/redirectToHTTPS.html&lt;/a&gt; is called, then the response url will be &lt;a href=&quot;https://app.example.com/redirectToHTTPS.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://app.example.com/redirectToHTTPS.html&lt;/a&gt; and so, this will not be matched by &lt;a href=&quot;http://app.example.com/appcontext/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://app.example.com/appcontext/&lt;/a&gt;. So the redirect doesn&apos;t work.&lt;/p&gt;

&lt;p&gt;I think this problem only comes into play, when the proxy uses a different URL structure than the contextpath. e.g. Proxy on / and the app on /appcontext&lt;/p&gt;

&lt;p&gt;Any suggestions?&lt;/p&gt;</comment>
                            <comment id="51099" author="luke" created="Fri, 12 Feb 2010 10:09:54 +0000"  >&lt;p&gt;That&apos;s really a general problem when you use a different path in the proxy from the one in the application. In that case you probably need to rewrite headers and URLs to match. See the URL handling section of the &quot;Tomcat Reverse Proxy HowTo&quot;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://tomcat.apache.org/connectors-doc/generic_howto/proxy.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://tomcat.apache.org/connectors-doc/generic_howto/proxy.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="51597" author="timomeinen" created="Mon, 1 Mar 2010 01:29:07 +0000"  >&lt;p&gt;Thank you Luke for the advice. I will try the configuration mentioned in the link and will comment on this issue, when I am successful with it.&lt;/p&gt;</comment>
                            <comment id="51747" author="luke" created="Thu, 4 Mar 2010 09:33:16 +0000"  >&lt;p&gt;Not a bug, and duplicated by &lt;a href=&quot;https://jira.spring.io/browse/SEC-1413&quot; title=&quot;AbstractRetryEntryPoint should use RedirectStrategy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SEC-1413&quot;&gt;&lt;del&gt;SEC-1413&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="124298" author="issuemaster" created="Sat, 6 Feb 2016 06:13:31 +0000"  >&lt;p&gt;This issue has been migrated to &lt;a href=&quot;https://github.com/spring-projects/spring-security/issues/1628&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/spring-projects/spring-security/issues/1628&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="30145">SEC-1413</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 24 Jan 2010 23:09:50 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10280" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19569</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03en3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19914</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10381" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Ranking</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3756</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>