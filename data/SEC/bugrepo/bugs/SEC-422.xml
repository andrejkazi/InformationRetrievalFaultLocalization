<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Fri Dec 23 10:50:55 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SEC-422/SEC-422.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SEC-422] BasicLookupStrategy - computeRepeatingSql contains bad SQL</title>
                <link>https://jira.spring.io/browse/SEC-422</link>
                <project id="10040" key="SEC">Spring Security</project>
                    <description>&lt;p&gt;The line&lt;/p&gt;

&lt;p&gt;+ &quot;ACL_OBJECT_IDENTITY,ENTRIES_INHERITING, &quot;&lt;/p&gt;

&lt;p&gt;should be&lt;/p&gt;

&lt;p&gt;+ &quot;ACL_OBJECT_IDENTITY.ENTRIES_INHERITING, &quot; (notice the dot instead of comma)&lt;/p&gt;</description>
                <environment></environment>
        <key id="15814">SEC-422</key>
            <summary>BasicLookupStrategy - computeRepeatingSql contains bad SQL</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="balex">Ben Alex</assignee>
                                    <reporter username="pathos">Mathias Bogaert</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 Jan 2007 22:02:11 +0000</created>
                <updated>Sat, 6 Feb 2016 06:32:31 +0000</updated>
                            <resolved>Sat, 5 Apr 2008 09:17:29 +0000</resolved>
                                    <version>1.0.4</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>ACLs</component>
                        <due></due>
                            <votes>6</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="21606" author="pathos" created="Wed, 3 Jan 2007 21:05:32 +0000"  >&lt;p&gt;After some further investigation, I discovered the following:&lt;/p&gt;

&lt;p&gt;1. in the BasicLookupStrategy#computeRepeatingSql  SQL there is a combination of one join style (select from multiple tables using comma) and outer join style (LEFT JOIN) &amp;#8211; this works on certain older versions of MySQL, but doesn&apos;t work on H2, Postgres, SQL Server, Oracle.&lt;/p&gt;

&lt;p&gt;2. when rewiting the query using only outer join style, I hit the next problem: an an ambiguous column name: ACL_ENTRY contains a ACL_OBJECT_IDENTITY column and the ACL_OBJECT_IDENTITY table is joined.&lt;/p&gt;

&lt;p&gt;3. inconsistent naming in the new schema:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;OBJECT_ID_IDENTITY but not PARENT_OBJECT_IDENTITY (just PARENT_OBJECT)&lt;/li&gt;
	&lt;li&gt;I propose to rename foreign keys to end with _FK, so ACL_OBJECT_IDENTITY becomes ACL_OBJECT_IDENTITY_FK, and SID becomes SID_FK, and OWNER_SID becomes OWNER_SID_FK, and OBJECT_ID_CLASS becomes OBJECT_ID_CLASS_FK&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="21674" author="cobraflow" created="Sun, 7 Jan 2007 22:13:26 +0000"  >&lt;p&gt;There are issues with both the mixing of join types (as described above), these should be &apos;inner joins&apos; and also with the inserts in JdbcMutableAclService with MSSqlServer. For MSSQL it requires that the value for an identity column not be provided. The identityQuery should also be &apos;select @@identity&apos; for MSSQL.&lt;/p&gt;

&lt;p&gt;The sql for these beans should be injected to allow for different sql flavours.&lt;/p&gt;</comment>
                            <comment id="22312" author="svanders" created="Mon, 19 Feb 2007 07:24:03 +0000"  >&lt;p&gt;I agree the sql for BasicLookupStratagy, and JdbcMutableAclService where possible must written as SQL that will work on all DB servers (ANSI?), and where this is not possible, the sql fragments should be injectable.&lt;/p&gt;

&lt;p&gt;A note on the identity query for MS SQL server:&lt;br/&gt;
&apos;select @@identity&apos; will work in most cases, however if the DB has a triggers on the table it may return an undesired value.&lt;br/&gt;
A better identity query is &apos;SELECT SCOPE_IDENTITY()&apos;&lt;/p&gt;

&lt;p&gt;For a detailed run down on the difference see&lt;br/&gt;
&lt;a href=&quot;http://codebetter.com/blogs/john.papa/archive/2006/04/07/142503.aspx&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://codebetter.com/blogs/john.papa/archive/2006/04/07/142503.aspx&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Also, this may be a seperate issue, but the ObjectIdentity interface expects ObjectIdentity.getIdentitfier() to return a serializable, however BasicLookupStrategy.lookupObjectIdentities(...) contains an Assert.isInstanceOf(Long.class, objectIdentities&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.getIdentifier(),...)  This caused a problem (easily fixed) when I attempted to add ACL to the Spring Petclinic, but will cause bigger problems when we attempt to use the acls package for our product which uses GUIDs (A String where ACL&apos;s are concerned) as ids.  I guess the bug here is that BasicLookupStratagy does not respect the interface of ObjectIdentity.&lt;/p&gt;
</comment>
                            <comment id="22313" author="tduffey" created="Mon, 19 Feb 2007 07:37:16 +0000"  >&lt;p&gt;Also the INSERT statements in JdbcMutableAclService are not compatible with PostgreSQL, maybe others.  It currently uses statements like:&lt;/p&gt;

&lt;p&gt;INSERT INTO acl_class(id, class) VALUES (null, ?);&lt;/p&gt;

&lt;p&gt;In PostgreSQL you can&apos;t insert null into the &quot;id&quot; column even if it is a serial (Automatically incrementing) field.&lt;/p&gt;</comment>
                            <comment id="22315" author="svanders" created="Mon, 19 Feb 2007 09:21:32 +0000"  >&lt;p&gt;Apologies&lt;/p&gt;

&lt;p&gt;After some testing and  reading a little more thoroughly, select @@identity is the identity query to use.&lt;br/&gt;
select scope_identity() does not work.&lt;/p&gt;</comment>
                            <comment id="22822" author="svanders" created="Wed, 21 Mar 2007 09:05:08 +0000"  >&lt;p&gt;I&apos;ve made some changes we made to some of the acls classes&lt;/p&gt;

&lt;p&gt;Summary of changes:&lt;/p&gt;

&lt;p&gt;updated POM for use ibiblios new repository location.&lt;/p&gt;

&lt;p&gt;Some of the sql used only worked on hsql, I&apos;ve made it more generic so&lt;br/&gt;
it now works on hsql and ms sql.  &lt;/p&gt;

&lt;p&gt;Made the identity query be injected, as this varies between RDBMSs.&lt;br/&gt;
NOTE postgres doesn&apos;t appear to support identity queries, in which case&lt;br/&gt;
4 id queries may be needed to query the generated ID (Needs&lt;br/&gt;
investigation).&lt;/p&gt;

&lt;p&gt;ACLs did not on domain objects that return anything but Long as their&lt;br/&gt;
ID.  (Try adding acls to petclinic).  So I&apos;ve added 2 methods to the&lt;br/&gt;
LookupStrategy interface, and on BasicLookupStrategy made both the&lt;br/&gt;
OBJECT_ID_IDENITY column and the expect class returned by a domain&lt;br/&gt;
object configurable (dependency injection).  Queries on&lt;br/&gt;
ACL_OBJECT_IDENTITY now use this configurable return class, and HashMap&lt;br/&gt;
lookups now correctly find ObjectIdentities for domain objects that&lt;br/&gt;
don&apos;t use Long ids.  NOTE: This required some schema changes for the&lt;br/&gt;
ACL_OBJECT_IDENTITY table and it&apos;s contraints, the test resources have&lt;br/&gt;
all been updated.  I&apos;ve also added support for GUID / UUID types, but&lt;br/&gt;
disabled the tests by default as hsql doesn&apos;t support these.&lt;/p&gt;

&lt;p&gt;I&apos;ve added a dependency to the JTDS JDBC driver to the pom, and added&lt;br/&gt;
some optional (commented out) configs to test acls against ms sql&lt;br/&gt;
server.&lt;/p&gt;

&lt;p&gt;Although these changes do complicate the configuration of acls somewhat,&lt;br/&gt;
I think they are good, and would like to see them added to the Acegi&lt;br/&gt;
Security project.&lt;/p&gt;</comment>
                            <comment id="23985" author="balex" created="Thu, 24 May 2007 12:46:09 +0000"  >&lt;p&gt;Thanks for the patch.&lt;/p&gt;

&lt;p&gt;Just wondering why LookupStrategy.getObjectIdentifierClass() doesn&apos;t appear to be used at all? Also there are a number of static references to Long remaining in BasicLookupStrategy and JdbcMutableAclService.&lt;/p&gt;

&lt;p&gt;Unfortunately I don&apos;t have time to sort this out for 1.0.4, but we&apos;ll aim to address it in the 2.0.0 M1 release. It&apos;s only a short time away anyway (a week or so). If in the meantime you can please provide a revision of the patch to address the above, it will be applied in the next release. Thanks.&lt;/p&gt;</comment>
                            <comment id="24066" author="svanders" created="Mon, 28 May 2007 08:05:17 +0000"  >&lt;p&gt;I&apos;ve made some further changes to the new ACL (acls) code to make the domain object id configurable.  Files are attached.&lt;/p&gt;

&lt;p&gt;Outline - I&apos;ve created a ConfigurableObjectIdentityRetrievalStrategy, so that the type of the object ID can be configured.  Sadly this makes the configuration even more verbose, but it does provide a lot more flexibility.&lt;/p&gt;

&lt;p&gt;I also fixed a bug &amp;#8211;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fixed a bug in the query &quot;updateObjectIdentity&quot;, it was missing a space before the WHERE clause&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;core/src/main/java/org/acegisecurity/acls/jdbc/JdbcMutableAclService.java 1.4 history download (+2 -2) diffs &lt;/p&gt;

&lt;p&gt;but I may have caused this one myself???, as I would have thought it would it would show up earlier.&lt;/p&gt;</comment>
                            <comment id="32539" author="tkelley353" created="Tue, 26 Feb 2008 06:38:30 +0000"  >&lt;p&gt;Just a quick note that the current SQL (2.0M1) is also not compatible with DB2.  &lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;-Troy&lt;/p&gt;</comment>
                            <comment id="34304" author="pratap_sunil" created="Thu, 3 Apr 2008 01:26:13 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I have modified the query and following query runs fine on oracle:&lt;/p&gt;

&lt;p&gt;SELECT acl_object_identity.object_id_identity, acl_entry.ace_order,&lt;br/&gt;
  acl_object_identity.id AS acl_id, acl_object_identity.parent_object,&lt;br/&gt;
  acl_object_identity, entries_inheriting,&lt;br/&gt;
  acl_entry.id AS ace_id, acl_entry.mask, acl_entry.granting,&lt;br/&gt;
  acl_entry.audit_success, acl_entry.audit_failure,&lt;br/&gt;
  acli_sid.principal AS ace_principal, acli_sid.sid AS ace_sid,&lt;br/&gt;
  acl_sid.principal AS acl_principal, acl_sid.sid AS acl_sid,&lt;br/&gt;
  acl_class.class&lt;br/&gt;
FROM acl_class, acl_sid acli_sid,acl_object_identity, acl_entry, acl_sid &lt;br/&gt;
WHERE acl_sid.id = acl_object_identity.owner_sid&lt;br/&gt;
  AND acl_entry.sid = acli_sid.id&lt;img class=&quot;emoticon&quot; src=&quot;https://jira.spring.io/images/icons/emoticons/add.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
  AND acl_class.id = acl_object_identity.object_id_class&lt;br/&gt;
  AND acl_object_identity.id = acl_entry.acl_object_identity&lt;img class=&quot;emoticon&quot; src=&quot;https://jira.spring.io/images/icons/emoticons/add.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
  AND (acl_object_identity.object_id_identity = ?&lt;br/&gt;
  AND acl_class.class = ?)&lt;br/&gt;
ORDER BY acl_object_identity.object_id_identity ASC,&lt;br/&gt;
      acl_entry.ace_order ASC&lt;/p&gt;


&lt;p&gt;acl_object_identity.object_id_identity = ?&lt;br/&gt;
  AND acl_class.class = ?&lt;br/&gt;
is the SQL injected by lookupObjectIdentities method.&lt;/p&gt;



&lt;p&gt;Thanks&lt;br/&gt;
sunil&lt;/p&gt;

</comment>
                            <comment id="34397" author="balex" created="Sat, 5 Apr 2008 09:17:29 +0000"  >&lt;p&gt;I modified BasicLookupStrategy and JdbcMutableAclService to use the SQL statements provided by Simon van der Sluis in acegi-patch-29-5-07.tgz. Note that I did not introduce the strategy interface, because I believe people can easily change the SQL statements(s) should they require it. Most users tend to use the Spring Security default schema for ACLs, as it has been optimized for ACLs and saves them needing to maintain compatibility with the placeholders used in the two aforementioned classes.&lt;/p&gt;

&lt;p&gt;The modifications were tested against Hypersonic 1.8.0.7. I note Simon reported the modifications work against Microsoft SQL Server as well. I also ensured the insert statements did not use null for &quot;id&quot; columns, as requested by Tom Duffey. The integration tests passed, together with the tests for the DMS and Contacts samples.&lt;/p&gt;

&lt;p&gt;SVN commit revision 2874.&lt;/p&gt;</comment>
                            <comment id="126397" author="issuemaster" created="Sat, 6 Feb 2016 06:32:31 +0000"  >&lt;p&gt;This issue has been migrated to &lt;a href=&quot;https://github.com/spring-projects/spring-security/issues/683&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/spring-projects/spring-security/issues/683&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="16548">SEC-467</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12634" name="acegi-patch-29-5-07.tgz" size="12066" author="svanders" created="Mon, 28 May 2007 08:05:17 +0000"/>
                            <attachment id="12480" name="acls-sql-fixes.tgz" size="21092" author="svanders" created="Wed, 21 Mar 2007 09:05:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 7 Jan 2007 22:13:26 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10280" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20419</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02727:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12853</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10381" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Ranking</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12656</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>