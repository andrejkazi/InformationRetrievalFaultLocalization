<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Fri Dec 23 11:20:13 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SEC-2443/SEC-2443.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SEC-2443] posting to httpBasic protected url fails because of missing csrf token with two HttpSecurity java configs</title>
                <link>https://jira.spring.io/browse/SEC-2443</link>
                <project id="10040" key="SEC">Spring Security</project>
                    <description>&lt;p&gt;I have two HttpSecurity java configs. One for REST API requiring basic auth using httpBasic() and one for UI with formLogin.&lt;br/&gt;
When using curl to post to an url protected by basic auth (/v1/account), it fails with the following 403 error:&lt;br/&gt;
HTTP Status 403 - Invalid CSRF Token &apos;null&apos; was found on the request parameter &apos;_csrf&apos; or header &apos;X-CSRF-TOKEN&apos;.&lt;/p&gt;

&lt;p&gt;it seems like it is incorrectly applying the form login security to the basic auth url.&lt;/p&gt;

&lt;p&gt;Here is my config:&lt;/p&gt;

&lt;p&gt;@Configuration&lt;br/&gt;
@EnableWebSecurity&lt;br/&gt;
public class SecurityConfig extends WebSecurityConfigurerAdapter {&lt;/p&gt;

&lt;p&gt;    @Resource&lt;br/&gt;
    private MyUserDetailsService userDetailsService;&lt;/p&gt;

&lt;p&gt;    @Autowired&lt;br/&gt;
    public void configureGlobal(AuthenticationManagerBuilder auth)&lt;br/&gt;
            throws Exception &lt;/p&gt;
{
        StandardPasswordEncoder encoder = new StandardPasswordEncoder(); 
        auth.userDetailsService(userDetailsService).passwordEncoder(encoder);
    }

&lt;p&gt;    @Configuration&lt;br/&gt;
    @Order(1)&lt;br/&gt;
    public static class RestSecurityConfig&lt;br/&gt;
            extends WebSecurityConfigurerAdapter {&lt;/p&gt;

&lt;p&gt;        @Override&lt;br/&gt;
        protected void configure(HttpSecurity http) throws Exception &lt;/p&gt;
{
            http
                .antMatcher(&quot;/v1/**&quot;).authorizeRequests()
                    .antMatchers(&quot;/v1/admin/**&quot;).hasRole(&quot;admin&quot;)
                    .antMatchers(&quot;/v1/account/**&quot;).hasRole(&quot;admin&quot;)
                    .antMatchers(&quot;/v1/plant/**&quot;).access(&quot;hasRole(&apos;admin&apos;) or ha
sRole(&apos;dataProvider&apos;)&quot;)
                    .antMatchers(&quot;/v1/upload/**&quot;).access(&quot;hasRole(&apos;admin&apos;) or h
asRole(&apos;dataProvider&apos;)&quot;)
                    .antMatchers(HttpMethod.GET, &quot;/v1/participant/**&quot;).permitAl
l()
                    .antMatchers(HttpMethod.GET, &quot;/v1/tag/**&quot;).permitAll()
                    .antMatchers(HttpMethod.GET, &quot;/v1/zipcode/**&quot;).permitAll()
                    .antMatchers(&quot;/v1/**&quot;).authenticated()
                .and().httpBasic();
        }
&lt;p&gt;    }&lt;/p&gt;

&lt;p&gt;    @Configuration&lt;br/&gt;
    @Order(2)&lt;br/&gt;
    public static class UiSecurityConfig extends WebSecurityConfigurerAdapter {&lt;/p&gt;

&lt;p&gt;        @Override&lt;br/&gt;
        public void configure(WebSecurity web) throws Exception &lt;/p&gt;
{
            //web.privilegeEvaluator(null).expressionHandler(null).ignoring().a
ntMatchers(&quot;/resources/**&quot;);
            web.ignoring().antMatchers(&quot;/resources/**&quot;);
        }

&lt;p&gt;        @Override&lt;br/&gt;
        protected void configure(HttpSecurity http) throws Exception &lt;/p&gt;
{
            http
                .authorizeRequests()
                    .antMatchers(&quot;/account/request/**&quot;).permitAll()
                    .antMatchers(&quot;/account/change_password/**&quot;).authenticated()
                    .antMatchers(&quot;/account/**&quot;).hasRole(&quot;admin&quot;)
                    .antMatchers(&quot;/admin/**&quot;).hasRole(&quot;admin&quot;)
                    .antMatchers(&quot;/plant/**&quot;).access(&quot;hasRole(&apos;admin&apos;) or hasRo
le(&apos;dataProvider&apos;)&quot;)
                    .antMatchers(&quot;/upload/**&quot;).access(&quot;hasRole(&apos;admin&apos;) or hasR
ole(&apos;dataProvider&apos;)&quot;)
                    .anyRequest().authenticated()
                .and().formLogin().loginPage(&quot;/login&quot;).permitAll();
        }

&lt;p&gt;    }&lt;/p&gt;

&lt;p&gt;}&lt;/p&gt;</description>
                <environment>amazon linux tomcat7</environment>
        <key id="52346">SEC-2443</key>
            <summary>posting to httpBasic protected url fails because of missing csrf token with two HttpSecurity java configs</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://jira.spring.io/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="rwinch">Rob Winch</assignee>
                                    <reporter username="shawnim">Shawn McMurdo</reporter>
                        <labels>
                            <label>java-configuration</label>
                    </labels>
                <created>Thu, 12 Dec 2013 16:26:33 +0000</created>
                <updated>Sat, 6 Feb 2016 06:23:51 +0000</updated>
                            <resolved>Mon, 6 Jan 2014 13:08:51 +0000</resolved>
                                    <version>3.2.0.RC2</version>
                                                    <component>Java Config</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="96659" author="shawnim" created="Wed, 18 Dec 2013 09:49:10 +0000"  >&lt;p&gt;I think I entered a duplicate. See &lt;a href=&quot;https://jira.spring.io/browse/SEC-2451&quot; title=&quot;httpBasic POST failing with 403 null csrf token&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SEC-2451&quot;&gt;&lt;del&gt;SEC-2451&lt;/del&gt;&lt;/a&gt;. Sorry about that.&lt;/p&gt;</comment>
                            <comment id="97016" author="rwinch" created="Mon, 6 Jan 2014 13:08:51 +0000"  >&lt;p&gt;Resolving as duplicate per comment&lt;/p&gt;</comment>
                            <comment id="125451" author="issuemaster" created="Sat, 6 Feb 2016 06:23:51 +0000"  >&lt;p&gt;This issue has been migrated to &lt;a href=&quot;https://github.com/spring-projects/spring-security/issues/2666&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/spring-projects/spring-security/issues/2666&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="52392">SEC-2451</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 6 Jan 2014 13:08:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10280" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38825</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i06rsn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39541</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10381" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Ranking</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38527</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>