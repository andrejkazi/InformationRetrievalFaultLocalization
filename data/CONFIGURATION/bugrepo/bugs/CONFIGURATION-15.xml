<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Thu Dec 01 20:09:09 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CONFIGURATION-15/CONFIGURATION-15.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CONFIGURATION-15] [configuration] PropertyConfiguration.save() does not take basePath into account</title>
                <link>https://issues.apache.org/jira/browse/CONFIGURATION-15</link>
                <project id="12310467" key="CONFIGURATION">Commons Configuration</project>
                    <description>&lt;p&gt;When using ConfigurationFactory with a config.xml file that contans multiple &lt;br/&gt;
properties files one can iterate through is and get each Configuration. You can &lt;br/&gt;
then use one of these (Typecasting it to the proper type) directly. However, &lt;br/&gt;
when for instance trying to do saveProperty with the PropertiesConfiguration it &lt;br/&gt;
uses the fileName property instead of the basePath (which contains the absolute &lt;br/&gt;
reference) from its superclass. This results in the file being created at &lt;br/&gt;
whatever the current path is, instead of where it actually got the file in the &lt;br/&gt;
first place. Propesed fix is :&lt;br/&gt;
    /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Save the configuration to the file specified by the fileName attribute.&lt;br/&gt;
     */&lt;br/&gt;
    public void save() throws ConfigurationException
    {
//        save(fileName);
          save(getBasePath());
    }&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment>&lt;p&gt;Operating System: other&lt;br/&gt;
Platform: Other&lt;/p&gt;</environment>
        <key id="12341660">CONFIGURATION-15</key>
            <summary>[configuration] PropertyConfiguration.save() does not take basePath into account</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="hermod.opstvedt@dnb.no">Hermod Opstvedt</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Aug 2004 14:17:15 +0000</created>
                <updated>Tue, 16 May 2006 12:22:04 +0000</updated>
                            <resolved>Tue, 16 May 2006 12:22:04 +0000</resolved>
                                    <version>Nightly Builds</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12407338" author="hermod.opstvedt@dnb.no" created="Thu, 26 Aug 2004 14:30:58 +0000"  >&lt;p&gt;I discovered that the basePath can contain &apos;file:/&apos; in the beginning, so I &lt;br/&gt;
propose to add a new method to BasePathConfiguration :&lt;/p&gt;

&lt;p&gt;    /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Returns the Base path from which this Configuration Factory operates.&lt;/li&gt;
	&lt;li&gt;This is never null. If you set the BasePath to null, then &quot;.&quot;&lt;/li&gt;
	&lt;li&gt;is returned. If the basePath is prefixed with a protocol then remove it&lt;br/&gt;
     *&lt;/li&gt;
	&lt;li&gt;@return The base Path of this configuration factory.&lt;br/&gt;
     */&lt;br/&gt;
    public String getAbsoluteBasePath()
    &lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {        if(basePath.indexOf(&amp;quot;file}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;and then in PropertiesConfiguration :&lt;/p&gt;

&lt;p&gt;    /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Save the configuration to the file specified by the fileName attribute.&lt;br/&gt;
     */&lt;br/&gt;
    public void save() throws ConfigurationException
    {
//        save(fileName);
          save(getAbsoluteBasePath());
    }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Again : I don&apos;t have CVS access, so I submit it here&lt;/p&gt;

&lt;p&gt;Hermod&lt;/p&gt;</comment>
                            <comment id="12407339" author="oliver.heger@t-online.de" created="Fri, 27 Aug 2004 19:22:00 +0000"  >&lt;p&gt;The basePath can indeed contain a full URL, and not necessarily a file URL. Only&lt;br/&gt;
removing the file: prefix will probably not work in all constellations (just&lt;br/&gt;
consider that in windows environments the backslash is used as path separator).&lt;/p&gt;

&lt;p&gt;I would suggest to implement the save() method the same way as the load()&lt;br/&gt;
method, i.e. obtaining the URL for storing from ConfigurationUtils (which takes&lt;br/&gt;
the base path into account and can deal with both absolute and relative URLs)&lt;br/&gt;
and then opening an OutputStream on this URL.&lt;/p&gt;

&lt;p&gt;Oliver&lt;/p&gt;</comment>
                            <comment id="12407340" author="ebourg" created="Tue, 5 Oct 2004 03:28:51 +0000"  >&lt;p&gt;Hermod, the persistence mechanism of file based configurations has been reworked&lt;br/&gt;
in RC2, could you test again and tell us if it fixed your issue ?&lt;/p&gt;</comment>
                            <comment id="12407341" author="oliver.heger@t-online.de" created="Tue, 30 Nov 2004 03:38:08 +0000"  >&lt;p&gt;Created an attachment (id=13583)&lt;br/&gt;
Test case for saving with base path&lt;/p&gt;</comment>
                            <comment id="12407342" author="oliver.heger@t-online.de" created="Tue, 30 Nov 2004 03:59:21 +0000"  >&lt;p&gt;I wrote a test case for saving a file based configuration with a base path, and&lt;br/&gt;
this still fails. The test should reproduce a situation as it occurs in&lt;br/&gt;
ConfigurationFactory: When a file based configuration is loaded, first its&lt;br/&gt;
setBasePath() method gets called and then setFileName(). To the former a URL may&lt;br/&gt;
be passed. If later the file based configuration should be saved using the&lt;br/&gt;
save() method or save(String) with a relative file name, conversion of this URL&lt;br/&gt;
to a File object fails.&lt;/p&gt;

&lt;p&gt;A solution would be to make ConfigurationUtils.constructFile() aware of URLs, so&lt;br/&gt;
that a correct File object is constructed even if URLs are involved (given that&lt;br/&gt;
all URLs have the file protocol).&lt;/p&gt;

&lt;p&gt;After looking at the code for a while I find our actual solution for dealing&lt;br/&gt;
with file names, base paths and URLs very confusing. The fact that we&lt;br/&gt;
distinguish between a base path and an URL makes the whole stuff hard to&lt;br/&gt;
maintain and error prone (just think about the many places in&lt;br/&gt;
ConfigurationFactory, AbstractFileConfiguration and elsewhere where special&lt;br/&gt;
checks are performed). Besides it is hard for the users to understand.&lt;/p&gt;

&lt;p&gt;What can we do about it? I would suggest dropping (deprecating) either the&lt;br/&gt;
get/setURL() or get/setBasePath() methods. The remaining methods should be able&lt;br/&gt;
to deal with both URLs and files. This could be implemented in&lt;br/&gt;
ConfigurationUtils, in a central place. Are there any other ideas/opinions?&lt;/p&gt;</comment>
                            <comment id="12407343" author="ebourg" created="Thu, 2 Dec 2004 22:46:52 +0000"  >&lt;p&gt;(In reply to comment #5)&lt;br/&gt;
&amp;gt; What can we do about it? I would suggest dropping (deprecating) either the&lt;br/&gt;
&amp;gt; get/setURL() or get/setBasePath() methods. The remaining methods should be able&lt;br/&gt;
&amp;gt; to deal with both URLs and files. This could be implemented in&lt;br/&gt;
&amp;gt; ConfigurationUtils, in a central place. Are there any other ideas/opinions?&lt;/p&gt;

&lt;p&gt;The basepath stuff is quite complicated I agree and it&apos;s not a part I like to&lt;br/&gt;
deal with, however it&apos;s still a useful feature and I believe we should keep it.&lt;br/&gt;
I&apos;m not favorable to drop the URL, it&apos;s the reference to locate the file, I see&lt;br/&gt;
the basepath and the filename as byproducts of the URL.&lt;/p&gt;

&lt;p&gt;I placed the utility methods getBasePath and getFileName in ConfigurationUtils&lt;br/&gt;
but this may not be the best place for them. The logic dealing with paths and&lt;br/&gt;
urls may be best placed in AbstractFileConfiguration.&lt;/p&gt;
</comment>
                            <comment id="12407344" author="oliver.heger@t-online.de" created="Thu, 2 Dec 2004 23:10:36 +0000"  >&lt;p&gt;Well, I will try to do the following: get rid of the internal url field in&lt;br/&gt;
AbstractFileConfiguration. Everywhere the url field is accessed, it can be&lt;br/&gt;
calculated from the base path and file name. The base path can then contain a&lt;br/&gt;
full URL, which has to be taken into account when constructing a File object in&lt;br/&gt;
save() operations.&lt;/p&gt;

&lt;p&gt;So this modification won&apos;t influence the class&apos;s interface. Where to put the&lt;br/&gt;
utility methods for translating from URLs to Files and vice versa is an&lt;br/&gt;
interesting question. I don&apos;t think that a static utility class is such a bad&lt;br/&gt;
idea because this makes them easier to access (maybe in future other parts of&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;configuration&amp;#93;&lt;/span&gt; needs this stuff, too?).&lt;/p&gt;</comment>
                            <comment id="12407345" author="ebourg" created="Thu, 2 Dec 2004 23:30:24 +0000"  >&lt;p&gt;I don&apos;t see how removing the internal URL will help, updating it when the&lt;br/&gt;
basepath/filename changes or computing it when the getter is accessed is equivalent.&lt;/p&gt;</comment>
                            <comment id="12407346" author="oliver.heger@t-online.de" created="Fri, 3 Dec 2004 00:10:36 +0000"  >&lt;p&gt;ATM the internal url is not always updated, so there are inconsitencies. For me&lt;br/&gt;
to fix this, it is easier to remove the field at all than to find all places&lt;br/&gt;
where an update should take place. This will also reduce code and concentrate&lt;br/&gt;
logic. I think, the URL is only referred in some of the load() methods.&lt;/p&gt;</comment>
                            <comment id="12407347" author="oliver.heger@t-online.de" created="Sun, 5 Dec 2004 01:07:47 +0000"  >&lt;p&gt;I have performed a little cleanup on the way the base path was handled. The&lt;br/&gt;
internal url field was removed. I added some more tests and improved the&lt;br/&gt;
javadoc. The unit tests all run, but I had a problem with the test for&lt;br/&gt;
FileChangedReloadingStrategy: To get it running after the modifications I had to&lt;br/&gt;
increase the sleep interval in testAutomaticReloading(). Don&apos;t know why, but on&lt;br/&gt;
my old and slow Linux box this test was also sometimes failing before the update.&lt;/p&gt;

&lt;p&gt;The tests indicate that the problem is now solved (refer to&lt;br/&gt;
TestFileConfiguration). So I mark this bug as fixed. Feel free to reopen if&lt;br/&gt;
there are still issues.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12333071" name="ASF.LICENSE.NOT.GRANTED--TestPropertiesConfiguration.txt" size="1273" author="oliver.heger@t-online.de" created="Tue, 30 Nov 2004 03:38:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                        <customfieldname>Bugzilla Id</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30858</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 27 Aug 2004 19:22:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33982</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 1 week, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0tfy7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>169893</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>