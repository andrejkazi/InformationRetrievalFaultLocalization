<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Thu Dec 01 19:59:15 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CONFIGURATION-546/CONFIGURATION-546.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CONFIGURATION-546] ClassCastException in BeanHelper constructing beans with a list of child beans</title>
                <link>https://issues.apache.org/jira/browse/CONFIGURATION-546</link>
                <project id="12310467" key="CONFIGURATION">Commons Configuration</project>
                    <description>&lt;p&gt;If you wish to create a bean that has a collection as a property where that collection contains multiple beans, the code crashes as it assumes that you can only ever have single bean declarations as children. &lt;/p&gt;

&lt;p&gt;For example the following brief construct is not possible to build&lt;/p&gt;

&lt;p&gt;class A &lt;/p&gt;
{
   String name;
}

&lt;p&gt;class B &lt;/p&gt;
{
   List&amp;lt;A&amp;gt; children;
}

&lt;p&gt;The result is the following stack trace &lt;/p&gt;

&lt;p&gt;Caused by: java.lang.ClassCastException: java.util.ArrayList cannot be cast to org.apache.commons.configuration.beanutils.BeanDeclaration&lt;br/&gt;
	at org.apache.commons.configuration.beanutils.BeanHelper.initBean(BeanHelper.java:212)&lt;br/&gt;
	at org.apache.commons.configuration.beanutils.TestBeanHelper$TestBeanFactory.createBean(TestBeanHelper.java:579)&lt;br/&gt;
	at org.apache.commons.configuration.beanutils.BeanHelper.createBean(BeanHelper.java:342)&lt;br/&gt;
	... 33 more&lt;/p&gt;


&lt;p&gt;It&apos;s pretty easy to see why when you look at the code beginning line 208:&lt;/p&gt;

&lt;p&gt;  for (Map.Entry&amp;lt;String, Object&amp;gt; e : nestedBeans.entrySet())&lt;/p&gt;
  {
     String propName = e.getKey();
     Class&amp;lt;?&amp;gt; defaultClass = getDefaultClass(bean, propName);
     initProperty(bean, propName, createBean(
 	   (BeanDeclaration) e.getValue(), defaultClass));
  }

&lt;p&gt;Note the silly assumption that e.getValue() only ever has BeanDeclaration instances, where it could be BeanDeclaration[], or Collection&amp;lt;BeanDeclaration&amp;gt; as other possible options - which is what the above example show. &lt;/p&gt;

&lt;p&gt;Extended version of the existing unit test to follow that illustrates the problem.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12651923">CONFIGURATION-546</key>
            <summary>ClassCastException in BeanHelper constructing beans with a list of child beans</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="justinc">Justin Couch</reporter>
                        <labels>
                    </labels>
                <created>Sun, 9 Jun 2013 12:02:54 +0000</created>
                <updated>Mon, 28 Oct 2013 06:54:36 +0000</updated>
                            <resolved>Wed, 12 Jun 2013 20:12:58 +0000</resolved>
                                    <version>1.8</version>
                    <version>1.9</version>
                                    <fixVersion>2.0</fixVersion>
                    <fixVersion>1.10</fixVersion>
                                    <component>Type conversion</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13679019" author="justinc" created="Sun, 9 Jun 2013 12:05:20 +0000"  >&lt;p&gt;Updated unit test and new bean showing the crash. &lt;/p&gt;</comment>
                            <comment id="13679306" author="justinc" created="Mon, 10 Jun 2013 04:56:13 +0000"  >&lt;p&gt;Tweaked test and example implementation that passes the tests. &lt;/p&gt;</comment>
                            <comment id="13679801" author="oliver.heger@t-online.de" created="Mon, 10 Jun 2013 19:32:06 +0000"  >&lt;p&gt;Thank you for this contribution!&lt;/p&gt;

&lt;p&gt;Is there any chance you can provide the new functionality as patches (see &lt;a href=&quot;http://commons.apache.org/patches.html)?&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://commons.apache.org/patches.html)?&lt;/a&gt; This makes it easier to detect the actual changes.&lt;/p&gt;</comment>
                            <comment id="13680064" author="justinc" created="Tue, 11 Jun 2013 00:00:31 +0000"  >&lt;p&gt;Patch versions of the changes. &lt;/p&gt;</comment>
                            <comment id="13680098" author="justinc" created="Tue, 11 Jun 2013 00:31:49 +0000"  >&lt;p&gt;BTW, the reason I didn&apos;t do patches before is that the links from the commons web pages are all wrong and had problems trying to find the correct page with required details. They all use /proper/foo.html rather than /foo.html. Probably because the original sources are relative URL paths rather than absolutes so that it ignores the subproject details. &lt;/p&gt;</comment>
                            <comment id="13680626" author="oliver.heger@t-online.de" created="Tue, 11 Jun 2013 20:22:57 +0000"  >&lt;p&gt;I had a look at your patch, and it is really good.&lt;/p&gt;

&lt;p&gt;There is one thing I do not understand: How is the BeanDeclaration created in a way that it contains a collection of other BeanDeclarations as a property value? Do you create such declarations manually for your use case?&lt;/p&gt;

&lt;p&gt;I mean, typically a concrete implementation class like &lt;tt&gt;XMLBeanDeclaration&lt;/tt&gt; is used and initialized from a configuration. (This was the original intension of this whole subcomponent: to define service beans in configuration files.) The class extracts the information about the bean to be created and its properties from the passed in configuration object. But there is so far no support for list properties. So in order to make this new feature really usable, we would probably also have to extend &lt;tt&gt;XMLBeanDeclaration&lt;/tt&gt; to process declarations of list properties.&lt;/p&gt;

&lt;p&gt;WDYT?&lt;/p&gt;</comment>
                            <comment id="13680797" author="justinc" created="Tue, 11 Jun 2013 23:12:19 +0000"  >&lt;p&gt;In my case I have an external processor that loads configurations into my own implementation of BeanDeclaration (one example has the original definitions are coming from database information, not a text file) that is then used to build the appropriate beans. &lt;/p&gt;

&lt;p&gt;A simpler example is something like this (hope Jira doesn&apos;t mess the formatting &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;ThermalModel&amp;gt;
  &amp;lt;TemperaturePoints&amp;gt;
    &amp;lt;FahrenheitPoint id=&lt;span class=&quot;code-quote&quot;&gt;&quot;123&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;read&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;CelsiusPoint id=&lt;span class=&quot;code-quote&quot;&gt;&quot;abc&quot;&lt;/span&gt; type=&quot;read/&amp;gt;
  &amp;lt;/TemperaturePoints&amp;gt;
&amp;lt;/ThermalModel&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The ThermalModel has a property that are a list of points that it may read from to do some averaging of them, for example without actually caring what the concrete class is. We use the Bean helper to take this configuration and load the implementations. When not driven by the database, we use domain-specific XML or JSON definitions for the beans so that end users that are not software developers can build system configurations. As such, we don&apos;t have any interest in the rest of the framework around bean declarations etc.  I could probably have a look into adding the capabilities, but that&apos;s going to be a bit in my spare time &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13681579" author="oliver.heger@t-online.de" created="Wed, 12 Jun 2013 20:12:58 +0000"  >&lt;p&gt;The patch was committed with minor changes in revision 1492404.&lt;/p&gt;

&lt;p&gt;It would be great if you can work on additional list property support for XML-based bean declarations. This would enable the new feature for the typical Configuration user.&lt;/p&gt;

&lt;p&gt;I am marking this ticket as resolved. Further work in this area can be assigned to a new one. Thanks again.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12587168" name="BeanCreateTestBeanWithListChild-BUG564.patch" size="2313" author="justinc" created="Tue, 11 Jun 2013 00:00:31 +0000"/>
                            <attachment id="12587022" name="BeanCreationTestBeanWithListChild.java" size="1833" author="justinc" created="Mon, 10 Jun 2013 04:56:13 +0000"/>
                            <attachment id="12586946" name="BeanCreationTestBeanWithListChild.java" size="1827" author="justinc" created="Sun, 9 Jun 2013 12:05:20 +0000"/>
                            <attachment id="12587167" name="BeanHelper-BUG564.patch" size="2790" author="justinc" created="Tue, 11 Jun 2013 00:00:31 +0000"/>
                            <attachment id="12587024" name="BeanHelper.java" size="23071" author="justinc" created="Mon, 10 Jun 2013 04:56:13 +0000"/>
                            <attachment id="12587169" name="TestBeanHelper-BUG564.patch" size="5292" author="justinc" created="Tue, 11 Jun 2013 00:00:31 +0000"/>
                            <attachment id="12587023" name="TestBeanHelper.java" size="22188" author="justinc" created="Mon, 10 Jun 2013 04:56:13 +0000"/>
                            <attachment id="12586947" name="TestBeanHelper.java" size="22176" author="justinc" created="Sun, 9 Jun 2013 12:05:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 10 Jun 2013 19:32:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>332247</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 25 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1lben:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>332576</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>