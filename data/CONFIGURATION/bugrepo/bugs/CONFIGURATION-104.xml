<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Thu Dec 01 19:53:09 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CONFIGURATION-104/CONFIGURATION-104.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CONFIGURATION-104] [configuration] Preserve file structure (line comments) when re-saving properties file</title>
                <link>https://issues.apache.org/jira/browse/CONFIGURATION-104</link>
                <project id="12310467" key="CONFIGURATION">Commons Configuration</project>
                    <description>&lt;p&gt;This bug applies when an application allows both manual editing of its &lt;br/&gt;
configuration files, and  manipulation of the configuration via software. When &lt;br/&gt;
saving the configuration file after changing, its file structure - file, &lt;br/&gt;
section and line comments - will all be lost. Next time a human tries to edit &lt;br/&gt;
the configuration file, all property documentation will be lost.&lt;/p&gt;

&lt;p&gt;I have created a fix for this problem, applicable to PropertiesConfiguration &lt;br/&gt;
and XMLPropertiesConfiguration. The fix allows these classes to preserve a &lt;br/&gt;
list of comment lines preceding each property line. By default, comments are &lt;br/&gt;
not preserved; in case the comment preservation is required, it should be &lt;br/&gt;
enabled prior to loading the configuration file using:&lt;/p&gt;

&lt;p&gt;AbstractFileConfiguration.setDefaultPreserveComments(true);&lt;/p&gt;


&lt;p&gt;The fix is implemented and tested, attached as a patch file to this bug.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Operating System: other&lt;br/&gt;
Platform: Other&lt;/p&gt;</environment>
        <key id="12343007">CONFIGURATION-104</key>
            <summary>[configuration] Preserve file structure (line comments) when re-saving properties file</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="oliver.heger@t-online.de">Oliver Heger</assignee>
                                    <reporter username="oded.noam@adamind.com">Oded Noam</reporter>
                        <labels>
                    </labels>
                <created>Mon, 3 Apr 2006 00:52:03 +0000</created>
                <updated>Sat, 22 Jul 2006 17:09:45 +0000</updated>
                            <resolved>Sat, 22 Jul 2006 17:09:45 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12411695" author="oded.noam@adamind.com" created="Mon, 3 Apr 2006 00:53:17 +0000"  >&lt;p&gt;Created an attachment (id=18018)&lt;br/&gt;
Comment preservation mechanism for AbstractFileConfiguration and its&lt;br/&gt;
descendants&lt;/p&gt;</comment>
                            <comment id="12411696" author="oliver.heger@t-online.de" created="Tue, 11 Apr 2006 23:46:03 +0000"  >&lt;p&gt;Looks interesting. Thank you for your work!&lt;/p&gt;

&lt;p&gt;I think, Emmanuel Bourg also has some ideas in this area (see&lt;br/&gt;
&lt;a href=&quot;http://issues.apache.org/bugzilla/show_bug.cgi?id=38285#c3&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/bugzilla/show_bug.cgi?id=38285#c3&lt;/a&gt;). Maybe he can chime&lt;br/&gt;
in and comment about how your approach fits with his ideas?&lt;/p&gt;

&lt;p&gt;However there is one thing I noticed, which is problematic: Our target&lt;br/&gt;
environment is still JDK 1.3. You use some of the new regex facilities that are&lt;br/&gt;
not available in this JDK. So either the affected parts have to be re-written or&lt;br/&gt;
this patch cannot be applied before we drop support for JDK 1.3.&lt;/p&gt;</comment>
                            <comment id="12411697" author="oded.noam@adamind.com" created="Wed, 12 Apr 2006 01:23:41 +0000"  >&lt;p&gt;Created an attachment (id=18067)&lt;br/&gt;
Revised - java1.3 version of the patch&lt;/p&gt;

&lt;p&gt;You are right about the Java1.3 compliance issue. I fixed it.&lt;/p&gt;

&lt;p&gt;Of course, this is not exactly what Emmanuel Bourg dreamt about... But it could&lt;br/&gt;
be expanded to be good enough 90% of the times. Emmanuel Bourg&apos;s idea seems&lt;br/&gt;
nice, but I don&apos;t think it can be achieved without requiring the user to create&lt;br/&gt;
a formatting definitions file for each properties file. Maybe some enhancement&lt;br/&gt;
of my mechanism would be easier to use.&lt;/p&gt;</comment>
                            <comment id="12411698" author="ebourg" created="Wed, 12 Apr 2006 01:27:43 +0000"  >&lt;p&gt;Thanks for the patch ! &lt;/p&gt;

&lt;p&gt;There are several aspects to consider in order to preserve completly the file&lt;br/&gt;
structure:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the comments (property or section comments)&lt;/li&gt;
	&lt;li&gt;the blank lines&lt;/li&gt;
	&lt;li&gt;the order of the properties&lt;/li&gt;
	&lt;li&gt;the proper insertion of the new properties next to the similar properties&lt;/li&gt;
	&lt;li&gt;the format of the properties:&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;multiline or single line lists&lt;/li&gt;
	&lt;li&gt;decimal or hexadecimal numbers&lt;/li&gt;
	&lt;li&gt;text wrapped on multiple lines&lt;/li&gt;
	&lt;li&gt;etc&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;To handle this I&apos;d like to introduce a Layout class attached to the&lt;br/&gt;
configuration rather than overloading the class with more methods. This class&lt;br/&gt;
will maintain a List of the elements of the file. This list would look like this:&lt;/p&gt;

&lt;p&gt;    &amp;lt;comment: Configuration file for the Foo application&amp;gt;&lt;br/&gt;
    &amp;lt;blank line&amp;gt;&lt;br/&gt;
    &amp;lt;comment: Main properties&amp;gt;&lt;br/&gt;
    property: foo.key.a&lt;br/&gt;
    property: foo.key.b&lt;br/&gt;
    property: foo.key.bar.a&lt;br/&gt;
    &amp;lt;blank line&amp;gt;&lt;br/&gt;
    &amp;lt;comment: Secondary properties&amp;gt;&lt;br/&gt;
    property: bar.key.a&lt;br/&gt;
    property: bar.key.b&lt;br/&gt;
    property: bar.key.c&lt;/p&gt;

&lt;p&gt;Every time a property is added or removed from the configuration, the layout&lt;br/&gt;
will be notified and it will update the list accordingly. It will attempt to&lt;br/&gt;
group the properties by prefix. For example, if the foo.key.bar.b property is&lt;br/&gt;
added, it will look for the last property sharing the same prefix, that&apos;s&lt;br/&gt;
foo.key.bar.a, and insert it after:&lt;/p&gt;

&lt;p&gt;    ...&lt;br/&gt;
    property: foo.key.a&lt;br/&gt;
    property: foo.key.b&lt;br/&gt;
    property: foo.key.bar.a&lt;br/&gt;
    property: foo.key.bar.b&lt;br/&gt;
    ...&lt;/p&gt;

&lt;p&gt;If no similar property is found the property is added at the end of the list.&lt;/p&gt;

&lt;p&gt;For every property a format is attached, that&apos;s what specifies the property&lt;br/&gt;
specific details like the list format or the number format.&lt;/p&gt;

&lt;p&gt;It&apos;ll be possible to disable this feature if performance is more important than&lt;br/&gt;
the correctness of the file. Either by adding a flag to the layout, or by using&lt;br/&gt;
a NullLayout that would produce the same result we have today.&lt;/p&gt;
</comment>
                            <comment id="12411699" author="oded.noam@adamind.com" created="Wed, 12 Apr 2006 14:16:32 +0000"  >&lt;p&gt;I like the idea for the Layout class. But I see two problems with the fact &lt;br/&gt;
that the Layout object is initialized from a configuration file.&lt;/p&gt;

&lt;p&gt;First, it requires the application developer to create a layout configuration &lt;br/&gt;
file, in addition to default properties file (and, of course, to make sure the &lt;br/&gt;
two are compliant with each other). This is a small issue but I suspect that &lt;br/&gt;
this requirement might discourage 99% of the potential users of this feature.&lt;/p&gt;

&lt;p&gt;Second, since the layout of the file is not derived from the layout it had &lt;br/&gt;
before being parsed, re-saving it may result in re-ordering of the lines in &lt;br/&gt;
the file, thus making it harder to review the changes using diff (or CVS, for &lt;br/&gt;
that matter).&lt;/p&gt;

&lt;p&gt;On the other hand, using a layout configuration file will enable formatting of &lt;br/&gt;
properties added by the user, and accurate formatting of complex properties &lt;br/&gt;
(lists, multi-lines etc). Perhaps you know of applications that make a more &lt;br/&gt;
sophisticated use of properties files than I do, but in the applications I&apos;ve &lt;br/&gt;
seen, it is rare for an end user to make a big change to the properties file. &lt;br/&gt;
Usually an end user would only modify a couple of properties that are &lt;br/&gt;
specified in the file (or commented out). Same goes for configuration changes &lt;br/&gt;
made via software.&lt;/p&gt;

&lt;p&gt;Maybe the way to go is to create the Layout class, and have it initialized &lt;br/&gt;
from analyzing the parsed properties file. Such layout class would not be &lt;br/&gt;
complete, but in time we can add all kinds of heuristics for it to detect &lt;br/&gt;
things like multiline layout configuration, property groups etc.&lt;/p&gt;</comment>
                            <comment id="12419922" author="oliver.heger@t-online.de" created="Sun, 9 Jul 2006 23:20:16 +0000"  >&lt;p&gt;+1 for the idea of a Layout class that tries to obtain as much information as possible from the properties file. I would like to start with a rather simple one that can be enhanced step by step.&lt;/p&gt;

&lt;p&gt;The collaboration between a PropertiesConfiguration object and its Layout object could be as follows:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The load(Reader) method of PropertiesConfiguration delegates to the Layout object.&lt;/li&gt;
	&lt;li&gt;The Layout object reads the file line by line and stores relevant information, e.g. about comments, in internal data structures.&lt;/li&gt;
	&lt;li&gt;Extracted properties are added to the PropertiesConfiguration.&lt;/li&gt;
	&lt;li&gt;The Layout object is also registered as event listener at its PropertiesConfiguration. If events are received, its content is updated accordingly.&lt;/li&gt;
	&lt;li&gt;PropertiesConfiguration.save(Writer) again delegates to the Layout object for writing the data back to file.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So the interface of the layout class could roughly look as follows:&lt;/p&gt;

&lt;p&gt;public class PropertiesConfigurationLayout implements ConfigurationListener&lt;/p&gt;
{
    /**
     * Creates a new instance and sets the associated configuration.
     */
    public PropertiesConfigurationLayou(PropertiesConfiguration config);

    /**
     * Reads in a properties file.
     */
    public void load(Reader in) throws ConfigurationException;

    /**
     * Writes the internal data into a properties file.
     */
    public void save(Writer out) throws ConfigurationException;

    // it would also be nice to have access to comments for properties
    
    /**
     * Returns the comment for the specified key.
     */
    public String getComment(String key);

    /**
     * Sets the comment for the specified key.
     */
    public void setComment(String key, String comment);

    /**
     * Returns the header comment.
     */
    public String getHeaderComment();

    /**
     * Sets the header comment.
     */
    public void setHeaderComment(String comment);
}

&lt;p&gt;Any thoughts?&lt;/p&gt;</comment>
                            <comment id="12422836" author="oliver.heger@t-online.de" created="Sat, 22 Jul 2006 17:09:45 +0000"  >&lt;p&gt;A new class PropertiesConfigurationLayout was added. Objects of this class are associated with PropertiesConfiguration instances. They are able to preserve many structure related aspects of a properties file.&lt;/p&gt;

&lt;p&gt;Please have a look if this class fits your needs.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12345091">CONFIGURATION-218</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12342408">CONFIGURATION-140</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12334096" name="ASF.LICENSE.NOT.GRANTED--preserve-comments-patch" size="26595" author="oded.noam@adamind.com" created="Mon, 3 Apr 2006 00:53:17 +0000"/>
                            <attachment id="12334097" name="ASF.LICENSE.NOT.GRANTED--preserve-comments-patch-java1.3" size="27732" author="oded.noam@adamind.com" created="Wed, 12 Apr 2006 01:23:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                        <customfieldname>Bugzilla Id</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39182</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 11 Apr 2006 23:46:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>110687</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 20 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0tf8v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>169779</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>