<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Thu Dec 01 20:06:07 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CONFIGURATION-88/CONFIGURATION-88.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CONFIGURATION-88] [configuration] ClassNotFoundException on Sun App Server</title>
                <link>https://issues.apache.org/jira/browse/CONFIGURATION-88</link>
                <project id="12310467" key="CONFIGURATION">Commons Configuration</project>
                    <description>&lt;p&gt;When used in an EJB application deployed on Sun app server 8.1 (platform edition&lt;br/&gt;
8.1 build b28-beta), ConfigurationFactory throws a java.lang.ClassNotFoundException:&lt;br/&gt;
org.apache.commons.configuration.Configuration.&lt;/p&gt;

&lt;p&gt;Sun includes Digester in at least one of the jars included with the platform,&lt;br/&gt;
appserv-rt.jar, so presumably Digester is being loaded by the System&lt;br/&gt;
classloader.  This makes Digester unable to find classes loaded by the EJB&lt;br/&gt;
classloader (in this case, classes in configuration-1.0.jar) unless Digester&apos;s&lt;br/&gt;
useContextClassLoader variable is set to true.&lt;/p&gt;

&lt;p&gt;This patch modifies ConfigurationFactory to set useContextClassLoader to true on&lt;br/&gt;
the digester.&lt;/p&gt;

&lt;p&gt;Index: ConfigurationFactory.java&lt;br/&gt;
===================================================================&lt;br/&gt;
RCS file:&lt;br/&gt;
/home/cvspublic/jakarta-commons/configuration/src/java/org/apache/commons/configuration/ConfigurationFactory.java,v&lt;br/&gt;
retrieving revision 1.20&lt;br/&gt;
diff -u -w -b -r1.20 ConfigurationFactory.java&lt;br/&gt;
&amp;#8212; ConfigurationFactory.java	23 Dec 2004 18:42:25 -0000	1.20&lt;br/&gt;
+++ ConfigurationFactory.java	9 Feb 2005 20:22:18 -0000&lt;br/&gt;
@@ -152,8 +152,12 @@&lt;br/&gt;
             // awareness must be configured before the digester rules are&lt;br/&gt;
loaded.&lt;br/&gt;
             configureNamespace(digester);&lt;br/&gt;
         }&lt;br/&gt;
+&lt;br/&gt;
+        digester.setUseContextClassLoader (true);&lt;br/&gt;
+&lt;br/&gt;
         // Put the composite builder object below all of the other objects.&lt;br/&gt;
         digester.push(builder);&lt;br/&gt;
+&lt;br/&gt;
         // Parse the input stream to configure our mappings&lt;br/&gt;
         try&lt;br/&gt;
         {&lt;/p&gt;</description>
                <environment>&lt;p&gt;Operating System: Windows XP&lt;br/&gt;
Platform: PC&lt;/p&gt;</environment>
        <key id="12342047">CONFIGURATION-88</key>
            <summary>[configuration] ClassNotFoundException on Sun App Server</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mbcolbert@yahoo.com">Mike Colbert</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Feb 2005 06:36:05 +0000</created>
                <updated>Tue, 16 May 2006 11:23:50 +0000</updated>
                            <resolved>Tue, 16 May 2006 11:23:50 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12408686" author="mbcolbert@yahoo.com" created="Thu, 10 Feb 2005 07:02:04 +0000"  >&lt;p&gt;Stack trace ...&lt;/p&gt;

&lt;p&gt;java.lang.ClassNotFoundException:&lt;br/&gt;
org.apache.commons.configuration.Configuration&lt;br/&gt;
	at java.net.URLClassLoader$1.run(URLClassLoader.java:199)&lt;br/&gt;
	at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
	at java.net.URLClassLoader.findClass(URLClassLoader.java:187)&lt;br/&gt;
	at java.lang.ClassLoader.loadClass(ClassLoader.java:289)&lt;br/&gt;
	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:274)&lt;br/&gt;
	at java.lang.ClassLoader.loadClass(ClassLoader.java:235)&lt;br/&gt;
	at org.apache.commons.digester.SetNextRule.end(SetNextRule.java:243)&lt;br/&gt;
	at org.apache.commons.digester.Rule.end(Rule.java:276)&lt;br/&gt;
	at org.apache.commons.digester.Digester.endElement(Digester.java:1058)&lt;br/&gt;
	at&lt;br/&gt;
com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.endElement(AbstractSAXParser.java:585)&lt;br/&gt;
	at&lt;br/&gt;
com.sun.org.apache.xerces.internal.parsers.AbstractXMLDocumentParser.emptyElement(AbstractXMLDocumentParser.java:221)&lt;br/&gt;
	at&lt;br/&gt;
com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanStartElement(XMLDocumentFragmentScannerImpl.java:839)&lt;br/&gt;
	at&lt;br/&gt;
com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(XMLDocumentFragmentScannerImpl.java:1563)&lt;br/&gt;
	at&lt;br/&gt;
com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:341)&lt;br/&gt;
	at&lt;br/&gt;
com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:828)&lt;br/&gt;
	at&lt;br/&gt;
com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:758)&lt;br/&gt;
	at&lt;br/&gt;
com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:148)&lt;br/&gt;
	at&lt;br/&gt;
com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1178)&lt;br/&gt;
	at org.apache.commons.digester.Digester.parse(Digester.java:1567)&lt;br/&gt;
	at&lt;br/&gt;
org.apache.commons.configuration.ConfigurationFactory.getConfiguration(ConfigurationFactory.java:157)&lt;/p&gt;</comment>
                            <comment id="12408687" author="oliver.heger@t-online.de" created="Thu, 10 Feb 2005 21:59:03 +0000"  >&lt;p&gt;Mike,&lt;/p&gt;

&lt;p&gt;I am a bit reluctant about this patch because I am unsure whether it has any&lt;br/&gt;
undesired side effects. Did you check if all unit tests run with your modification?&lt;/p&gt;

&lt;p&gt;Did you evaluate other options to solve your problem, e.g. including the correct&lt;br/&gt;
version of digester in your ear and setting the classpath property in the&lt;br/&gt;
manifest of your ejb-jars?&lt;/p&gt;

&lt;p&gt;Oliver&lt;/p&gt;</comment>
                            <comment id="12408688" author="mbcolbert@yahoo.com" created="Thu, 10 Feb 2005 23:30:37 +0000"  >&lt;p&gt;Hi Oliver,&lt;/p&gt;

&lt;p&gt;I ran the unit tests with and without the patch; TestXMLConfiguration failed in&lt;br/&gt;
the same way both times at testLoad.  So, I&apos;m unable to tell at this time if the&lt;br/&gt;
patch affects the unit tests.  This is using code from CVS.&lt;/p&gt;

&lt;p&gt;Regarding other options, I&apos;m open to alternatives.  I am already packaging the&lt;br/&gt;
correct jars in the EAR and setting the classpath in the ejb-jar manifest.  This&lt;br/&gt;
doesn&apos;t solve the problem, though, due to the classloader delegation model. &lt;br/&gt;
Since Digester is already loaded by the System classloader, it will not be&lt;br/&gt;
loaded by any child classloaders, such as the EJB classloader.&lt;/p&gt;

&lt;p&gt;Again, I&apos;m using code from CVS.  Does this make any difference?  I&apos;m a little&lt;br/&gt;
confused about whether to use CVS or SVN here.  CVS doesn&apos;t look seem as up to date.&lt;/p&gt;


</comment>
                            <comment id="12408689" author="oliver.heger@t-online.de" created="Thu, 10 Feb 2005 23:44:52 +0000"  >&lt;p&gt;Mike,&lt;/p&gt;

&lt;p&gt;we (the whole jakarta commons) switched from CVS to SVN recently. There have&lt;br/&gt;
been minor changes in the meantime (especially in the build.xml), thats probably&lt;br/&gt;
the reason why the unit tests fail. You can checkout the newest version of&lt;br/&gt;
configuration using&lt;/p&gt;

&lt;p&gt;svn checkout&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/repos/asf/jakarta/commons/proper/configuration/trunk&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/jakarta/commons/proper/configuration/trunk&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Oliver&lt;/p&gt;</comment>
                            <comment id="12408690" author="ebourg" created="Thu, 10 Feb 2005 23:48:35 +0000"  >&lt;p&gt;The code has been migrated to SVN recently, you can ignore the code in CVS.&lt;/p&gt;

&lt;p&gt;I&apos;m +1 for the change suggested by Mike, I haven&apos;t tested it but it makes sense.&lt;br/&gt;
If this issue comes back later we can easily add a way to configure the&lt;br/&gt;
classloader used by the ConfigurationFactory.&lt;/p&gt;</comment>
                            <comment id="12408691" author="oliver.heger@t-online.de" created="Thu, 10 Feb 2005 23:57:20 +0000"  >&lt;p&gt;If the unit tests run, I am fine as well.&lt;/p&gt;

&lt;p&gt;I was wondering if it makes sense to get rid off digester as a core dependency&lt;br/&gt;
anyway. The XML files processed by configuration factory are quite simple and&lt;br/&gt;
digester does not earn us that much. I think parsing these files by hand using&lt;br/&gt;
SAX would not be too complicated.&lt;/p&gt;

&lt;p&gt;Oliver&lt;/p&gt;</comment>
                            <comment id="12408692" author="ebourg" created="Fri, 11 Feb 2005 00:20:21 +0000"  >&lt;p&gt;Well why not, but that may prevent us from doing more complex things with&lt;br/&gt;
ConfigurationFactory in the future. Digester is also used by&lt;br/&gt;
XMLPropertiesConfiguration, a simple SAX parser would be good enough there.&lt;/p&gt;</comment>
                            <comment id="12408693" author="oliver.heger@t-online.de" created="Fri, 11 Feb 2005 04:38:02 +0000"  >&lt;p&gt;Or even cooler, we could use XMLConfiguration in ConfigurationFactory to parse&lt;br/&gt;
the definition file. Then we could use the whole Configuration API to access the&lt;br/&gt;
properties and could do wild things, too. Just a thought, but I enjoy such&lt;br/&gt;
recursive stuff!&lt;/p&gt;</comment>
                            <comment id="12408694" author="skitching" created="Fri, 11 Feb 2005 06:57:34 +0000"  >&lt;p&gt;(In reply to comment #8)&lt;br/&gt;
&amp;gt; Or even cooler, we could use XMLConfiguration in ConfigurationFactory to parse&lt;br/&gt;
&amp;gt; the definition file. Then we could use the whole Configuration API to access the&lt;br/&gt;
&amp;gt; properties and could do wild things, too. Just a thought, but I enjoy such&lt;br/&gt;
&amp;gt; recursive stuff!&lt;/p&gt;

&lt;p&gt;If you can use XMLConfiguration to read your config files, I would recommend that.&lt;/p&gt;

&lt;p&gt;However in reference to the original posting, I think setting Digester&apos;s&lt;br/&gt;
useContextClassLoader is the correct thing to do, and should not have any&lt;br/&gt;
side-effects. If this flag is defined but there is no context classloader set,&lt;br/&gt;
then digester will effectively ignore the flag.&lt;/p&gt;

&lt;p&gt;The only possibility for problems is where contextClassLoader is set but you&lt;br/&gt;
don&apos;t want to use that to load &quot;user&quot; classes. And I can&apos;t see why that would&lt;br/&gt;
ever happen.&lt;/p&gt;

&lt;p&gt;Cheers,&lt;/p&gt;

&lt;p&gt;Simon (one of the maintainers of commons-digester)&lt;/p&gt;</comment>
                            <comment id="12408695" author="oliver.heger@t-online.de" created="Fri, 11 Feb 2005 15:55:43 +0000"  >&lt;p&gt;Simon,&lt;/p&gt;

&lt;p&gt;thank you for making things clearer.&lt;/p&gt;

&lt;p&gt;Then I am also +1 for applying this patch now. If we want to remove the&lt;br/&gt;
dependency to digester, we can do this in the process of the refactoring of&lt;br/&gt;
ConfigurationFactory.&lt;/p&gt;

&lt;p&gt;Emmanuel, are you going to apply this patch?&lt;/p&gt;</comment>
                            <comment id="12408696" author="ebourg" created="Fri, 11 Feb 2005 18:16:33 +0000"  >&lt;p&gt;Go ahead and apply, I&apos;m not fully operational with SVN yet &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12408697" author="mbcolbert@yahoo.com" created="Fri, 11 Feb 2005 22:13:43 +0000"  >&lt;p&gt;Thanks to everyone for weighing in and taking a look at the problem so quickly.&lt;/p&gt;

</comment>
                            <comment id="12408698" author="oliver.heger@t-online.de" created="Sat, 12 Feb 2005 00:21:32 +0000"  >&lt;p&gt;Patch applied.&lt;br/&gt;
Thank you very much!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                        <customfieldname>Bugzilla Id</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33475</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 10 Feb 2005 21:59:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>110681</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 43 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0tfd3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>169798</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>