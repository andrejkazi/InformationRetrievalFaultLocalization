<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Thu Dec 01 19:51:26 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CONFIGURATION-336/CONFIGURATION-336.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CONFIGURATION-336] Brackets in property key causes NumberFormatException</title>
                <link>https://issues.apache.org/jira/browse/CONFIGURATION-336</link>
                <project id="12310467" key="CONFIGURATION">Commons Configuration</project>
                    <description>&lt;p&gt;Hi,&lt;br/&gt;
When using brackets in property key we get an exception every time.&lt;br/&gt;
Escaping brackets with \ doesn&apos;t help.&lt;/p&gt;

&lt;p&gt;Example&lt;br/&gt;
#property in property file&lt;br/&gt;
test(ef)=false&lt;/p&gt;

&lt;p&gt;causes &lt;br/&gt;
java.lang.NumberFormatException: For input string: &quot;ef&quot; at&lt;br/&gt;
java.lang.NumberFormatException.forInputString(NumberFormatException.java:48)&lt;br/&gt;
        at java.lang.Integer.parseInt(Integer.java:447)&lt;br/&gt;
        at java.lang.Integer.parseInt(Integer.java:497)&lt;br/&gt;
        at org.apache.commons.configuration.tree.DefaultConfigurationKey&lt;br/&gt;
$KeyIterator.checkIndex(DefaultConfigurationKey.java:834)&lt;br/&gt;
        at org.apache.commons.configuration.tree.DefaultConfigurationKey&lt;br/&gt;
$KeyIterator.nextKey(DefaultConfigurationKey.java:511) at&lt;br/&gt;
org.apache.commons.configuration.tree.DefaultExpressionEngine.findNodesForKey(DefaultExpressionEngine.java:462) at&lt;br/&gt;
org.apache.commons.configuration.tree.DefaultExpressionEngine.query(DefaultExpressionEngine.java:286) at&lt;br/&gt;
org.apache.commons.configuration.HierarchicalConfiguration.fetchNodeList(HierarchicalConfiguration.java:925 at&lt;br/&gt;
org.apache.commons.configuration.HierarchicalConfiguration.setProperty(HierarchicalConfiguration.java:735) at&lt;br/&gt;
org.apache.commons.configuration.ConfigurationUtils.copy(ConfigurationUtils.java:143) at&lt;br/&gt;
org.apache.commons.configuration.ConfigurationUtils.convertToHierarchical(ConfigurationUtils.java:199)  at org.apache.commons.configuration.CombinedConfiguration&lt;br/&gt;
$ConfigData.getTransformedRoot(CombinedConfiguration.java:794)  at&lt;br/&gt;
org.apache.commons.configuration.CombinedConfiguration.constructCombinedNode(CombinedConfiguration.java:653) at&lt;br/&gt;
org.apache.commons.configuration.CombinedConfiguration.getRootNode(CombinedConfiguration.java:504) at&lt;br/&gt;
org.apache.commons.configuration.HierarchicalConfiguration.fetchNodeList(HierarchicalConfiguration.java:925) at&lt;br/&gt;
org.apache.commons.configuration.HierarchicalConfiguration.getProperty(HierarchicalConfiguration.java:327) at&lt;br/&gt;
org.apache.commons.configuration.CombinedConfiguration.getProperty(CombinedConfiguration.java:578) at&lt;br/&gt;
org.apache.commons.configuration.AbstractConfiguration.resolveContainerStore(AbstractConfiguration.java:1155) at&lt;br/&gt;
org.apache.commons.configuration.AbstractConfiguration.getString(AbstractConfiguration.java:1034)  at&lt;br/&gt;
org.apache.commons.configuration.AbstractConfiguration.getString(AbstractConfiguration.java:1017) &lt;/p&gt;

&lt;p&gt;Explanation i got in mailing list from Oliver Heger&lt;/p&gt;

&lt;p&gt;I guess you use DefaultConfigurationBuilder for loading a combined &lt;br/&gt;
configuration?&lt;/p&gt;

&lt;p&gt;The exception is due to the fact that brackets have a special meaning in &lt;br/&gt;
the query syntax for hierarchical configurations. &lt;br/&gt;
(DefaultConfigurationBuilder transforms all configuration sources into &lt;br/&gt;
hierarchical configurations, so also for properties, which are not &lt;br/&gt;
hierarchical by default, the same rules apply.)&lt;/p&gt;

&lt;p&gt;So far escaping brackets or other specific characters in property keys &lt;br/&gt;
is not supported. It seems to be rather unusual to use brackets in &lt;br/&gt;
property keys, so you may well be the first one who noticed this problem.&lt;/p&gt;

&lt;p&gt;Unfortunately I don&apos;t have a working solution for this problem right &lt;br/&gt;
now.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12405348">CONFIGURATION-336</key>
            <summary>Brackets in property key causes NumberFormatException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="oliver.heger@t-online.de">Oliver Heger</assignee>
                                    <reporter username="palko">Pavel Savara</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Sep 2008 07:49:06 +0000</created>
                <updated>Fri, 15 Jan 2010 05:13:41 +0000</updated>
                            <resolved>Tue, 4 Nov 2008 21:19:45 +0000</resolved>
                                    <version>1.5</version>
                                    <fixVersion>1.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12643769" author="oliver.heger@t-online.de" created="Thu, 30 Oct 2008 07:24:51 +0000"  >&lt;p&gt;The problem is basically caused by the conversion of a flat Configuration (e.g. a PropertiesConfiguration) into a hierarchical one. Here all keys of the flat configuration are obtained and inserted into the new hierarchical configuration. The hierarchical configuration is initialized with a default expression engine that parses the property keys for brackets and tries to interpret their contents as index values. This fails in this specific case.&lt;/p&gt;

&lt;p&gt;I think, a good solution for this problem would be to support using a specific ExpressionEngine when converting a flat configuration to a hierarchical one. If the property keys contain some critical characters like brackets, an expression engine could be used that is initialized with different index markers, e.g. square brackets.&lt;/p&gt;

&lt;p&gt;To implement this solution at least two places have to be changed:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;ConfigurationUtils needs an overloaded variant of the convertToHierarchical() method, which also expects an ExpressionEngine as parameter.&lt;/li&gt;
	&lt;li&gt;CombinedConfiguration should use its own expression engine when converting flat configurations to hierarchical ones. (This makes sense because this expression will also be used when querying the resulting combined configuration.)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12645083" author="oliver.heger@t-online.de" created="Tue, 4 Nov 2008 21:19:45 +0000"  >&lt;p&gt;It is now possible to specify an expression engine when converting a flat configuration to a hierarchical one. By using a properly configured expression engine you can work around the problem with property keys having a special meaning for the expression engine.&lt;/p&gt;

&lt;p&gt;The applied fix contains two major changes:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;There is an overloaded version of &lt;tt&gt;ConfigurationUtils.convertToHierarchical()&lt;/tt&gt; that also expects an &lt;tt&gt;ExpressionEngine&lt;/tt&gt; as argument.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;CombinedConfiguration&lt;/tt&gt; has the new &lt;tt&gt;conversionExpressionEngine&lt;/tt&gt; property. The &lt;tt&gt;ExpressionEngine&lt;/tt&gt; set here is used when the internal node structure is constructed.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In the unit test class for &lt;tt&gt;CombinedConfiguration&lt;/tt&gt; a new test case was added (&lt;tt&gt;testConversionExpressionEngine()&lt;/tt&gt; demonstrating how this new property can be used.&lt;/p&gt;</comment>
                            <comment id="12800203" author="walkerr" created="Thu, 14 Jan 2010 13:51:57 +0000"  >&lt;p&gt;The fixes above provide a workaround, but it&apos;s not exactly a &quot;low pain / low effort&quot; option, and is made harder by a lot of use of private methods in DefaultConfigurationKey etc preventing a simple subclassing approach.&lt;/p&gt;

&lt;p&gt;I suspect it&apos;s going to become a bigger issue for more people too, since Vista and Windows 7 both have additional environment/path variables that break this e.g.&lt;/p&gt;

&lt;p&gt;ProgamFiles(x86) &lt;/p&gt;

&lt;p&gt;It seems a small and simple fix to DefaultConfigurationKey.KeyIterator could take away a ton of pain for the simple case e.g.&lt;/p&gt;

&lt;p&gt;        private boolean checkIndex(String key)&lt;br/&gt;
        {&lt;br/&gt;
            boolean result = false;&lt;/p&gt;

&lt;p&gt;            try&lt;br/&gt;
            {&lt;br/&gt;
                int idx = key.lastIndexOf(getExpressionEngine().getIndexStart());&lt;br/&gt;
                if (idx &amp;gt; 0)&lt;br/&gt;
                {&lt;br/&gt;
                    int endidx = key.indexOf(getExpressionEngine().getIndexEnd(),&lt;br/&gt;
                            idx);&lt;/p&gt;

&lt;p&gt;                    if (endidx &amp;gt; idx + 1)&lt;/p&gt;
                    {
                        indexValue = Integer.parseInt(key.substring(idx + 1, endidx));
                        current = key.substring(0, idx);
                        result = true;
                    }
&lt;p&gt;                }&lt;br/&gt;
            }&lt;br/&gt;
            catch (NumberFormatException nfe)&lt;/p&gt;
            {
                result = false;
            }

&lt;p&gt;            return result;&lt;br/&gt;
        }&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                                                <inwardlinks description="is cloned by">
                                        <issuelink>
            <issuekey id="12445598">CONFIGURATION-404</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 30 Oct 2008 07:24:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>110837</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 47 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uptb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>177323</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>