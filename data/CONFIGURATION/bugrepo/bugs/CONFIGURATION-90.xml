<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Thu Dec 01 20:03:45 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CONFIGURATION-90/CONFIGURATION-90.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CONFIGURATION-90] [configuration] Set wrong property when call XMLConfiguration.setProperty</title>
                <link>https://issues.apache.org/jira/browse/CONFIGURATION-90</link>
                <project id="12310467" key="CONFIGURATION">Commons Configuration</project>
                    <description>&lt;p&gt;When I call org.apache.commons.configuration.XMLConfiguration.setProperty to &lt;br/&gt;
set property, I find the relevant element in XML Document is set twice. For &lt;br/&gt;
example, to call setProperty(&quot;name1&quot;, &quot;value1&quot;) will obtain the node like &lt;br/&gt;
&amp;lt;name1&amp;gt;value1value1&amp;lt;/name1&amp;gt;&lt;br/&gt;
the value &quot;value1&quot; appear twice.&lt;/p&gt;

&lt;p&gt;I find that when I call setProperty, addXMLProperty is called before &lt;br/&gt;
setXMLProperty. When I comment &quot;setXmlProperty(name, value);&quot;(about line 347 in &lt;br/&gt;
XMLConfiguration), the problem is disappeared.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Operating System: All&lt;br/&gt;
Platform: All&lt;/p&gt;</environment>
        <key id="12341653">CONFIGURATION-90</key>
            <summary>[configuration] Set wrong property when call XMLConfiguration.setProperty</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="njualert">Gao Peng</reporter>
                        <labels>
                    </labels>
                <created>Mon, 23 Aug 2004 16:35:58 +0000</created>
                <updated>Sat, 22 Aug 2009 19:36:41 +0000</updated>
                            <resolved>Sat, 22 Aug 2009 19:36:41 +0000</resolved>
                                    <version>Nightly Builds</version>
                                    <fixVersion>1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12407309" author="dep4b" created="Fri, 10 Sep 2004 20:37:14 +0000"  >&lt;p&gt;I tried this, and it all worked..  Can you test with CVS HEAD?  If you see the&lt;br/&gt;
bug, can you edit TestXmlConfiguration and add a testcase?&lt;/p&gt;</comment>
                            <comment id="12407310" author="ebourg" created="Fri, 10 Sep 2004 20:54:15 +0000"  >&lt;p&gt;Changing resolution to WFM&lt;/p&gt;</comment>
                            <comment id="12407311" author="ebourg" created="Tue, 28 Sep 2004 18:47:56 +0000"  >&lt;p&gt;Reopening per comment #2 in &lt;a href=&quot;https://issues.apache.org/jira/browse/CONFIGURATION-168&quot; title=&quot;[configuration] Messed file on saving an XMLConfiguration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CONFIGURATION-168&quot;&gt;&lt;del&gt;COM-1601&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12407312" author="rwinston@eircom.net" created="Tue, 28 Sep 2004 19:08:42 +0000"  >&lt;p&gt;I can reproduce with this code:&lt;/p&gt;

&lt;p&gt;/*&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Copyright 2001-2004 The Apache Software Foundation.&lt;br/&gt;
 *&lt;/li&gt;
	&lt;li&gt;Licensed under the Apache License, Version 2.0 (the &quot;License&quot;)&lt;/li&gt;
	&lt;li&gt;you may not use this file except in compliance with the License.&lt;/li&gt;
	&lt;li&gt;You may obtain a copy of the License at&lt;br/&gt;
 *&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
 *&lt;/li&gt;
	&lt;li&gt;Unless required by applicable law or agreed to in writing, software&lt;/li&gt;
	&lt;li&gt;distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;/li&gt;
	&lt;li&gt;WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;/li&gt;
	&lt;li&gt;See the License for the specific language governing permissions and&lt;/li&gt;
	&lt;li&gt;limitations under the License.&lt;br/&gt;
 */&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;package org.apache.commons.configuration;&lt;/p&gt;

&lt;p&gt;import java.io.File;&lt;/p&gt;


&lt;p&gt;/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;test for loading and saving xml properties files&lt;br/&gt;
 *&lt;/li&gt;
	&lt;li&gt;@version $Id: TestXMLConfiguration.java,v 1.11 2004/09/22 17:17:30 ebourg Exp $&lt;br/&gt;
 */&lt;br/&gt;
public class TestCfg &lt;br/&gt;
{&lt;br/&gt;
    /** The File that we test with */&lt;br/&gt;
    private static String testProperties = new&lt;br/&gt;
File(&quot;conf/ckfr_test.xml&quot;).getAbsolutePath();&lt;br/&gt;
    private static String testBasePath = new File(&quot;conf&quot;).getAbsolutePath();&lt;br/&gt;
    private static File testSaveConf = new File(&quot;target/ckfr_save.xml&quot;);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    static XMLConfiguration conf;&lt;/p&gt;

&lt;p&gt;    public static void main(String[] args) throws Exception&lt;/p&gt;
    {
        conf = new XMLConfiguration(new File(testProperties));
		conf.addProperty(&quot;a.key2&quot;, &quot;value2&quot;);
		conf.save(testSaveConf);
		conf.setProperty(&quot;a.key1&quot;, &quot;abcdefgh&quot;);
		conf.save(testSaveConf); 
    }
&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;and this starting file:&lt;/p&gt;

&lt;p&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&lt;br/&gt;
&amp;lt;configuration&amp;gt;&lt;br/&gt;
&amp;lt;a&amp;gt;&lt;br/&gt;
&amp;lt;/a&amp;gt;&lt;br/&gt;
&amp;lt;/configuration&amp;gt;&lt;/p&gt;

&lt;p&gt;Can anyone else reproduce? Some logging statements:&lt;/p&gt;

&lt;p&gt;INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt;&lt;br/&gt;
org.apache.commons.configuration.XMLConfiguration.addXmlProperty(XMLConfiguration.java:478)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Created element: [&lt;span class=&quot;error&quot;&gt;&amp;#91;key1: null&amp;#93;&lt;/span&gt;], appending to parent [&lt;span class=&quot;error&quot;&gt;&amp;#91;a: null&amp;#93;&lt;/span&gt;]&lt;br/&gt;
INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt;&lt;br/&gt;
org.apache.commons.configuration.XMLConfiguration.addXmlProperty(XMLConfiguration.java:483)&lt;/li&gt;
	&lt;li&gt;Appending text &lt;span class=&quot;error&quot;&gt;&amp;#91;abcdefgh&amp;#93;&lt;/span&gt; to child&lt;br/&gt;
INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt;&lt;br/&gt;
org.apache.commons.configuration.XMLConfiguration.setXmlProperty(XMLConfiguration.java:418)&lt;/li&gt;
	&lt;li&gt;Appending abcdefgh to &lt;span class=&quot;error&quot;&gt;&amp;#91;key1: null&amp;#93;&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12407313" author="rwinston@eircom.net" created="Wed, 29 Sep 2004 14:56:00 +0000"  >&lt;p&gt;The bug seems to be that setXmlProperty() sets the value twice - once in&lt;br/&gt;
addXmlProperty(), and &lt;b&gt;then&lt;/b&gt; in setXmlProperty(). The second time, it just&lt;br/&gt;
blindly appends the textual Property value to the parent node, when of course,&lt;br/&gt;
an existing text node has already been created in addXmlProperty(), giving&lt;br/&gt;
&amp;lt;a&amp;gt;foofoo&amp;lt;/a&amp;gt; instead of &amp;lt;a&amp;gt;foo&amp;lt;/a&amp;gt;&lt;/p&gt;

&lt;p&gt;Perhaps setXmlProperty should clear the property before setting it to its new&lt;br/&gt;
value. This however, still means that the attribute gets initialized twice,&lt;br/&gt;
which feels like a &quot;code smell&quot;, I think you&apos;ll agree.&lt;/p&gt;

&lt;p&gt;Here is one way to do that , I would urge you to review this and then look for&lt;br/&gt;
alternative/more efficient mechanisms if they are available - I wrote this in a&lt;br/&gt;
hurry &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;private void setXmlProperty(String name, Object value)&lt;br/&gt;
    {&lt;/p&gt;

&lt;p&gt;...&lt;/p&gt;


&lt;p&gt;        if (attName == null)&lt;br/&gt;
        {&lt;br/&gt;
            // Should remove all existing text nodes before appending a new one&lt;br/&gt;
            CharacterData data = document.createTextNode(String.valueOf(value));&lt;br/&gt;
            logger.info(&quot;Appending &quot; + data.getData() + &quot; to &quot; + element);&lt;/p&gt;

&lt;p&gt;            Node node = null;&lt;br/&gt;
            NodeList children = element.getChildNodes();&lt;br/&gt;
            for(int i = 0; i &amp;lt; children.getLength(); ++i) {&lt;/p&gt;

&lt;p&gt;            	if((node = (Node)children.item&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;).getNodeType() == Node.TEXT_NODE) &lt;/p&gt;
{
            		logger.info(&quot;Found an existing text node [ &quot;+ node + &quot;] under &quot; +
element + &quot;, removing...&quot;);
            		element.removeChild(node);
            	}
&lt;p&gt;            }&lt;/p&gt;

&lt;p&gt;            element.appendChild(data);  &lt;br/&gt;
            logger.info(&quot;Child element # of &quot; + element + &quot; is now &quot; +&lt;br/&gt;
element.getChildNodes().getLength());&lt;/p&gt;

&lt;p&gt;        }&lt;br/&gt;
...&lt;/p&gt;

&lt;p&gt;}&lt;/p&gt;


&lt;p&gt;This produces the expected results (at least for my testcase, anyways). I think&lt;br/&gt;
a new TestCase should be written to regression-test this bug.&lt;/p&gt;

&lt;p&gt;This also brings me to an issue I have with the Configuration codebase, and one&lt;br/&gt;
I am frequently guilty of myself - where is the logging?? If there was a&lt;br/&gt;
consistent level of logging across the codebase, bugs like this would be &lt;b&gt;much&lt;/b&gt;&lt;br/&gt;
easier to track down. &lt;/p&gt;
</comment>
                            <comment id="12407314" author="ebourg" created="Tue, 5 Oct 2004 01:17:47 +0000"  >&lt;p&gt;I checked in a test case. I&apos;m working on a fix&lt;/p&gt;</comment>
                            <comment id="12407315" author="ebourg" created="Tue, 5 Oct 2004 02:41:15 +0000"  >&lt;p&gt;Fixed! I just removed setProperty and setXmlProperty, there was no reason to&lt;br/&gt;
keep them in XMLConfiguration since the &quot;set&quot; logic is already performed as a&lt;br/&gt;
&quot;clear and add&quot; in AbstractConfiguration.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                        <customfieldname>Bugzilla Id</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30799</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 10 Sep 2004 20:37:14 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33917</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 10 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0l6av:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>121671</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>